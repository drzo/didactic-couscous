/*! Quill Editor v0.20.0
 *  https://quilljs.com/
 *  Copyright (c) 2014, Jason Chen
 *  Copyright (c) 2013, salesforce.com
 */
function Token(t,e,n){this.__classname__="Token",n=n||{},this.name=t,e===!1?this.value=!1:this.value=e||null,0===e&&(this.value=0),this.prec=0,this.line=n.line||0,this.col=n.col||0,this.offset=n.offset||0,this.is_primitive=n.is_primitive||!1,this.is_operator=n.is_operator||!1}function Result(t,e){this.terms=t,this.last_token=e}function Op(t,e,n,r,i){this.name=t,this.symbol=e,this.prec=n,this.type=r,this.attrs=i||{},this.line=0,this.col=0,this.offset=0}function OpNode(t,e){if(this.symbol=t,this.prec=e||null,null===this.prec){var n=Op.has_ambiguous_precedence(t);try{n===!1&&(this.prec=Op.map_by_symbol[t].prec)}catch(r){throw new Error("Can't find `"+t+"` in Op.map_by_symbol")}}}function InComment(){}function Eos(){}function Code(t){this.code=t||{}}function Functor(t,e){this.__classname__="Functor",this.name=t,this.original_token=null,this.prec=0,this.attrs={primitive:!1,"boolean":!1,retvalue:!1},this.line=0,this.col=0,this.offset=0,this.arity=null,arguments.length>1?(this.args=Array.prototype.splice.call(arguments,1),this.arity=this.args.length):this.args=[]}function Var(t){this.__classname__="Var",this.is_anon="_"==t[0],this.prec=0,this.name=t,this.col=null,this.line=null,this.offset=0,this.value=null,this._id=Var.counter++,"_"==this.name[0]&&(this.name=this.name+"$"+this._id)}function Value(t){this.name=t}function Instruction(t,e){this.opcode=t,this.ctx=e||null}function ParseSummary(t,e){this.maybe_error=t,this.maybe_token_list=e}function ErrorSyntax(t,e){this.__classname__="ErrorSyntax",this.message=t,this.token=e}function ErrorInvalidFact(t,e){this.__classname__="ErrorInvalidFact",this.message=t,this.token=e}function ErrorExpectingFunctor(t,e){this.__classname__="ErrorExpectingFunctor",this.message=t,this.token=e}function ErrorExpectingVariable(t,e){this.__classname__="ErrorExpectingVariable",this.message=t,this.token=e}function ErrorFunctorNotFound(t,e){this.__classname__="ErrorFunctorNotFound",this.message=t,this.token=e}function ErrorFunctorClauseNotFound(t,e){this.__classname__="ErrorFunctorClauseNotFound",this.message=t,this.token=e}function ErrorFunctorCodeNotFound(t,e){this.__classname__="ErrorFunctorCodeNotFound",this.message=t,this.token=e}function ErrorExpectingGoal(t,e){this.__classname__="ErrorExpectingGoal",this.message=t,this.token=e}function ErrorInvalidHead(t,e){this.__classname__="ErrorInvalidHead",this.message=t,this.token=e}function ErrorRuleInQuestion(t,e){this.__classname__="ErrorRuleInQuestion",this.message=t,this.token=e}function ErrorNoMoreInstruction(t,e){this.__classname__="ErrorNoMoreInstruction",this.message=t,this.token=e}function ErrorInvalidInstruction(t,e){this.__classname__="ErrorInvalidInstruction",this.message=t,this.token=e}function ErrorInternal(t,e){this.__classname__="ErrorInternal",this.message=t,this.token=e}function ErrorInvalidValue(t,e){this.__classname__="ErrorInvalidValue",this.message=t,this.token=e}function ErrorAlreadyBound(t,e){this.__classname__="ErrorAlreadyBound",this.message=t,this.token=e}function ErrorNotBound(t,e){this.__classname__="ErrorNotBound",this.message=t,this.token=e}function ErrorExpectingListStart(t,e){this.__classname__="ErrorExpectingListStart",this.message=t,this.token=e}function ErrorExpectingListEnd(t,e){this.__classname__="ErrorExpectingListEnd",this.message=t,this.token=e}function ErrorInvalidToken(t,e){this.__classname__="ErrorInvalidToken",this.message=t,this.token=e}function ErrorUnexpectedParensClose(t,e){this.__classname__="ErrorUnexpectedParensClose",this.message=t,this.token=e}function ErrorUnexpectedPeriod(t,e){this.__classname__="ErrorUnexpectedPeriod",this.message=t,this.token=e}function ErrorUnexpectedEnd(t,e){this.__classname__="ErrorUnexpectedEnd",this.message=t,this.token=e}function ErrorUnexpectedListEnd(t,e){this.__classname__="ErrorUnexpectedListEnd",this.message=t,this.token=e}function ErrorAttemptToRedefineBuiltin(t,e,n){this.__classname__="ErrorAttemptToRedefineBuiltin",this.message=t,this.functor=e,this.arity=n}function Compiler(){}function Database(t){this.db={},this.al=t}function DatabaseManager(t,e){this.db_builtins=t,this.db_user=e}function DbAccess(){}function Interpreter(t,e){this.db=t,this.db_builtins=e||{},this.tracer=null,this.reached_end_question=!1}function Lexer(t){Array.isArray(t)?this.text=t.join("\n"):this.text=t,this.at_the_end=!1,this.current_match=null,this.current_line=0,this.offset=0,this.offset_in_text=0,this.comment_start_line=0,this.in_comment=!1,this.comment_chars="",this._tokenRegexp=/[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?|>=|=<|=\\=|=\:=|"""|\[|\]|\||\s.not\s.|\s.is\s.|\s.true\s.|\s.false\s.|\s.fail\s.|\d+(\.\d+)?|[A-Za-z_0-9]+|\?\-|:\-|\\=|=|\+\-|\*|\/|\-\+|[()\.,]|[\n\r]|./gm}function ParserL1(t,e){var n={convert_fact:!0};this.list=t,this.reached_end=!1,this.options=e||n}function ParserL2(t,e){this.options=e||{},this.tokens=t,this.index=0,this.ptokens=[]}function ParserL3(t,e,n){this.op_list=e,this.expressions=t}function Utils(){}function Visitor(t){this.exp=t,this.cb=null}function Visitor2(t){this.exp=t,this.cb=null}function Visitor3(t){this.exp=t,this.cb=null}!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Quill=t()}}(function(){var t;return function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,n,r){(function(e){(function(){function i(t,e,n){for(var r=t.length,i=n?r:-1;n?i--:++i<r;)if(e(t[i],i,t))return i;return-1}function o(t,e,n){if(e!==e)return a(t,n);for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function s(t){return"function"==typeof t||!1}function u(t){return"string"==typeof t?t:null==t?"":t+""}function a(t,e,n){for(var r=t.length,i=e+(n?0:-1);n?i--:++i<r;){var o=t[i];if(o!==o)return i}return-1}function l(t){return!!t&&"object"==typeof t}function c(t,e){for(var n=-1,r=t.length,i=-1,o=[];++n<r;)t[n]===e&&(t[n]=Te,o[++i]=n);return o}function p(){}function h(){}function f(t){this.__wrapped__=t,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=Dn,this.__views__=null}function d(t){var e=t?t.length:0;for(this.data={hash:Nn(null),set:new kn};e--;)this.push(t[e])}function g(t,e){var n=t.data,r="string"==typeof e||Jt(e)?n.set.has(e):n.hash[e];return r?0:-1}function v(t){var e=this.data;"string"==typeof t||Jt(t)?e.set.add(t):e.hash[t]=!0}function m(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}function _(t,e){for(var n=-1,r=t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function y(t,e){for(var n=-1,r=t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function b(t,e){for(var n=-1,r=t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function x(t,e,n,r){var i=-1,o=t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function E(t,e){for(var n=-1,r=t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function w(t,e){return t===ce?e:t}function T(t,e,n){for(var r=-1,i=fr(e),o=i.length;++r<o;){var s=i[r],u=t[s],a=n(u,e[s],s,t,e);(a===a?a===u:u!==u)&&(u!==ce||s in t)||(t[s]=a)}return t}function k(t,e){return null==e?t:A(e,fr(e),t)}function A(t,e,n){n||(n={});for(var r=-1,i=e.length;++r<i;){var o=e[r];n[o]=t[o]}return n}function L(t,e,n){var r=typeof t;return"function"==r?e===ce?t:W(t,e,n):null==t?oe:"object"==r?B(t):e===ce?ae(t):V(t,e)}function I(t,e,n,r,i,o,s){var u;if(n&&(u=i?n(t,r,i):n(t)),u!==ce)return u;if(!Jt(t))return t;var a=ar(t);if(a){if(u=bt(t),!e)return m(t,u)}else{var l=yn.call(t),c=l==Se;if(l!=Oe&&l!=ke&&(!c||i))return on[l]?Et(t,l,e):i?t:{};if(u=xt(c?{}:t),!e)return k(u,t)}o||(o=[]),s||(s=[]);for(var p=o.length;p--;)if(o[p]==t)return s[p];return o.push(t),s.push(u),(a?_:D)(t,function(r,i){u[i]=I(r,e,n,i,t,o,s)}),u}function N(t,e,n){if("function"!=typeof t)throw new TypeError(we);return setTimeout(function(){t.apply(ce,n)},e)}function S(t,e){var n=t?t.length:0,r=[];if(!n)return r;var i=-1,s=mt(),u=s==o,a=u&&e.length>=200?Jn(e):null,l=e.length;a&&(s=g,u=!1,e=a);t:for(;++i<n;){var c=t[i];if(u&&c===c){for(var p=l;p--;)if(e[p]===c)continue t;r.push(c)}else s(e,c,0)<0&&r.push(c)}return r}function C(t,e){var n=!0;return Kn(t,function(t,r,i){return n=!!e(t,r,i)}),n}function q(t,e,n,r){var i;return n(t,function(t,n,o){return e(t,n,o)?(i=r?n:t,!1):void 0}),i}function O(t,e,n){for(var r=-1,i=t.length,o=-1,s=[];++r<i;){var u=t[r];if(l(u)&&Tt(u)&&(n||ar(u)||Kt(u))){e&&(u=O(u,e,n));for(var a=-1,c=u.length;++a<c;)s[++o]=u[a]}else n||(s[++o]=u)}return s}function F(t,e){return zn(t,e,Zt)}function D(t,e){return zn(t,e,fr)}function R(t,e,n){if(null!=t){n!==ce&&n in Mt(t)&&(e=[n]);for(var r=0,i=e.length;null!=t&&i>r;)t=t[e[r++]];return r&&r==i?t:ce}}function M(t,e,n,r,i,o){return t===e?!0:null==t||null==e||!Jt(t)&&!l(e)?t!==t&&e!==e:U(t,e,M,n,r,i,o)}function U(t,e,n,r,i,o,s){var u=ar(t),a=ar(e),l=Ae,c=Ae;u||(l=yn.call(t),l==ke?l=Oe:l!=Oe&&(u=Xt(t))),a||(c=yn.call(e),c==ke?c=Oe:c!=Oe&&(a=Xt(e)));var p=l==Oe,h=c==Oe,f=l==c;if(f&&!u&&!p)return ft(t,e,l);if(!i){var d=p&&mn.call(t,"__wrapped__"),g=h&&mn.call(e,"__wrapped__");if(d||g)return n(d?t.value():t,g?e.value():e,r,i,o,s)}if(!f)return!1;o||(o=[]),s||(s=[]);for(var v=o.length;v--;)if(o[v]==t)return s[v]==e;o.push(t),s.push(e);var m=(u?ht:dt)(t,e,n,r,i,o,s);return o.pop(),s.pop(),m}function j(t,e,n){var r=e.length,i=r,o=!n;if(null==t)return!i;for(t=Mt(t);r--;){var s=e[r];if(o&&s[2]?s[1]!==t[s[0]]:!(s[0]in t))return!1}for(;++r<i;){s=e[r];var u=s[0],a=t[u],l=s[1];if(o&&s[2]){if(a===ce&&!(u in t))return!1}else{var c=n?n(a,l,u):ce;if(!(c===ce?M(l,a,n,!0):c))return!1}}return!0}function P(t,e){var n=-1,r=Tt(t)?Array(t.length):[];return Kn(t,function(t,i,o){r[++n]=e(t,i,o)}),r}function B(t){var e=_t(t);if(1==e.length&&e[0][2]){var n=e[0][0],r=e[0][1];return function(t){return null==t?!1:t[n]===r&&(r!==ce||n in Mt(t))}}return function(t){return j(t,e)}}function V(t,e){var n=ar(t),r=Lt(t)&&St(e),i=t+"";return t=Ut(t),function(o){if(null==o)return!1;var s=i;if(o=Mt(o),(n||!r)&&!(s in o)){if(o=1==t.length?o:R(o,z(t,0,-1)),null==o)return!1;s=Pt(t),o=Mt(o)}return o[s]===e?e!==ce||s in o:M(e,o[s],ce,!0)}}function H(t){return function(e){return null==e?ce:e[t]}}function G(t){var e=t+"";return t=Ut(t),function(n){return R(n,t,e)}}function K(t,e,n,r,i){return i(t,function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)}),n}function z(t,e,n){var r=-1,i=t.length;e=null==e?0:+e||0,0>e&&(e=-e>i?0:i+e),n=n===ce||n>i?i:+n||0,0>n&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o}function $(t,e){for(var n=-1,r=e.length,i=Array(r);++n<r;)i[n]=t[e[n]];return i}function J(t,e,n){var r=0,i=t?t.length:r;if("number"==typeof e&&e===e&&Un>=i){for(;i>r;){var o=r+i>>>1,s=t[o];(n?e>=s:e>s)&&null!==s?r=o+1:i=o}return i}return Y(t,e,oe,n)}function Y(t,e,n,r){e=n(e);for(var i=0,o=t?t.length:0,s=e!==e,u=null===e,a=e===ce;o>i;){var l=wn((i+o)/2),c=n(t[l]),p=c!==ce,h=c===c;if(s)var f=h||r;else f=u?h&&p&&(r||null!=c):a?h&&(r||p):null==c?!1:r?e>=c:e>c;f?i=l+1:o=l}return On(o,Mn)}function W(t,e,n){if("function"!=typeof t)return oe;if(e===ce)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)};case 5:return function(n,r,i,o,s){return t.call(e,n,r,i,o,s)}}return function(){return t.apply(e,arguments)}}function Q(t){return En.call(t,0)}function X(t,e,n){for(var r=n.length,i=-1,o=qn(t.length-r,0),s=-1,u=e.length,a=Array(o+u);++s<u;)a[s]=e[s];for(;++i<r;)a[n[i]]=t[i];for(;o--;)a[s++]=t[i++];return a}function Z(t,e,n){for(var r=-1,i=n.length,o=-1,s=qn(t.length-i,0),u=-1,a=e.length,l=Array(s+a);++o<s;)l[o]=t[o];for(var c=o;++u<a;)l[c+u]=e[u];for(;++r<i;)l[c+n[r]]=t[o++];return l}function tt(t){return Ht(function(e,n){var r=-1,i=null==e?0:n.length,o=i>2?n[i-2]:ce,s=i>2?n[2]:ce,u=i>1?n[i-1]:ce;for("function"==typeof o?(o=W(o,u,5),i-=2):(o="function"==typeof u?u:ce,i-=o?1:0),s&&At(n[0],n[1],s)&&(o=3>i?ce:o,i=1);++r<i;){var a=n[r];a&&t(e,a,o)}return e})}function et(t,e){return function(n,r){var i=n?Wn(n):0;if(!Nt(i))return t(n,r);for(var o=e?i:-1,s=Mt(n);(e?o--:++o<i)&&r(s[o],o,s)!==!1;);return n}}function nt(t){return function(e,n,r){for(var i=Mt(e),o=r(e),s=o.length,u=t?s:-1;t?u--:++u<s;){var a=o[u];if(n(i[a],a,i)===!1)break}return e}}function rt(t,e){function n(){var i=this&&this!==fn&&this instanceof n?r:t;return i.apply(e,arguments)}var r=it(t);return n}function it(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4])}var n=Gn(t.prototype),r=t.apply(n,e);return Jt(r)?r:n}}function ot(t,e){return function(n,r,o){if(r=gt(r,o,3),ar(n)){var s=i(n,r,e);return s>-1?n[s]:ce}return q(n,r,t)}}function st(t,e){return function(n,r,i){return"function"==typeof r&&i===ce&&ar(n)?t(n,r):e(n,W(r,i,3))}}function ut(t){var e=Ht(function(n,r){var i=c(r,e.placeholder);return pt(n,t,null,r,i)});return e}function at(t,e){return function(n,r,i,o){var s=arguments.length<3;return"function"==typeof r&&o===ce&&ar(n)?t(n,r,i,s):K(n,gt(r,o,4),i,s,e)}}function lt(t,e,n,r,i,o,s,u,a,l){function p(){for(var b=arguments.length,x=b,E=Array(b);x--;)E[x]=arguments[x];if(r&&(E=X(E,r,i)),o&&(E=Z(E,o,s)),g||_){var w=p.placeholder,T=c(E,w);if(b-=T.length,l>b){var k=u?m(u):null,A=qn(l-b,0),L=g?T:null,I=g?null:T,N=g?E:null,S=g?null:E;e|=g?me:_e,e&=~(g?_e:me),v||(e&=~(he|fe));var C=[t,e,n,N,L,S,I,k,a,A],q=lt.apply(ce,C);return It(t)&&Qn(q,C),q.placeholder=w,q}}var O=f?n:this,F=d?O[t]:t;return u&&(E=Ft(E,u)),h&&a<E.length&&(E.length=a),this&&this!==fn&&this instanceof p&&(F=y||it(t)),F.apply(O,E)}var h=e&ye,f=e&he,d=e&fe,g=e&ge,v=e&de,_=e&ve,y=d?null:it(t);return p}function ct(t,e,n,r){function i(){for(var e=-1,u=arguments.length,a=-1,l=r.length,c=Array(u+l);++a<l;)c[a]=r[a];for(;u--;)c[a++]=arguments[++e];var p=this&&this!==fn&&this instanceof i?s:t;return p.apply(o?n:this,c)}var o=e&he,s=it(t);return i}function pt(t,e,n,r,i,o,s,u){var a=e&fe;if(!a&&"function"!=typeof t)throw new TypeError(we);var l=r?r.length:0;if(l||(e&=~(me|_e),r=i=null),l-=i?i.length:0,e&_e){var c=r,p=i;r=i=null}var h=a?null:Yn(t),f=[t,e,n,r,i,c,p,o,s,u];if(h&&(Ct(f,h),e=f[1],u=f[9]),f[9]=null==u?a?0:t.length:qn(u-l,0)||0,e==he)var d=rt(f[0],f[2]);else d=e!=me&&e!=(he|me)||f[4].length?lt.apply(ce,f):ct.apply(ce,f);var g=h?$n:Qn;return g(d,f)}function ht(t,e,n,r,i,o,s){var u=-1,a=t.length,l=e.length;if(a!=l&&!(i&&l>a))return!1;for(;++u<a;){var c=t[u],p=e[u],h=r?r(i?p:c,i?c:p,u):ce;if(h!==ce){if(h)continue;return!1}if(i){if(!E(e,function(t){return c===t||n(c,t,r,i,o,s)}))return!1}else if(c!==p&&!n(c,p,r,i,o,s))return!1}return!0}function ft(t,e,n){switch(n){case Le:case Ie:return+t==+e;case Ne:return t.name==e.name&&t.message==e.message;case qe:return t!=+t?e!=+e:t==+e;case Fe:case Re:return t==e+""}return!1}function dt(t,e,n,r,i,o,s){var u=fr(t),a=u.length,l=fr(e),c=l.length;if(a!=c&&!i)return!1;for(var p=a;p--;){var h=u[p];if(!(i?h in e:mn.call(e,h)))return!1}for(var f=i;++p<a;){h=u[p];var d=t[h],g=e[h],v=r?r(i?g:d,i?d:g,h):ce;if(!(v===ce?n(d,g,r,i,o,s):v))return!1;f||(f="constructor"==h)}if(!f){var m=t.constructor,_=e.constructor;if(m!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof _&&_ instanceof _))return!1}return!0}function gt(t,e,n){var r=p.callback||re;return r=r===re?L:r,n?r(t,e,n):r}function vt(t){for(var e=t.name,n=Vn[e],r=n?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function mt(t,e,n){var r=p.indexOf||jt;return r=r===jt?o:r,t?r(t,e,n):r}function _t(t){for(var e=te(t),n=e.length;n--;)e[n][2]=St(e[n][1]);return e}function yt(t,e){var n=null==t?ce:t[e];return Yt(n)?n:ce}function bt(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&mn.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function xt(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Object),new e}function Et(t,e,n){var r=t.constructor;switch(e){case Ue:return Q(t);case Le:case Ie:return new r(+t);case je:case Pe:case Be:case Ve:case He:case Ge:case Ke:case ze:case $e:var i=t.buffer;return new r(n?Q(i):i,t.byteOffset,t.length);case qe:case Re:return new r(t);case Fe:var o=new r(t.source,tn.exec(t));o.lastIndex=t.lastIndex}return o}function wt(t,e,n){null==t||Lt(e,t)||(e=Ut(e),t=1==e.length?t:R(t,z(e,0,-1)),e=Pt(e));var r=null==t?t:t[e];return null==r?ce:r.apply(t,n)}function Tt(t){return null!=t&&Nt(Wn(t))}function kt(t,e){return t="number"==typeof t||nn.test(t)?+t:-1,e=null==e?Pn:e,t>-1&&t%1==0&&e>t}function At(t,e,n){if(!Jt(n))return!1;var r=typeof e;if("number"==r?Tt(n)&&kt(e,n.length):"string"==r&&e in n){var i=n[e];return t===t?t===i:i!==i}return!1}function Lt(t,e){var n=typeof t;if("string"==n&&Ye.test(t)||"number"==n)return!0;if(ar(t))return!1;var r=!Je.test(t);return r||null!=e&&t in Mt(e)}function It(t){var e=vt(t);if(!(e in f.prototype))return!1;var n=p[e];if(t===n)return!0;var r=Yn(n);return!!r&&t===r[0]}function Nt(t){return"number"==typeof t&&t>-1&&t%1==0&&Pn>=t}function St(t){return t===t&&!Jt(t)}function Ct(t,e){var n=t[1],r=e[1],i=n|r,o=ye>i,s=r==ye&&n==ge||r==ye&&n==be&&t[7].length<=e[8]||r==(ye|be)&&n==ge;if(!o&&!s)return t;r&he&&(t[2]=e[2],i|=n&he?0:de);var u=e[3];if(u){var a=t[3];t[3]=a?X(a,u,e[4]):m(u),t[4]=a?c(t[3],Te):m(e[4])}return u=e[5],u&&(a=t[5],t[5]=a?Z(a,u,e[6]):m(u),t[6]=a?c(t[5],Te):m(e[6])),u=e[7],u&&(t[7]=m(u)),r&ye&&(t[8]=null==t[8]?e[8]:On(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i,t}function qt(t,e){t=Mt(t);for(var n=-1,r=e.length,i={};++n<r;){var o=e[n];o in t&&(i[o]=t[o])}return i}function Ot(t,e){var n={};return F(t,function(t,r,i){e(t,r,i)&&(n[r]=t)}),n}function Ft(t,e){for(var n=t.length,r=On(e.length,n),i=m(t);r--;){var o=e[r];t[r]=kt(o,n)?i[o]:ce}return t}function Dt(t){var e;p.support;if(!l(t)||yn.call(t)!=Oe||!mn.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var n;return F(t,function(t,e){n=e}),n===ce||mn.call(t,n)}function Rt(t){for(var e=Zt(t),n=e.length,r=n&&t.length,i=!!r&&Nt(r)&&(ar(t)||Kt(t)),o=-1,s=[];++o<n;){var u=e[o];(i&&kt(u,r)||mn.call(t,u))&&s.push(u)}return s}function Mt(t){return Jt(t)?t:Object(t)}function Ut(t){if(ar(t))return t;var e=[];return u(t).replace(We,function(t,n,r,i){e.push(r?i.replace(Ze,"$1"):n||t)}),e}function jt(t,e,n){var r=t?t.length:0;if(!r)return-1;if("number"==typeof n)n=0>n?qn(r+n,0):n;else if(n){var i=J(t,e),s=t[i];return(e===e?e===s:s!==s)?i:-1}return o(t,e,n||0)}function Pt(t){var e=t?t.length:0;return e?t[e-1]:ce}function Bt(t,e,n){var r=ar(t)?y:C;return n&&At(t,e,n)&&(e=null),("function"!=typeof e||n!==ce)&&(e=gt(e,n,3)),r(t,e)}function Vt(t,e,n){var r=ar(t)?b:P;return e=gt(e,n,3),r(t,e)}function Ht(t,e){if("function"!=typeof t)throw new TypeError(we);return e=qn(e===ce?t.length-1:+e||0,0),function(){for(var n=arguments,r=-1,i=qn(n.length-e,0),o=Array(i);++r<i;)o[r]=n[e+r];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,n[0],o);case 2:return t.call(this,n[0],n[1],o)}var s=Array(e+1);for(r=-1;++r<e;)s[r]=n[r];return s[e]=o,t.apply(this,s)}}function Gt(t,e,n,r){return e&&"boolean"!=typeof e&&At(t,e,n)?e=!1:"function"==typeof e&&(r=n,n=e,e=!1),"function"==typeof n?I(t,e,W(n,r,1)):I(t,e)}function Kt(t){return l(t)&&Tt(t)&&yn.call(t)==ke}function zt(t){return!!t&&1===t.nodeType&&l(t)&&yn.call(t).indexOf("Element")>-1}function $t(t,e,n,r){n="function"==typeof n?W(n,r,3):ce;var i=n?n(t,e):ce;return i===ce?M(t,e,n):!!i}function Jt(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Yt(t){return null==t?!1:yn.call(t)==Se?bn.test(vn.call(t)):l(t)&&en.test(t)}function Wt(t){return"number"==typeof t||l(t)&&yn.call(t)==qe}function Qt(t){return"string"==typeof t||l(t)&&yn.call(t)==Re}function Xt(t){return l(t)&&Nt(t.length)&&!!rn[yn.call(t)]}function Zt(t){if(null==t)return[];Jt(t)||(t=Object(t));var e=t.length;e=e&&Nt(e)&&(ar(t)||Kt(t))&&e||0;for(var n=t.constructor,r=-1,i="function"==typeof n&&n.prototype===t,o=Array(e),s=e>0;++r<e;)o[r]=r+"";for(var u in t)s&&kt(u,e)||"constructor"==u&&(i||!mn.call(t,u))||o.push(u);return o}function te(t){t=Mt(t);for(var e=-1,n=fr(t),r=n.length,i=Array(r);++e<r;){var o=n[e];i[e]=[o,t[o]]}return i}function ee(t){return $(t,fr(t))}function ne(t){return t=u(t),t&&Xe.test(t)?t.replace(Qe,"\\$&"):t}function re(t,e,n){return n&&At(t,e,n)&&(e=null),l(t)?se(t):L(t,e)}function ie(t){return function(){return t}}function oe(t){return t}function se(t){return B(I(t,!0))}function ue(){}function ae(t){return Lt(t)?H(t):G(t)}function le(t){var e=++_n;return u(t)+e}var ce,pe="3.9.3",he=1,fe=2,de=4,ge=8,ve=16,me=32,_e=64,ye=128,be=256,xe=150,Ee=16,we="Expected a function",Te="__lodash_placeholder__",ke="[object Arguments]",Ae="[object Array]",Le="[object Boolean]",Ie="[object Date]",Ne="[object Error]",Se="[object Function]",Ce="[object Map]",qe="[object Number]",Oe="[object Object]",Fe="[object RegExp]",De="[object Set]",Re="[object String]",Me="[object WeakMap]",Ue="[object ArrayBuffer]",je="[object Float32Array]",Pe="[object Float64Array]",Be="[object Int8Array]",Ve="[object Int16Array]",He="[object Int32Array]",Ge="[object Uint8Array]",Ke="[object Uint8ClampedArray]",ze="[object Uint16Array]",$e="[object Uint32Array]",Je=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,Ye=/^\w*$/,We=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Qe=/[.*+?^${}()|[\]\/\\]/g,Xe=RegExp(Qe.source),Ze=/\\(\\)?/g,tn=/\w*$/,en=/^\[object .+?Constructor\]$/,nn=/^\d+$/,rn={};rn[je]=rn[Pe]=rn[Be]=rn[Ve]=rn[He]=rn[Ge]=rn[Ke]=rn[ze]=rn[$e]=!0,rn[ke]=rn[Ae]=rn[Ue]=rn[Le]=rn[Ie]=rn[Ne]=rn[Se]=rn[Ce]=rn[qe]=rn[Oe]=rn[Fe]=rn[De]=rn[Re]=rn[Me]=!1;var on={};on[ke]=on[Ae]=on[Ue]=on[Le]=on[Ie]=on[je]=on[Pe]=on[Be]=on[Ve]=on[He]=on[qe]=on[Oe]=on[Fe]=on[Re]=on[Ge]=on[Ke]=on[ze]=on[$e]=!0,on[Ne]=on[Se]=on[Ce]=on[De]=on[Me]=!1;var sn={"function":!0,object:!0},un=sn[typeof r]&&r&&!r.nodeType&&r,an=sn[typeof n]&&n&&!n.nodeType&&n,ln=un&&an&&"object"==typeof e&&e&&e.Object&&e,cn=sn[typeof self]&&self&&self.Object&&self,pn=sn[typeof window]&&window&&window.Object&&window,hn=an&&an.exports===un&&un,fn=ln||pn!==(this&&this.window)&&pn||cn||this,dn=Object.prototype,gn=(gn=fn.window)?gn.document:null,vn=Function.prototype.toString,mn=dn.hasOwnProperty,_n=0,yn=dn.toString,bn=RegExp("^"+ne(vn.call(mn)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),xn=yt(fn,"ArrayBuffer"),En=yt(xn&&new xn(0),"slice"),wn=Math.floor,Tn=yt(Object,"getPrototypeOf"),kn=yt(fn,"Set"),An=yt(fn,"Uint8Array"),Ln=yt(fn,"WeakMap"),In=function(){try{var t=yt(fn,"Float64Array"),e=new t(new xn(10),0,1)&&t}catch(n){}return e||null}(),Nn=yt(Object,"create"),Sn=yt(Array,"isArray"),Cn=yt(Object,"keys"),qn=Math.max,On=Math.min,Fn=yt(Date,"now"),Dn=Number.POSITIVE_INFINITY,Rn=4294967295,Mn=Rn-1,Un=Rn>>>1,jn=In?In.BYTES_PER_ELEMENT:0,Pn=9007199254740991,Bn=Ln&&new Ln,Vn={},Hn=p.support={};!function(t){var e=function(){this.x=t},n=[];e.prototype={valueOf:t,y:t};for(var r in new e)n.push(r);try{Hn.dom=11===gn.createDocumentFragment().nodeType}catch(i){Hn.dom=!1}}(1,0);var Gn=function(){function t(){}return function(e){if(Jt(e)){t.prototype=e;var n=new t;t.prototype=null}return n||{}}}(),Kn=et(D),zn=nt(),$n=Bn?function(t,e){return Bn.set(t,e),t}:oe;En||(Q=xn&&An?function(t){var e=t.byteLength,n=In?wn(e/jn):0,r=n*jn,i=new xn(e);if(n){var o=new In(i,0,n);o.set(new In(t,0,n))}return e!=r&&(o=new An(i,r),o.set(new An(t,r))),i}:ie(null));var Jn=Nn&&kn?function(t){return new d(t)}:ie(null),Yn=Bn?function(t){return Bn.get(t)}:ue,Wn=H("length"),Qn=function(){var t=0,e=0;return function(n,r){var i=ir(),o=Ee-(i-e);if(e=i,o>0){if(++t>=xe)return n}else t=0;return $n(n,r)}}(),Xn=Ht(function(t,e){return Tt(t)?S(t,O(e,!1,!0)):[]}),Zn=Ht(function(t){for(var e=t.length,n=e,r=Array(p),i=mt(),s=i==o,u=[];n--;){var a=t[n]=Tt(a=t[n])?a:[];r[n]=s&&a.length>=120?Jn(n&&a):null}var l=t[0],c=-1,p=l?l.length:0,h=r[0];t:for(;++c<p;)if(a=l[c],(h?g(h,a):i(u,a,0))<0){for(var n=e;--n;){var f=r[n];if((f?g(f,a):i(t[n],a,0))<0)continue t}h&&h.push(a),u.push(a)}return u}),tr=ot(Kn),er=st(_,Kn),nr=Ht(function(t,e,n){var r=-1,i="function"==typeof e,o=Lt(e),s=Tt(t)?Array(t.length):[];return Kn(t,function(t){var u=i?e:o&&null!=t?t[e]:null;s[++r]=u?u.apply(t,n):wt(t,e,n)}),s}),rr=at(x,Kn),ir=Fn||function(){return(new Date).getTime()},or=Ht(function(t,e,n){var r=he;if(n.length){var i=c(n,or.placeholder);r|=me}return pt(t,r,e,n,i)}),sr=Ht(function(t,e){return N(t,1,e)}),ur=ut(me),ar=Sn||function(t){return l(t)&&Nt(t.length)&&yn.call(t)==Ae};Hn.dom||(zt=function(t){return!!t&&1===t.nodeType&&l(t)&&!cr(t)});var lr=s(/x/)||An&&!s(An)?function(t){return yn.call(t)==Se}:s,cr=Tn?function(t){if(!t||yn.call(t)!=Oe)return!1;var e=yt(t,"valueOf"),n=e&&(n=Tn(e))&&Tn(n);return n?t==n||Tn(t)==n:Dt(t)}:Dt,pr=tt(function(t,e,n){return n?T(t,e,n):k(t,e)}),hr=Ht(function(t){var e=t[0];return null==e?e:(t.push(w),pr.apply(ce,t))}),fr=Cn?function(t){var e=null==t?null:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&Tt(t)?Rt(t):Jt(t)?Cn(t):[]}:Rt,dr=Ht(function(t,e){if(null==t)return{};if("function"!=typeof e[0]){var e=b(O(e),String);return qt(t,S(Zt(t),e))}var n=W(e[0],e[1],3);return Ot(t,function(t,e,r){return!n(t,e,r)})});f.prototype=Gn(h.prototype),f.prototype.constructor=f,d.prototype.push=v,p.assign=pr,p.bind=or,p.callback=re,p.constant=ie,p.defaults=hr,p.defer=sr,p.difference=Xn,p.forEach=er,p.intersection=Zn,p.invoke=nr,p.keys=fr,p.keysIn=Zt,p.map=Vt,p.matches=se,p.omit=dr,p.pairs=te,p.partial=ur,p.property=ae,p.restParam=Ht,p.values=ee,p.collect=Vt,p.each=er,p.extend=pr,p.iteratee=re,p.clone=Gt,p.escapeRegExp=ne,p.every=Bt,p.find=tr,p.identity=oe,p.indexOf=jt,p.isArguments=Kt,p.isArray=ar,p.isElement=zt,p.isEqual=$t,p.isFunction=lr,p.isNative=Yt,p.isNumber=Wt,p.isObject=Jt,p.isPlainObject=cr,p.isString=Qt,p.isTypedArray=Xt,p.last=Pt,p.noop=ue,p.now=ir,p.reduce=rr,p.uniqueId=le,p.all=Bt,p.eq=$t,p.detect=tr,p.foldl=rr,p.inject=rr,p.VERSION=pe,_(["bind","partial"],function(t){p[t].placeholder=p}),"function"==typeof t&&"object"==typeof t.amd&&t.amd?(fn._=p,t(function(){return p})):un&&an?hn?(an.exports=p)._=p:un._=p:fn._=p}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,n,r){!function(e){function n(){this._events={},this._conf&&i.call(this,this._conf)}function i(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners&&(this._events.maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),this.wildcard&&(this.listenerTree={}))}function o(t){this._events={},this.newListener=!1,i.call(this,t)}function s(t,e,n,r){if(!n)return[];var i,o,u,a,l,c,p,h=[],f=e.length,d=e[r],g=e[r+1];if(r===f&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(i=0,o=n._listeners.length;o>i;i++)t&&t.push(n._listeners[i]);return[n]}if("*"===d||"**"===d||n[d]){if("*"===d){for(u in n)"_listeners"!==u&&n.hasOwnProperty(u)&&(h=h.concat(s(t,e,n[u],r+1)));return h}if("**"===d){p=r+1===f||r+2===f&&"*"===g,p&&n._listeners&&(h=h.concat(s(t,e,n,f)));for(u in n)"_listeners"!==u&&n.hasOwnProperty(u)&&("*"===u||"**"===u?(n[u]._listeners&&!p&&(h=h.concat(s(t,e,n[u],f))),h=h.concat(s(t,e,n[u],r))):h=u===g?h.concat(s(t,e,n[u],r+2)):h.concat(s(t,e,n[u],r)));return h}h=h.concat(s(t,e,n[d],r+1))}if(a=n["*"],a&&s(t,e,a,r+1),l=n["**"])if(f>r){l._listeners&&s(t,e,l,f);for(u in l)"_listeners"!==u&&l.hasOwnProperty(u)&&(u===g?s(t,e,l[u],r+2):u===d?s(t,e,l[u],r+1):(c={},c[u]=l[u],s(t,e,{"**":c},r+1)))}else l._listeners?s(t,e,l,f):l["*"]&&l["*"]._listeners&&s(t,e,l["*"],f);return h}function u(t,e){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var n=0,r=t.length;r>n+1;n++)if("**"===t[n]&&"**"===t[n+1])return;for(var i=this.listenerTree,o=t.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===t.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,e];else if(a(i._listeners)&&(i._listeners.push(e),!i._listeners.warned)){var s=l;"undefined"!=typeof this._events.maxListeners&&(s=this._events.maxListeners),s>0&&i._listeners.length>s&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=e;return!0}o=t.shift()}return!0}var a=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},l=10;o.prototype.delimiter=".",o.prototype.setMaxListeners=function(t){this._events||n.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},o.prototype.event="",o.prototype.once=function(t,e){return this.many(t,1,e),this},o.prototype.many=function(t,e,n){function r(){0===--e&&i.off(t,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(t,r),i},o.prototype.emit=function(){this._events||n.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var e=arguments.length,r=new Array(e-1),i=1;e>i;i++)r[i-1]=arguments[i];for(i=0,e=this._all.length;e>i;i++)this.event=t,this._all[i].apply(this,r)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var o;if(this.wildcard){o=[];var u="string"==typeof t?t.split(this.delimiter):t.slice();s.call(this,o,u,this.listenerTree,0)}else o=this._events[t];if("function"==typeof o){if(this.event=t,1===arguments.length)o.call(this);else if(arguments.length>1)switch(arguments.length){case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(var e=arguments.length,r=new Array(e-1),i=1;e>i;i++)r[i-1]=arguments[i];o.apply(this,r)}return!0}if(o){for(var e=arguments.length,r=new Array(e-1),i=1;e>i;i++)r[i-1]=arguments[i];for(var a=o.slice(),i=0,e=a.length;e>i;i++)this.event=t,a[i].apply(this,r);return a.length>0||!!this._all}return!!this._all},o.prototype.on=function(t,e){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof e)throw new Error("on only accepts instances of Function");if(this._events||n.call(this),this.emit("newListener",t,e),this.wildcard)return u.call(this,t,e),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],e];else if(a(this._events[t])&&(this._events[t].push(e),!this._events[t].warned)){var r=l;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}}else this._events[t]=e;return this},o.prototype.onAny=function(t){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(t),this},o.prototype.addListener=o.prototype.on,o.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"==typeof t?t.split(this.delimiter):t.slice();
r=s.call(this,null,i,this.listenerTree,0)}else{if(!this._events[t])return this;n=this._events[t],r.push({_listeners:n})}for(var o=0;o<r.length;o++){var u=r[o];if(n=u._listeners,a(n)){for(var l=-1,c=0,p=n.length;p>c;c++)if(n[c]===e||n[c].listener&&n[c].listener===e||n[c]._origin&&n[c]._origin===e){l=c;break}if(0>l)continue;return this.wildcard?u._listeners.splice(l,1):this._events[t].splice(l,1),0===n.length&&(this.wildcard?delete u._listeners:delete this._events[t]),this}(n===e||n.listener&&n.listener===e||n._origin&&n._origin===e)&&(this.wildcard?delete u._listeners:delete this._events[t])}return this},o.prototype.offAny=function(t){var e,n=0,r=0;if(t&&this._all&&this._all.length>0){for(e=this._all,n=0,r=e.length;r>n;n++)if(t===e[n])return e.splice(n,1),this}else this._all=[];return this},o.prototype.removeListener=o.prototype.off,o.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||n.call(this),this;if(this.wildcard)for(var e="string"==typeof t?t.split(this.delimiter):t.slice(),r=s.call(this,null,e,this.listenerTree,0),i=0;i<r.length;i++){var o=r[i];o._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},o.prototype.listeners=function(t){if(this.wildcard){var e=[],r="string"==typeof t?t.split(this.delimiter):t.slice();return s.call(this,e,r,this.listenerTree,0),e}return this._events||n.call(this),this._events[t]||(this._events[t]=[]),a(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},o.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof t&&t.amd?t(function(){return o}):"object"==typeof r?r.EventEmitter2=o:window.EventEmitter2=o}()},{}],3:[function(t,e,n){var r=t("fast-diff"),i=t("./is"),o=t("./op"),s=String.fromCharCode(0),u=function(t){i.array(t)?this.ops=t:i.object(t)&&i.array(t.ops)?this.ops=t.ops:this.ops=[]};u.prototype.insert=function(t,e){var n={};return 0===t.length?this:(n.insert=t,i.object(e)&&Object.keys(e).length>0&&(n.attributes=e),this.push(n))},u.prototype["delete"]=function(t){return 0>=t?this:this.push({"delete":t})},u.prototype.retain=function(t,e){if(0>=t)return this;var n={retain:t};return i.object(e)&&Object.keys(e).length>0&&(n.attributes=e),this.push(n)},u.prototype.push=function(t){var e=this.ops.length,n=this.ops[e-1];if(t=o.clone(t),i.object(n)){if(i.number(t["delete"])&&i.number(n["delete"]))return this.ops[e-1]={"delete":n["delete"]+t["delete"]},this;if(i.number(n["delete"])&&null!=t.insert&&(e-=1,n=this.ops[e-1],!i.object(n)))return this.ops.unshift(t),this;if(i.equal(t.attributes,n.attributes)){if(i.string(t.insert)&&i.string(n.insert))return this.ops[e-1]={insert:n.insert+t.insert},i.object(t.attributes)&&(this.ops[e-1].attributes=t.attributes),this;if(i.number(t.retain)&&i.number(n.retain))return this.ops[e-1]={retain:n.retain+t.retain},i.object(t.attributes)&&(this.ops[e-1].attributes=t.attributes),this}}return e===this.ops.length?this.ops.push(t):this.ops.splice(e,0,t),this},u.prototype.chop=function(){var t=this.ops[this.ops.length-1];return t&&t.retain&&!t.attributes&&this.ops.pop(),this},u.prototype.length=function(){return this.ops.reduce(function(t,e){return t+o.length(e)},0)},u.prototype.slice=function(t,e){t=t||0,i.number(e)||(e=1/0);for(var n=new u,r=o.iterator(this.ops),s=0;e>s&&r.hasNext();){var a;t>s?a=r.next(t-s):(a=r.next(e-s),n.push(a)),s+=o.length(a)}return n},u.prototype.compose=function(t){for(var e=o.iterator(this.ops),n=o.iterator(t.ops),r=new u;e.hasNext()||n.hasNext();)if("insert"===n.peekType())r.push(n.next());else if("delete"===e.peekType())r.push(e.next());else{var s=Math.min(e.peekLength(),n.peekLength()),a=e.next(s),l=n.next(s);if(i.number(l.retain)){var c={};i.number(a.retain)?c.retain=s:c.insert=a.insert;var p=o.attributes.compose(a.attributes,l.attributes,i.number(a.retain));p&&(c.attributes=p),r.push(c)}else i.number(l["delete"])&&i.number(a.retain)&&r.push(l)}return r.chop()},u.prototype.diff=function(t){var e=new u;if(this.ops===t.ops)return e;var n=[this.ops,t.ops].map(function(e){return e.map(function(n){if(null!=n.insert)return i.string(n.insert)?n.insert:s;var r=e===t.ops?"on":"with";throw new Error("diff() called "+r+" non-document")}).join("")}),a=r(n[0],n[1]),l=o.iterator(this.ops),c=o.iterator(t.ops);return a.forEach(function(t){for(var n=t[1].length;n>0;){var s=0;switch(t[0]){case r.INSERT:s=Math.min(c.peekLength(),n),e.push(c.next(s));break;case r.DELETE:s=Math.min(n,l.peekLength()),l.next(s),e["delete"](s);break;case r.EQUAL:s=Math.min(l.peekLength(),c.peekLength(),n);var u=l.next(s),a=c.next(s);i.equal(u.insert,a.insert)?e.retain(s,o.attributes.diff(u.attributes,a.attributes)):e.push(a)["delete"](s)}n-=s}}),e.chop()},u.prototype.transform=function(t,e){if(e=!!e,i.number(t))return this.transformPosition(t,e);for(var n=o.iterator(this.ops),r=o.iterator(t.ops),s=new u;n.hasNext()||r.hasNext();)if("insert"!==n.peekType()||!e&&"insert"===r.peekType())if("insert"===r.peekType())s.push(r.next());else{var a=Math.min(n.peekLength(),r.peekLength()),l=n.next(a),c=r.next(a);if(l["delete"])continue;c["delete"]?s.push(c):s.retain(a,o.attributes.transform(l.attributes,c.attributes,e))}else s.retain(o.length(n.next()));return s.chop()},u.prototype.transformPosition=function(t,e){e=!!e;for(var n=o.iterator(this.ops),r=0;n.hasNext()&&t>=r;){var i=n.peekLength(),s=n.peekType();n.next(),"delete"!==s?("insert"===s&&(t>r||!e)&&(t+=i),r+=i):t-=Math.min(i,t-r)}return t},e.exports=u},{"./is":4,"./op":5,"fast-diff":6}],4:[function(t,e,n){e.exports={equal:function(t,e){if(t===e)return!0;if(null==t&&null==e)return!0;if(null==t||null==e)return!1;if(!this.object(t)||!this.object(e))return!1;if(Object.keys(t).length!=Object.keys(e).length)return!1;for(var n in t)if(t[n]!==e[n])return!1;return!0},array:function(t){return Array.isArray(t)},number:function(t){return"number"==typeof t?!0:"object"==typeof t&&"[object Number]"===Object.prototype.toString.call(t)?!0:!1},object:function(t){return t?"function"==typeof t||"object"==typeof t:!1},string:function(t){return"string"==typeof t?!0:"object"==typeof t&&"[object String]"===Object.prototype.toString.call(t)?!0:!1}}},{}],5:[function(t,e,n){function r(t){this.ops=t,this.index=0,this.offset=0}var i=t("./is"),o={attributes:{clone:function(t,e){return i.object(t)?Object.keys(t).reduce(function(n,r){return void 0===t[r]||null===t[r]&&!e||(n[r]=t[r]),n},{}):{}},compose:function(t,e,n){i.object(t)||(t={}),i.object(e)||(e={});var r=this.clone(e,n);for(var o in t)void 0!==t[o]&&void 0===e[o]&&(r[o]=t[o]);return Object.keys(r).length>0?r:void 0},diff:function(t,e){i.object(t)||(t={}),i.object(e)||(e={});var n=Object.keys(t).concat(Object.keys(e)).reduce(function(n,r){return t[r]!==e[r]&&(n[r]=void 0===e[r]?null:e[r]),n},{});return Object.keys(n).length>0?n:void 0},transform:function(t,e,n){if(!i.object(t))return e;if(!i.object(e))return void 0;if(!n)return e;var r=Object.keys(e).reduce(function(n,r){return void 0===t[r]&&(n[r]=e[r]),n},{});return Object.keys(r).length>0?r:void 0}},clone:function(t){var e=this.attributes.clone(t);return i.object(e.attributes)&&(e.attributes=this.attributes.clone(e.attributes,!0)),e},iterator:function(t){return new r(t)},length:function(t){return i.number(t["delete"])?t["delete"]:i.number(t.retain)?t.retain:i.string(t.insert)?t.insert.length:1}};r.prototype.hasNext=function(){return this.peekLength()<1/0},r.prototype.next=function(t){t||(t=1/0);var e=this.ops[this.index];if(e){var n=this.offset,r=o.length(e);if(t>=r-n?(t=r-n,this.index+=1,this.offset=0):this.offset+=t,i.number(e["delete"]))return{"delete":t};var s={};return e.attributes&&(s.attributes=e.attributes),i.number(e.retain)?s.retain=t:i.string(e.insert)?s.insert=e.insert.substr(n,t):s.insert=e.insert,s}return{retain:1/0}},r.prototype.peekLength=function(){return this.ops[this.index]?o.length(this.ops[this.index])-this.offset:1/0},r.prototype.peekType=function(){return this.ops[this.index]?i.number(this.ops[this.index]["delete"])?"delete":i.number(this.ops[this.index].retain)?"retain":"insert":"retain"},e.exports=o},{"./is":4}],6:[function(t,e,n){function r(t,e){if(t==e)return t?[[f,t]]:[];var n=u(t,e),r=t.substring(0,n);t=t.substring(n),e=e.substring(n),n=a(t,e);var o=t.substring(t.length-n);t=t.substring(0,t.length-n),e=e.substring(0,e.length-n);var s=i(t,e);return r&&s.unshift([f,r]),o&&s.push([f,o]),c(s),s}function i(t,e){var n;if(!t)return[[h,e]];if(!e)return[[p,t]];var i=t.length>e.length?t:e,s=t.length>e.length?e:t,u=i.indexOf(s);if(-1!=u)return n=[[h,i.substring(0,u)],[f,s],[h,i.substring(u+s.length)]],t.length>e.length&&(n[0][0]=n[2][0]=p),n;if(1==s.length)return[[p,t],[h,e]];var a=l(t,e);if(a){var c=a[0],d=a[1],g=a[2],v=a[3],m=a[4],_=r(c,g),y=r(d,v);return _.concat([[f,m]],y)}return o(t,e)}function o(t,e){for(var n=t.length,r=e.length,i=Math.ceil((n+r)/2),o=i,u=2*i,a=new Array(u),l=new Array(u),c=0;u>c;c++)a[c]=-1,l[c]=-1;a[o+1]=0,l[o+1]=0;for(var f=n-r,d=f%2!=0,g=0,v=0,m=0,_=0,y=0;i>y;y++){for(var b=-y+g;y-v>=b;b+=2){var x,E=o+b;x=b==-y||b!=y&&a[E-1]<a[E+1]?a[E+1]:a[E-1]+1;for(var w=x-b;n>x&&r>w&&t.charAt(x)==e.charAt(w);)x++,w++;if(a[E]=x,x>n)v+=2;else if(w>r)g+=2;else if(d){var T=o+f-b;if(T>=0&&u>T&&-1!=l[T]){var k=n-l[T];if(x>=k)return s(t,e,x,w)}}}for(var A=-y+m;y-_>=A;A+=2){var k,T=o+A;k=A==-y||A!=y&&l[T-1]<l[T+1]?l[T+1]:l[T-1]+1;for(var L=k-A;n>k&&r>L&&t.charAt(n-k-1)==e.charAt(r-L-1);)k++,L++;if(l[T]=k,k>n)_+=2;else if(L>r)m+=2;else if(!d){var E=o+f-A;if(E>=0&&u>E&&-1!=a[E]){var x=a[E],w=o+x-E;if(k=n-k,x>=k)return s(t,e,x,w)}}}}return[[p,t],[h,e]]}function s(t,e,n,i){var o=t.substring(0,n),s=e.substring(0,i),u=t.substring(n),a=e.substring(i),l=r(o,s),c=r(u,a);return l.concat(c)}function u(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,o=0;i>n;)t.substring(o,i)==e.substring(o,i)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i}function a(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,o=0;i>n;)t.substring(t.length-i,t.length-o)==e.substring(e.length-i,e.length-o)?(n=i,o=n):r=i,i=Math.floor((r-n)/2+n);return i}function l(t,e){function n(t,e,n){for(var r,i,o,s,l=t.substring(n,n+Math.floor(t.length/4)),c=-1,p="";-1!=(c=e.indexOf(l,c+1));){var h=u(t.substring(n),e.substring(c)),f=a(t.substring(0,n),e.substring(0,c));p.length<f+h&&(p=e.substring(c-f,c)+e.substring(c,c+h),r=t.substring(0,n-f),i=t.substring(n+h),o=e.substring(0,c-f),s=e.substring(c+h))}return 2*p.length>=t.length?[r,i,o,s,p]:null}var r=t.length>e.length?t:e,i=t.length>e.length?e:t;if(r.length<4||2*i.length<r.length)return null;var o,s=n(r,i,Math.ceil(r.length/4)),l=n(r,i,Math.ceil(r.length/2));if(!s&&!l)return null;o=l?s&&s[4].length>l[4].length?s:l:s;var c,p,h,f;t.length>e.length?(c=o[0],p=o[1],h=o[2],f=o[3]):(h=o[0],f=o[1],c=o[2],p=o[3]);var d=o[4];return[c,p,h,f,d]}function c(t){t.push([f,""]);for(var e,n=0,r=0,i=0,o="",s="";n<t.length;)switch(t[n][0]){case h:i++,s+=t[n][1],n++;break;case p:r++,o+=t[n][1],n++;break;case f:r+i>1?(0!==r&&0!==i&&(e=u(s,o),0!==e&&(n-r-i>0&&t[n-r-i-1][0]==f?t[n-r-i-1][1]+=s.substring(0,e):(t.splice(0,0,[f,s.substring(0,e)]),n++),s=s.substring(e),o=o.substring(e)),e=a(s,o),0!==e&&(t[n][1]=s.substring(s.length-e)+t[n][1],s=s.substring(0,s.length-e),o=o.substring(0,o.length-e))),0===r?t.splice(n-i,r+i,[h,s]):0===i?t.splice(n-r,r+i,[p,o]):t.splice(n-r-i,r+i,[p,o],[h,s]),n=n-r-i+(r?1:0)+(i?1:0)+1):0!==n&&t[n-1][0]==f?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,i=0,r=0,o="",s=""}""===t[t.length-1][1]&&t.pop();var l=!1;for(n=1;n<t.length-1;)t[n-1][0]==f&&t[n+1][0]==f&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),l=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),l=!0)),n++;l&&c(t)}var p=-1,h=1,f=0,d=r;d.INSERT=h,d.DELETE=p,d.EQUAL=f,e.exports=d},{}],7:[function(t,e,n){e.exports={version:"0.20.0"}},{}],8:[function(t,e,n){var r,i,o,s,u,a,l,c;l=t("lodash"),r=t("rich-text/lib/delta"),c=t("../lib/dom"),o=t("./format"),s=t("./line"),u=t("../lib/linked-list"),a=t("./normalizer"),i=function(){function t(t,e){this.root=t,null==e&&(e={}),this.normalizer=new a,this.formats={},l.each(e.formats,l.bind(this.addFormat,this)),this.setHTML(this.root.innerHTML)}return t.prototype.addFormat=function(t,e){return l.isObject(e)||(e=o.FORMATS[t]),null!=this.formats[t]&&console.warn("Overwriting format",t,this.formats[t]),this.formats[t]=new o(e),this.normalizer.addFormat(e)},t.prototype.appendLine=function(t){return this.insertLineBefore(t,null)},t.prototype.findLeafAt=function(t,e){var n,r,i;return i=this.findLineAt(t),n=i[0],r=i[1],null!=n?n.findLeafAt(r,e):[void 0,r]},t.prototype.findLine=function(t){for(var e;null!=t&&null==c.BLOCK_TAGS[t.tagName];)t=t.parentNode;return e=null!=t?c(t).data(s.DATA_KEY):void 0,(null!=e?e.node:void 0)===t?e:void 0},t.prototype.findLineAt=function(t){var e,n;if(!(this.lines.length>0))return[void 0,t];if(n=this.toDelta().length(),t===n)return[this.lines.last,this.lines.last.length];if(t>n)return[void 0,t-n];for(e=this.lines.first;null!=e;){if(t<e.length)return[e,t];t-=e.length,e=e.next}return[void 0,t]},t.prototype.getHTML=function(){return this.root.innerHTML.replace(/\>\s+\</g,">&nbsp;<")},t.prototype.insertLineBefore=function(t,e){var n;return n=new s(this,t),null!=e?(c(t.parentNode).isElement()||this.root.insertBefore(t,e.node),this.lines.insertAfter(e.prev,n)):(c(t.parentNode).isElement()||this.root.appendChild(t),this.lines.append(n)),n},t.prototype.mergeLines=function(t,e){return e.length>1&&(1===t.length&&c(t.leaves.last.node).remove(),l.each(c(e.node).childNodes(),function(e){return e.tagName!==c.DEFAULT_BREAK_TAG?t.node.appendChild(e):void 0})),this.removeLine(e),t.rebuild()},t.prototype.optimizeLines=function(){return l.each(this.lines.toArray(),function(t,e){return t.optimize(),!0})},t.prototype.rebuild=function(){var t,e,n;for(e=this.lines.toArray(),t=this.root.firstChild,null!=t&&null!=c.LIST_TAGS[t.tagName]&&(t=t.firstChild),l.each(e,function(e){return function(n,r){for(var i,o;n.node!==t;){if(n.node.parentNode!==e.root&&(null!=(o=n.node.parentNode)?o.parentNode:void 0)!==e.root)return e.removeLine(n);t=e.normalizer.normalizeLine(t),i=e.insertLineBefore(t,n),t=c(t).nextLineNode(e.root)}return n.outerHTML!==t.outerHTML&&(n.node=e.normalizer.normalizeLine(n.node),n.rebuild()),t=c(t).nextLineNode(e.root)}}(this)),n=[];null!=t;)t=this.normalizer.normalizeLine(t),this.appendLine(t),n.push(t=c(t).nextLineNode(this.root));return n},t.prototype.removeLine=function(t){return null!=t.node.parentNode&&(c.LIST_TAGS[t.node.parentNode.tagName]&&1===t.node.parentNode.childNodes.length?c(t.node.parentNode).remove():c(t.node).remove()),this.lines.remove(t)},t.prototype.setHTML=function(t){return t=a.stripComments(t),t=a.stripWhitespace(t),this.root.innerHTML=t,this.lines=new u,this.rebuild()},t.prototype.splitLine=function(t,e){var n,r,i,o;return e=Math.min(e,t.length-1),o=c(t.node).split(e,!0),n=o[0],r=o[1],t.node=n,t.rebuild(),i=this.insertLineBefore(r,t.next),i.formats=l.clone(t.formats),i.resetContent(),i},t.prototype.toDelta=function(){var t,e;return e=this.lines.toArray(),t=new r,l.each(e,function(e){return l.each(e.delta.ops,function(e){return t.push(e)})}),t},t}(),e.exports=i},{"../lib/dom":17,"../lib/linked-list":18,"./format":10,"./line":12,"./normalizer":13,lodash:1,"rich-text/lib/delta":3}],9:[function(t,e,n){var r,i,o,s,u,a,l;a=t("lodash"),r=t("rich-text/lib/delta"),l=t("../lib/dom"),i=t("./document"),s=t("./line"),u=t("./selection"),o=function(){function t(t,e,n){this.root=t,this.quill=e,this.options=null!=n?n:{},this.root.setAttribute("id",this.options.id),this.doc=new i(this.root,this.options),this.delta=this.doc.toDelta(),this.length=this.delta.length(),this.selection=new u(this.doc,this.quill),this.timer=setInterval(a.bind(this.checkUpdate,this),this.options.pollInterval),this.savedRange=null,this.quill.on("selection-change",function(t){return function(e){return t.savedRange=e}}(this)),this.options.readOnly||this.enable()}return t.sources={API:"api",SILENT:"silent",USER:"user"},t.prototype.destroy=function(){return clearInterval(this.timer)},t.prototype.disable=function(){return this.enable(!1)},t.prototype.enable=function(t){return null==t&&(t=!0),this.root.setAttribute("contenteditable",t)},t.prototype.applyDelta=function(e,n){var r;return r=this._update(),r&&(e=r.transform(e,!0),r=e.transform(r,!1)),e.ops.length>0&&(e=this._trackDelta(function(t){return function(){var n;return n=0,a.each(e.ops,function(e){return a.isString(e.insert)?(t._insertAt(n,e.insert,e.attributes),n+=e.insert.length):a.isNumber(e.insert)?(t._insertEmbed(n,e.attributes),n+=1):a.isNumber(e["delete"])?t._deleteAt(n,e["delete"]):a.isNumber(e.retain)?(a.each(e.attributes,function(r,i){return t._formatAt(n,e.retain,i,r)}),n+=e.retain):void 0}),t.selection.shiftAfter(0,0,a.bind(t.doc.optimizeLines,t.doc))}}(this)),this.delta=this.doc.toDelta(),this.length=this.delta.length(),this.innerHTML=this.root.innerHTML,e&&n!==t.sources.SILENT&&this.quill.emit(this.quill.constructor.events.TEXT_CHANGE,e,n)),r&&r.ops.length>0&&n!==t.sources.SILENT?this.quill.emit(this.quill.constructor.events.TEXT_CHANGE,r,t.sources.USER):void 0},t.prototype.checkUpdate=function(e){var n;return null==e&&(e="user"),null==this.root.parentNode?clearInterval(this.timer):(n=this._update(),n&&(this.delta=this.delta.compose(n),this.length=this.delta.length(),this.quill.emit(this.quill.constructor.events.TEXT_CHANGE,n,e)),n&&(e=t.sources.SILENT),this.selection.update(e))},t.prototype.focus=function(){return null!=this.selection.range?this.selection.setRange(this.selection.range):this.root.focus()},t.prototype.getBounds=function(t){var e,n,r,i,o,s,u;return this.checkUpdate(),s=this.doc.findLeafAt(t,!0),r=s[0],i=s[1],null==r?null:(n=this.root.parentNode.getBoundingClientRect(),u="left",0===r.length?e=r.node.parentNode.getBoundingClientRect():l.VOID_TAGS[r.node.tagName]?(e=r.node.getBoundingClientRect(),1===i&&(u="right")):(o=document.createRange(),i<r.length?(o.setStart(r.node,i),o.setEnd(r.node,i+1)):(o.setStart(r.node,i-1),o.setEnd(r.node,i),u="right"),e=o.getBoundingClientRect()),{height:e.height,left:e[u]-n.left,top:e.top-n.top})},t.prototype._deleteAt=function(t,e){return 0>=e?void 0:this.selection.shiftAfter(t,-1*e,function(n){return function(){var r,i,o,s,u,a,l;for(l=n.doc.findLineAt(t),o=l[0],a=l[1],r=o,s=o.length-a<=e&&a>0;null!=r&&e>0;)u=r.next,i=Math.min(r.length-a,e),0===a&&e>=r.length?n.doc.removeLine(r):r.deleteText(a,i),e-=i,r=u,a=0;return s&&o.next?n.doc.mergeLines(o,o.next):void 0}}(this))},t.prototype._formatAt=function(t,e,n,r){return this.selection.shiftAfter(t,0,function(i){return function(){var o,s,u,a,l;for(a=i.doc.findLineAt(t),s=a[0],u=a[1],l=[];null!=s&&e>0;)o=Math.min(e,s.length-u-1),s.formatText(u,o,n,r),e-=o,e>0&&s.format(n,r),e-=1,u=0,l.push(s=s.next);return l}}(this))},t.prototype._insertEmbed=function(t,e){return this.selection.shiftAfter(t,1,function(n){return function(){var r,i,o;return o=n.doc.findLineAt(t),r=o[0],i=o[1],r.insertEmbed(i,e)}}(this))},t.prototype._insertAt=function(t,e,n){return null==n&&(n={}),this.selection.shiftAfter(t,e.length,function(r){return function(){var i,o,s,u;return e=e.replace(/\r\n?/g,"\n"),o=e.split("\n"),u=r.doc.findLineAt(t),i=u[0],s=u[1],a.each(o,function(t,e){var u;return null==i||i.length<=s?(e<o.length-1||t.length>0)&&(i=r.doc.appendLine(document.createElement(l.DEFAULT_BLOCK_TAG)),s=0,i.insertText(s,t,n),i.format(n),u=null):(i.insertText(s,t,n),e<o.length-1&&(u=r.doc.splitLine(i,s+t.length),a.each(a.defaults({},n,i.formats),function(t,e){return i.format(e,n[e])}),s=0)),i=u})}}(this))},t.prototype._trackDelta=function(t){var e,n,r,i,o,s,u,l,c,p;s=null!=(c=this.savedRange)?c.start:void 0,t(),n=this.doc.toDelta(),this.savedRange=this.selection.getRange(),r=null!=(p=this.savedRange)?p.start:void 0;try{if(null!=s&&null!=r&&s<=this.delta.length()&&r<=n.length()&&(l=this.delta.slice(s),o=n.slice(r),a.isEqual(l.ops,o.ops)))return u=this.delta.slice(0,s),i=n.slice(0,r),u.diff(i)}catch(h){e=h}return this.delta.diff(n)},t.prototype._update=function(){var t;return this.innerHTML===this.root.innerHTML?!1:(t=this._trackDelta(function(t){return function(){return t.selection.preserve(a.bind(t.doc.rebuild,t.doc)),t.selection.shiftAfter(0,0,a.bind(t.doc.optimizeLines,t.doc))}}(this)),this.innerHTML=this.root.innerHTML,t.ops.length>0?t:!1)},t}(),e.exports=o},{"../lib/dom":17,"./document":8,"./line":12,"./selection":14,lodash:1,"rich-text/lib/delta":3}],10:[function(t,e,n){var r,i,o;i=t("lodash"),o=t("../lib/dom"),r=function(){function t(t){this.config=t}return t.types={LINE:"line",EMBED:"embed"},t.FORMATS={bold:{tag:"B",prepare:"bold"},italic:{tag:"I",prepare:"italic"},underline:{tag:"U",prepare:"underline"},strike:{tag:"S",prepare:"strikeThrough"},color:{style:"color","default":"rgb(0, 0, 0)",prepare:"foreColor"},background:{style:"backgroundColor","default":"rgb(255, 255, 255)",prepare:"backColor"},font:{style:"fontFamily","default":"'Helvetica', 'Arial', sans-serif",prepare:"fontName"},size:{style:"fontSize","default":"13px",prepare:function(t){return document.execCommand("fontSize",!1,o.convertFontSize(t))}},link:{tag:"A",add:function(t,e){return t.setAttribute("href",e),t},remove:function(t){return t.removeAttribute("href"),t},value:function(t){return t.getAttribute("href")}},image:{type:t.types.EMBED,tag:"IMG",attribute:"src"},align:{type:t.types.LINE,style:"textAlign","default":"left"},bullet:{type:t.types.LINE,exclude:"list",parentTag:"UL",tag:"LI"},list:{type:t.types.LINE,exclude:"bullet",parentTag:"OL",tag:"LI"}},t.prototype.add=function(e,n){var r,s,u,a,l;return n?this.value(e)===n?e:(i.isString(this.config.parentTag)&&(u=e.parentNode,u.tagName!==this.config.parentTag&&(u=document.createElement(this.config.parentTag),o(e).wrap(u)),e.parentNode.tagName===(null!=(a=e.parentNode.previousSibling)?a.tagName:void 0)&&o(e.parentNode.previousSibling).merge(e.parentNode),e.parentNode.tagName===(null!=(l=e.parentNode.nextSibling)?l.tagName:void 0)&&o(e.parentNode).merge(e.parentNode.nextSibling)),i.isString(this.config.tag)&&e.tagName!==this.config.tag&&(r=document.createElement(this.config.tag),null!=o.VOID_TAGS[r.tagName]?(null!=e.parentNode&&o(e).replace(r),e=r):this.isType(t.types.LINE)?e=o(e).switchTag(this.config.tag).get():(o(e).wrap(r),e=r)),(i.isString(this.config.style)||i.isString(this.config.attribute)||i.isString(this.config["class"]))&&(i.isString(this.config["class"])&&(e=this.remove(e)),o(e).isTextNode()&&(s=document.createElement(o.DEFAULT_INLINE_TAG),o(e).wrap(s),e=s),i.isString(this.config.style)&&n!==this.config["default"]&&(e.style[this.config.style]=n),i.isString(this.config.attribute)&&e.setAttribute(this.config.attribute,n),i.isString(this.config["class"])&&o(e).addClass(this.config["class"]+n)),i.isFunction(this.config.add)&&(e=this.config.add(e,n)),e):this.remove(e)},t.prototype.isType=function(t){return t===this.config.type},t.prototype.match=function(t){var e,n,r,s,u;if(!o(t).isElement())return!1;if(i.isString(this.config.parentTag)&&(null!=(s=t.parentNode)?s.tagName:void 0)!==this.config.parentTag)return!1;if(i.isString(this.config.tag)&&t.tagName!==this.config.tag)return!1;if(i.isString(this.config.style)&&(!t.style[this.config.style]||t.style[this.config.style]===this.config["default"]))return!1;if(i.isString(this.config.attribute)&&!t.hasAttribute(this.config.attribute))return!1;if(i.isString(this.config["class"])){for(u=o(t).classes(),n=0,r=u.length;r>n;n++)if(e=u[n],0===e.indexOf(this.config["class"]))return!0;return!1}return!0},t.prototype.prepare=function(t){return i.isString(this.config.prepare)?document.execCommand(this.config.prepare,!1,t):i.isFunction(this.config.prepare)?this.config.prepare(t):void 0},t.prototype.remove=function(e){var n,r,s,u;if(!this.match(e))return e;if(i.isString(this.config.style)&&(e.style[this.config.style]="",e.getAttribute("style")||e.removeAttribute("style")),i.isString(this.config.attribute)&&e.removeAttribute(this.config.attribute),i.isString(this.config["class"]))for(u=o(e).classes(),r=0,s=u.length;s>r;r++)n=u[r],0===n.indexOf(this.config["class"])&&o(e).removeClass(n);if(i.isString(this.config.tag))if(this.isType(t.types.LINE))i.isString(this.config.parentTag)&&(null!=e.previousSibling&&o(e).splitBefore(e.parentNode.parentNode),null!=e.nextSibling&&o(e.nextSibling).splitBefore(e.parentNode.parentNode)),e=o(e).switchTag(o.DEFAULT_BLOCK_TAG).get();else{if(this.isType(t.types.EMBED))return void o(e).remove();e=o(e).switchTag(o.DEFAULT_INLINE_TAG).get()}return i.isString(this.config.parentTag)&&o(e.parentNode).unwrap(),i.isFunction(this.config.remove)&&(e=this.config.remove(e)),e.tagName!==o.DEFAULT_INLINE_TAG||e.hasAttributes()||(e=o(e).unwrap()),e},t.prototype.value=function(t){var e,n,r,s;if(!this.match(t))return void 0;if(this.config.value)return this.config.value(t);if(i.isString(this.config.attribute))return t.getAttribute(this.config.attribute)||void 0;if(i.isString(this.config.style))return t.style[this.config.style]||void 0;if(i.isString(this.config["class"])){for(s=o(t).classes(),n=0,r=s.length;r>n;n++)if(e=s[n],0===e.indexOf(this.config["class"]))return e.slice(this.config["class"].length)}else if(i.isString(this.config.tag))return!0;return void 0},t}(),e.exports=r},{"../lib/dom":17,lodash:1}],11:[function(t,e,n){var r,i,o,s,u,a=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;s=t("lodash"),u=t("../lib/dom"),r=t("./format"),o=t("../lib/linked-list"),i=function(t){function e(t,n){this.node=t,this.formats=s.clone(n),this.text=u(this.node).text(),this.length=this.text.length,u(this.node).data(e.DATA_KEY,this)}return a(e,t),e.DATA_KEY="leaf",e.isLeafNode=function(t){return u(t).isTextNode()||null==t.firstChild},e.prototype.deleteText=function(t,n){var r;if(n>0)return this.text=this.text.slice(0,t)+this.text.slice(t+n),this.length=this.text.length,null!=u.EMBED_TAGS[this.node.tagName]?(r=document.createTextNode(this.text),u(r).data(e.DATA_KEY,this),this.node=u(this.node).replace(r).get()):u(this.node).text(this.text)},e.prototype.insertText=function(t,n){var r;return this.text=this.text.slice(0,t)+n+this.text.slice(t),u(this.node).isTextNode()?u(this.node).text(this.text):(r=document.createTextNode(n),u(r).data(e.DATA_KEY,this),this.node.tagName===u.DEFAULT_BREAK_TAG?this.node=u(this.node).replace(r).get():(this.node.appendChild(r),this.node=r)),this.length=this.text.length},e}(o.Node),e.exports=i},{"../lib/dom":17,"../lib/linked-list":18,"./format":10,lodash:1}],12:[function(t,e,n){var r,i,o,s,u,a,l,c,p=function(t,e){function n(){this.constructor=t}for(var r in e)h.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},h={}.hasOwnProperty;l=t("lodash"),r=t("rich-text/lib/delta"),c=t("../lib/dom"),i=t("./format"),o=t("./leaf"),s=t("./line"),u=t("../lib/linked-list"),a=t("./normalizer"),s=function(t){function e(t,n){this.doc=t,this.node=n,this.formats={},this.rebuild(),e.__super__.constructor.call(this,this.node)}return p(e,t),e.DATA_KEY="line",e.prototype.buildLeaves=function(t,e){return l.each(c(t).childNodes(),function(t){return function(n){var r;return n=t.doc.normalizer.normalizeNode(n),r=l.clone(e),l.each(t.doc.formats,function(t,e){return!t.isType(i.types.LINE)&&t.match(n)?r[e]=t.value(n):void 0}),o.isLeafNode(n)?t.leaves.append(new o(n,r)):t.buildLeaves(n,r)}}(this))},e.prototype.deleteText=function(t,e){var n,r,i;if(e>0){for(i=this.findLeafAt(t),r=i[0],t=i[1];null!=r&&e>0;)n=Math.min(e,r.length-t),r.deleteText(t,n),e-=n,r=r.next,t=0;return this.rebuild()}},e.prototype.findLeaf=function(t){return null!=t?c(t).data(o.DATA_KEY):void 0},e.prototype.findLeafAt=function(t,e){var n;if(null==e&&(e=!1),t>=this.length-1)return[this.leaves.last,this.leaves.last.length];for(n=this.leaves.first;null!=n;){if(t<n.length||t===n.length&&e)return[n,t];t-=n.length,n=n.next}return[this.leaves.last,t-this.leaves.last.length]},e.prototype.format=function(t,e){var n;return l.isObject(t)?n=t:(n={},n[t]=e),l.each(n,function(t){return function(e,n){var r,o;return o=t.doc.formats[n],null!=o?(o.isType(i.types.LINE)&&(o.config.exclude&&t.formats[o.config.exclude]&&(r=t.doc.formats[o.config.exclude],null!=r&&(t.node=r.remove(t.node),delete t.formats[o.config.exclude])),t.node=o.add(t.node,e)),e?t.formats[n]=e:delete t.formats[n]):void 0}}(this)),this.resetContent()},e.prototype.formatText=function(t,e,n,r){var o,s,u,a,l,p,h,f,d,g;if(p=this.findLeafAt(t),s=p[0],u=p[1],o=this.doc.formats[n],null!=o&&o.config.type!==i.types.LINE){for(;null!=s&&e>0;){if(l=s.next,r&&s.formats[n]!==r||!r&&null!=s.formats[n]){if(g=s.node,null!=s.formats[n]){for(c(g).splitBefore(this.node);!o.match(g);)g=g.parentNode;c(g).split(s.length)}u>0&&(h=c(g).split(u),a=h[0],g=h[1]),s.length>u+e&&(f=c(g).split(e),g=f[0],d=f[1]),o.add(g,r)}e-=s.length-u,u=0,s=l}return this.rebuild()}},e.prototype._insert=function(t,e,n){var r,i,o,s,u,a;return u=this.findLeafAt(t),r=u[0],i=u[1],e=l.reduce(n,function(t){return function(e,n,r){var i;return i=t.doc.formats[r],null!=i&&(e=i.add(e,n)),e}}(this),e),a=c(r.node).split(i),s=a[0],o=a[1],o&&(o=c(o).splitBefore(this.node).get()),this.node.insertBefore(e,o),this.rebuild()},e.prototype.insertEmbed=function(t,e){var n,r,o,s,u,a,p,h;return p=this.findLeafAt(t),r=p[0],o=p[1],h=c(r.node).split(o),a=h[0],s=h[1],n=l.find(Object.keys(e),function(t){return function(e){return t.doc.formats[e].isType(i.types.EMBED)}}(this)),u=this.doc.formats[n].add({},e[n]),e=l.clone(e),delete e[n],this._insert(t,u,e)},e.prototype.insertText=function(t,e,n){var r,i,o;return null==n&&(n={}),e.length>0?(o=this.findLeafAt(t),r=o[0],i=o[1],l.isEqual(r.formats,n)?(r.insertText(i,e),this.resetContent()):this._insert(t,document.createTextNode(e),n)):void 0},e.prototype.optimize=function(){return a.optimizeLine(this.node),this.rebuild()},e.prototype.rebuild=function(t){return null==t&&(t=!1),!t&&null!=this.outerHTML&&this.outerHTML===this.node.outerHTML&&l.all(this.leaves.toArray(),function(t){return function(e){return c(e.node).isAncestor(t.node)}}(this))?!1:(this.node=this.doc.normalizer.normalizeNode(this.node),0!==c(this.node).length()||this.node.querySelector(c.DEFAULT_BREAK_TAG)||this.node.appendChild(document.createElement(c.DEFAULT_BREAK_TAG)),this.leaves=new u,this.formats=l.reduce(this.doc.formats,function(t){return function(e,n,r){return n.isType(i.types.LINE)&&(n.match(t.node)?e[r]=n.value(t.node):delete e[r]),e}}(this),this.formats),this.buildLeaves(this.node,{}),this.resetContent(),!0)},e.prototype.resetContent=function(){return c(this.node).data(e.DATA_KEY,this),this.outerHTML=this.node.outerHTML,this.length=1,this.delta=new r,l.each(this.leaves.toArray(),function(t){return function(e){return t.length+=e.length,null!=c.EMBED_TAGS[e.node.tagName]?t.delta.insert(1,e.formats):t.delta.insert(e.text,e.formats)}}(this)),this.delta.insert("\n",this.formats)},e}(u.Node),e.exports=s},{"../lib/dom":17,"../lib/linked-list":18,"./format":10,"./leaf":11,"./line":12,"./normalizer":13,lodash:1,"rich-text/lib/delta":3}],13:[function(t,e,n){var r,i,o,s;i=t("lodash"),s=t("../lib/dom"),o=function(t){return t=t.replace(/(?:^|[-_])(\w)/g,function(t,e){return e?e.toUpperCase():""}),t.charAt(0).toLowerCase()+t.slice(1)},r=function(){function t(){this.whitelist={styles:{},tags:{}},this.whitelist.tags[s.DEFAULT_BREAK_TAG]=!0,this.whitelist.tags[s.DEFAULT_BLOCK_TAG]=!0,this.whitelist.tags[s.DEFAULT_INLINE_TAG]=!0}return t.ALIASES={STRONG:"B",EM:"I",DEL:"S",STRIKE:"S"},t.ATTRIBUTES={color:"color",face:"fontFamily",size:"fontSize"},t.prototype.addFormat=function(t){return null!=t.tag&&(this.whitelist.tags[t.tag]=!0),null!=t.parentTag&&(this.whitelist.tags[t.parentTag]=!0),
null!=t.style?this.whitelist.styles[t.style]=!0:void 0},t.prototype.normalizeLine=function(e){return e=t.wrapInline(e),e=t.handleBreaks(e),"LI"===e.tagName&&t.flattenList(e),e=t.pullBlocks(e),e=this.normalizeNode(e),t.unwrapText(e),null!=e&&null!=s.LIST_TAGS[e.tagName]&&(e=e.firstChild),e},t.prototype.normalizeNode=function(e){return s(e).isTextNode()?e:(i.each(t.ATTRIBUTES,function(t,n){var r;return e.hasAttribute(n)?(r=e.getAttribute(n),"size"===n&&(r=s.convertFontSize(r)),e.style[t]=r,e.removeAttribute(n)):void 0}),"bold"===e.style.fontWeight&&(e.style.fontWeight="",s(e).wrap(document.createElement("b"))),this.whitelistStyles(e),this.whitelistTags(e))},t.prototype.whitelistStyles=function(t){var e,n;return e=s(t).styles(),n=i.omit(e,function(t){return function(e,n){return null==t.whitelist.styles[o(n)]}}(this)),Object.keys(n).length<Object.keys(e).length?Object.keys(n).length>0?s(t).styles(n,!0):t.removeAttribute("style"):void 0},t.prototype.whitelistTags=function(e){return s(e).isElement()?(null!=t.ALIASES[e.tagName]?e=s(e).switchTag(t.ALIASES[e.tagName]).get():null==this.whitelist.tags[e.tagName]&&(e=null!=s.BLOCK_TAGS[e.tagName]?s(e).switchTag(s.DEFAULT_BLOCK_TAG).get():e.hasAttributes()||null==e.firstChild?s(e).switchTag(s.DEFAULT_INLINE_TAG).get():s(e).unwrap()),e):e},t.flattenList=function(t){var e,n,r;return r=t.nextSibling,e=i.map(t.querySelectorAll("li")),e.forEach(function(e){return t.parentNode.insertBefore(e,r),r=e.nextSibling}),n=i.map(t.querySelectorAll(Object.keys(s.LIST_TAGS).join(","))),n.forEach(function(t){return s(t).remove()})},t.handleBreaks=function(t){var e;return e=i.map(t.querySelectorAll(s.DEFAULT_BREAK_TAG)),i.each(e,function(e){return function(e){return null==e.nextSibling||s.isIE(10)&&null==e.previousSibling?void 0:s(e.nextSibling).splitBefore(t.parentNode)}}(this)),t},t.optimizeLine=function(t){var e,n,r,o;for(t.normalize(),e=s(t).length(),r=s(t).descendants(),o=[];r.length>0;)n=r.pop(),null!=(null!=n?n.parentNode:void 0)&&null==s.EMBED_TAGS[n.tagName]&&(n.tagName===s.DEFAULT_BREAK_TAG?0!==e?o.push(s(n).remove()):o.push(void 0):0===s(n).length()?(r.push(n.nextSibling),o.push(s(n).unwrap())):null!=n.previousSibling&&n.tagName===n.previousSibling.tagName&&i.isEqual(s(n).attributes(),s(n.previousSibling).attributes())?(r.push(n.firstChild),o.push(s(n.previousSibling).merge(n))):o.push(void 0));return o},t.pullBlocks=function(e){var n;for(n=e.firstChild;null!=n;){if(null!=s.BLOCK_TAGS[n.tagName]&&"LI"!==n.tagName){s(n).isolate(e.parentNode),null!=s.LIST_TAGS[n.tagName]&&n.firstChild?(s(n.parentNode).unwrap(),null==e.parentNode&&(e=n)):(s(n).unwrap(),t.pullBlocks(e));break}n=n.nextSibling}return e},t.stripComments=function(t){return t.replace(/<!--[\s\S]*?-->/g,"")},t.stripWhitespace=function(t){return t=t.trim(),t=t.replace(/(\r?\n|\r)+/g," "),t=t.replace(/\>\s+\</g,"><")},t.wrapInline=function(t){var e,n;if(null!=s.BLOCK_TAGS[t.tagName])return t;for(e=document.createElement(s.DEFAULT_BLOCK_TAG),t.parentNode.insertBefore(e,t);null!=t&&null==s.BLOCK_TAGS[t.tagName];)n=t.nextSibling,e.appendChild(t),t=n;return e},t.unwrapText=function(t){var e;return e=i.map(t.querySelectorAll(s.DEFAULT_INLINE_TAG)),i.each(e,function(t){return t.hasAttributes()?void 0:s(t).unwrap()})},t}(),e.exports=r},{"../lib/dom":17,lodash:1}],14:[function(t,e,n){var r,i,o,s,u,a;u=t("lodash"),a=t("../lib/dom"),r=t("./leaf"),i=t("./normalizer"),o=t("../lib/range"),s=function(){function t(t,e){this.doc=t,this.emitter=e,this.focus=!1,this.range=new o(0,0),this.nullDelay=!1,this.update("silent")}return t.prototype.checkFocus=function(){return document.activeElement===this.doc.root},t.prototype.getRange=function(t){var e,n,r;return null==t&&(t=!1),this.checkFocus()?(n=this._getNativeRange(),null==n?null:(r=this._positionToIndex(n.startContainer,n.startOffset),e=n.startContainer===n.endContainer&&n.startOffset===n.endOffset?r:this._positionToIndex(n.endContainer,n.endOffset),new o(Math.min(r,e),Math.max(r,e)))):t?this.range:null},t.prototype.preserve=function(t){var e,n,r,i,o,s,u,a,l;return r=this._getNativeRange(),null!=r&&this.checkFocus()?(i=this._encodePosition(r.startContainer,r.startOffset),a=i[0],l=i[1],o=this._encodePosition(r.endContainer,r.endOffset),e=o[0],n=o[1],t(),s=this._decodePosition(a,l),a=s[0],l=s[1],u=this._decodePosition(e,n),e=u[0],n=u[1],this._setNativeRange(a,l,e,n)):t()},t.prototype.setRange=function(t,e){var n,r,i,o,s,u,a;return null!=t?(i=this._indexToPosition(t.start),u=i[0],a=i[1],t.isCollapsed()?(o=[u,a],n=o[0],r=o[1]):(s=this._indexToPosition(t.end),n=s[0],r=s[1]),this._setNativeRange(u,a,n,r)):this._setNativeRange(null),this.update(e)},t.prototype.shiftAfter=function(t,e,n){var r;return r=this.getRange(),n(),null!=r?(r.shift(t,e),this.setRange(r,"silent")):void 0},t.prototype.update=function(t){var e,n,r,i;return n=this.checkFocus(),r=this.getRange(!0),e="silent"!==t&&(!o.compare(r,this.range)||n!==this.focus),i=n?r:null,null!==i||"user"!==t||this.nullDelay?(this.nullDelay=!1,this.range=r,this.focus=n,e?this.emitter.emit(this.emitter.constructor.events.SELECTION_CHANGE,i,t):void 0):this.nullDelay=!0},t.prototype._decodePosition=function(t,e){var n;return a(t).isElement()&&(n=a(t.parentNode).childNodes().indexOf(t),e+=n,t=t.parentNode),[t,e]},t.prototype._encodePosition=function(t,e){for(var n;;){if(a(t).isTextNode()||t.tagName===a.DEFAULT_BREAK_TAG||null!=a.EMBED_TAGS[t.tagName])return[t,e];if(e<t.childNodes.length)t=t.childNodes[e],e=0;else{if(0===t.childNodes.length)return null==this.doc.normalizer.whitelist.tags[t.tagName]&&(n=document.createTextNode(""),t.appendChild(n),t=n),[t,0];if(t=t.lastChild,!a(t).isElement())return[t,a(t).length()];if(t.tagName===a.DEFAULT_BREAK_TAG||null!=a.EMBED_TAGS[t.tagName])return[t,1];e=t.childNodes.length}}},t.prototype._getNativeRange=function(){var t,e;return e=document.getSelection(),(null!=e?e.rangeCount:void 0)>0&&(t=e.getRangeAt(0),a(t.startContainer).isAncestor(this.doc.root,!0)&&(t.startContainer===t.endContainer||a(t.endContainer).isAncestor(this.doc.root,!0)))?t:null},t.prototype._indexToPosition=function(t){var e,n,r;return 0===this.doc.lines.length?[this.doc.root,0]:(r=this.doc.findLeafAt(t,!0),e=r[0],n=r[1],this._decodePosition(e.node,n))},t.prototype._positionToIndex=function(t,e){var n,r,i,o,s,u;if(a.isIE(10)&&"BR"===t.tagName&&1===e&&(e=0),u=this._encodePosition(t,e),r=u[0],e=u[1],o=this.doc.findLine(r),null==o)return 0;for(n=o.findLeaf(r),s=0;null!=o.prev;)o=o.prev,s+=o.length;if(null==n)return s;for(i=0;null!=n.prev;)n=n.prev,i+=n.length;return s+i+e},t.prototype._setNativeRange=function(t,e,n,r){var i,o;if(o=document.getSelection())if(null!=t){if(this.checkFocus()||this.doc.root.focus(),i=this._getNativeRange(),null==i||t!==i.startContainer||e!==i.startOffset||n!==i.endContainer||r!==i.endOffset)return o.removeAllRanges(),i=document.createRange(),i.setStart(t,e),i.setEnd(n,r),o.addRange(i)}else if(o.removeAllRanges(),this.doc.root.blur(),a.isIE(11)&&!a.isIE(9))return document.body.focus()},t}(),e.exports=s},{"../lib/dom":17,"../lib/range":20,"./leaf":11,"./normalizer":13,lodash:1}],15:[function(t,e,n){t("./modules/authorship"),t("./modules/image-tooltip"),t("./modules/keyboard"),t("./modules/link-tooltip"),t("./modules/multi-cursor"),t("./modules/paste-manager"),t("./modules/toolbar"),t("./modules/tooltip"),t("./modules/undo-manager"),e.exports=t("./quill")},{"./modules/authorship":21,"./modules/image-tooltip":22,"./modules/keyboard":23,"./modules/link-tooltip":24,"./modules/multi-cursor":25,"./modules/paste-manager":26,"./modules/toolbar":27,"./modules/tooltip":28,"./modules/undo-manager":29,"./quill":30}],16:[function(t,e,n){var r,i,o,s=function(t,e){function n(){this.constructor=t}for(var r in e)u.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},u={}.hasOwnProperty;o=t("./dom"),i=t("./picker"),r=function(t){function e(){e.__super__.constructor.apply(this,arguments),o(this.container).addClass("ql-color-picker")}return s(e,t),e.prototype.buildItem=function(t,n,r){var i;return i=e.__super__.buildItem.call(this,t,n,r),i.style.backgroundColor=n.value,i},e}(i),e.exports=r},{"./dom":17,"./picker":19}],17:[function(t,e,n){var r,i,o,s,u,a=function(t,e){return function(){return t.apply(e,arguments)}},l=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;o=t("lodash"),u=null,i=function(){function t(t){this.node=t,this.trigger=a(this.trigger,this)}return t.prototype.addClass=function(t){return this.hasClass(t)?void 0:(null!=this.node.classList?this.node.classList.add(t):null!=this.node.className&&(this.node.className=(this.node.className+" "+t).trim()),this)},t.prototype.attributes=function(t){var e,n,r,i,s,u;if(t)return o.each(t,function(t){return function(e,n){return t.node.setAttribute(n,e)}}(this)),this;if(null==this.node.attributes)return{};for(t={},s=this.node.attributes,n=r=0,i=s.length;i>r;n=++r)u=s[n],e=this.node.attributes[n],t[e.name]=e.value;return t},t.prototype.child=function(t){var e,n;for(e=this.node.firstChild,n=s(e).length();null!=e&&!(n>t);)t-=n,e=e.nextSibling,n=s(e).length();return null==e&&(e=this.node.lastChild,t=s(e).length()),[e,t]},t.prototype.childNodes=function(){return o.map(this.node.childNodes)},t.prototype.classes=function(){return this.node.className.split(/\s+/)},t.prototype.data=function(t,e){var n;return null!=e?(null==this.node["ql-data"]&&(this.node["ql-data"]={}),this.node["ql-data"][t]=e,this):null!=(n=this.node["ql-data"])?n[t]:void 0},t.prototype.descendants=function(){return o.map(this.node.getElementsByTagName("*"))},t.prototype.get=function(){return this.node},t.prototype.hasClass=function(t){return null!=this.node.classList?this.node.classList.contains(t):null!=this.node.className?this.classes().indexOf(t)>-1:!1},t.prototype.isAncestor=function(t,e){var n;if(null==e&&(e=!1),t===this.node)return e;for(n=this.node;n;){if(n===t)return!0;n=n.parentNode}return!1},t.prototype.isElement=function(){var t;return(null!=(t=this.node)?t.nodeType:void 0)===s.ELEMENT_NODE},t.prototype.isTextNode=function(){var t;return(null!=(t=this.node)?t.nodeType:void 0)===s.TEXT_NODE},t.prototype.isolate=function(t){return null!=this.node.nextSibling&&s(this.node.nextSibling).splitBefore(t),this.splitBefore(t),this},t.prototype.length=function(){var t;return null==this.node?0:(t=this.text().length,this.isElement()&&(t+=this.node.querySelectorAll(Object.keys(s.EMBED_TAGS).join(",")).length),t)},t.prototype.merge=function(t){var e;return e=s(t),this.isElement()?(e.moveChildren(this.node),this.normalize()):this.text(this.text()+e.text()),e.remove(),this},t.prototype.moveChildren=function(t){return o.each(this.childNodes(),function(e){return t.appendChild(e)}),this},t.prototype.nextLineNode=function(t){var e;return e=this.node.nextSibling,null==e&&this.node.parentNode!==t&&(e=this.node.parentNode.nextSibling),null!=e&&null!=s.LIST_TAGS[e.tagName]&&(e=e.firstChild),e},t.prototype.normalize=function(){var t,e,n,r;for(e=this.node.firstChild;null!=e;)r=e.nextSibling,t=s(e),null!=r&&s(r).isTextNode()&&(0===t.text().length?t.remove():t.isTextNode()&&(n=r.nextSibling,t.merge(r),r=n)),e=r;return this},t.prototype.on=function(t,e){return this.node.addEventListener(t,function(n){return function(r){var i,o;return i=!u||"keydown"!==t&&"keyup"!==t?r:u,o=e.call(n.node,i),o||(r.preventDefault(),r.stopPropagation()),o}}(this)),this},t.prototype.remove=function(){var t;return null!=(t=this.node.parentNode)&&t.removeChild(this.node),this.node=null,null},t.prototype.removeClass=function(t){var e;if(this.hasClass(t))return null!=this.node.classList?this.node.classList.remove(t):null!=this.node.className&&(e=this.classes(),e.splice(e.indexOf(t),1),this.node.className=e.join(" ")),this.node.getAttribute("class")||this.node.removeAttribute("class"),this},t.prototype.replace=function(t){return this.node.parentNode.replaceChild(t,this.node),this.node=t,this},t.prototype.splitBefore=function(t,e){var n,r,i,o;if(null==e&&(e=!1),this.node===t||this.node.parentNode===t)return this;if(null!=this.node.previousSibling||e){for(i=this.node.parentNode,r=i.cloneNode(!1),i.parentNode.insertBefore(r,i.nextSibling),o=this.node;null!=o;)n=o.nextSibling,r.appendChild(o),o=n;return s(r).splitBefore(t)}return s(this.node.parentNode).splitBefore(t)},t.prototype.split=function(t,e){var n,r,i,o,u,a,l,c,p,h;if(null==e&&(e=!1),l=this.length(),t=Math.max(0,t),t=Math.min(t,l),!e&&0===t)return[this.node.previousSibling,this.node,!1];if(!e&&t===l)return[this.node,this.node.nextSibling,!1];if(this.node.nodeType===s.TEXT_NODE)return n=this.node.splitText(t),[this.node,n,!0];for(u=this.node,h=this.node.cloneNode(!1),this.node.parentNode.insertBefore(h,u.nextSibling),c=this.child(t),r=c[0],t=c[1],p=s(r).split(t),i=p[0],o=p[1];null!==o;)a=o.nextSibling,h.appendChild(o),o=a;return[u,h,!0]},t.prototype.styles=function(t,e){var n,r;return null==e&&(e=!1),t?(e||(t=o.defaults(t,this.styles())),r=o.map(t,function(t,e){return e+": "+t}).join("; ")+";",this.node.setAttribute("style",r),this):(r=this.node.getAttribute("style")||"",n=o.reduce(r.split(";"),function(t,e){var n,r,i;return r=e.split(":"),n=r[0],i=r[1],n&&i&&(n=n.trim(),i=i.trim(),t[n.toLowerCase()]=i),t},{}))},t.prototype.switchTag=function(t){var e,n;return t=t.toUpperCase(),this.node.tagName===t?this:(n=document.createElement(t),e=this.attributes(),null==s.VOID_TAGS[t]&&this.moveChildren(n),this.replace(n),this.node=n,this.attributes(e))},t.prototype.text=function(t){if(null!=t){switch(this.node.nodeType){case s.ELEMENT_NODE:this.node.textContent=t;break;case s.TEXT_NODE:this.node.data=t}return this}switch(this.node.nodeType){case s.ELEMENT_NODE:return this.node.tagName===s.DEFAULT_BREAK_TAG?"":null!=s.EMBED_TAGS[this.node.tagName]?s.EMBED_TEXT:null!=this.node.textContent?this.node.textContent:"";case s.TEXT_NODE:return this.node.data||"";default:return""}},t.prototype.textNodes=function(){var t,e,n;for(n=document.createTreeWalker(this.node,NodeFilter.SHOW_TEXT,null,!1),e=[];t=n.nextNode();)e.push(t);return e},t.prototype.toggleClass=function(t,e){return null==e&&(e=!this.hasClass(t)),e?this.addClass(t):this.removeClass(t),this},t.prototype.trigger=function(t,e){var n,r,i;return null==e&&(e={}),["keypress","keydown","keyup"].indexOf(t)<0?(n=document.createEvent("Event"),n.initEvent(t,e.bubbles,e.cancelable)):(n=document.createEvent("KeyboardEvent"),u=o.clone(e),o.isNumber(e.key)?u.which=e.key:o.isString(e.key)?u.which=e.key.toUpperCase().charCodeAt(0):u.which=0,s.isIE(10)?(i=[],e.altKey&&i.push("Alt"),e.ctrlKey&&i.push("Control"),e.metaKey&&i.push("Meta"),e.shiftKey&&i.push("Shift"),n.initKeyboardEvent(t,e.bubbles,e.cancelable,window,0,0,i.join(" "),null,null)):(r=o.isFunction(n.initKeyboardEvent)?"initKeyboardEvent":"initKeyEvent",n[r](t,e.bubbles,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,0))),this.node.dispatchEvent(n),u=null,this},t.prototype.unwrap=function(){var t,e;return e=this.node.firstChild,t=this.node.nextSibling,o.each(this.childNodes(),function(e){return function(n){return e.node.parentNode.insertBefore(n,t)}}(this)),this.remove(),e},t.prototype.wrap=function(t){var e;for(null!=this.node.parentNode&&this.node.parentNode.insertBefore(t,this.node),e=t;null!=e.firstChild;)e=t.firstChild;return e.appendChild(this.node),this},t}(),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return l(e,t),e.prototype["default"]=function(){return this.node.querySelector("option[selected]")},e.prototype.option=function(t,e){var n,r,i,s,u,a;if(null==e&&(e=!0),a=o.isElement(t)?t.value:t){for(a=a.replace(/[^\w]+/g,""),u=this.node.children,r=i=0,s=u.length;s>i;r=++i)if(n=u[r],n.value.replace(/[^\w]+/g,"")===a){this.node.selectedIndex=r;break}}else this.node.selectedIndex=-1;return e&&this.trigger("change"),this},e.prototype.reset=function(t){var e;return null==t&&(t=!0),e=this["default"](),null!=e?e.selected=!0:this.node.selectedIndex=0,t&&this.trigger("change"),this},e.prototype.value=function(){return this.node.selectedIndex>-1?this.node.options[this.node.selectedIndex].value:""},e}(i),s=function(t){return"SELECT"===(null!=t?t.tagName:void 0)?new r(t):new i(t)},s=o.extend(s,{ELEMENT_NODE:1,NOBREAK_SPACE:"&nbsp;",TEXT_NODE:3,ZERO_WIDTH_NOBREAK_SPACE:"\ufeff",DEFAULT_BLOCK_TAG:"DIV",DEFAULT_BREAK_TAG:"BR",DEFAULT_INLINE_TAG:"SPAN",EMBED_TEXT:"!",FONT_SIZES:{"10px":1,"13px":2,"16px":3,"18px":4,"24px":5,"32px":6,"48px":7},KEYS:{BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},BLOCK_TAGS:{ADDRESS:"ADDRESS",ARTICLE:"ARTICLE",ASIDE:"ASIDE",AUDIO:"AUDIO",BLOCKQUOTE:"BLOCKQUOTE",CANVAS:"CANVAS",DD:"DD",DIV:"DIV",DL:"DL",FIGCAPTION:"FIGCAPTION",FIGURE:"FIGURE",FOOTER:"FOOTER",FORM:"FORM",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",HEADER:"HEADER",HGROUP:"HGROUP",LI:"LI",OL:"OL",OUTPUT:"OUTPUT",P:"P",PRE:"PRE",SECTION:"SECTION",TABLE:"TABLE",TBODY:"TBODY",TD:"TD",TFOOT:"TFOOT",TH:"TH",THEAD:"THEAD",TR:"TR",UL:"UL",VIDEO:"VIDEO"},EMBED_TAGS:{IMG:"IMG"},LINE_TAGS:{DIV:"DIV",LI:"LI"},LIST_TAGS:{OL:"OL",UL:"UL"},VOID_TAGS:{AREA:"AREA",BASE:"BASE",BR:"BR",COL:"COL",COMMAND:"COMMAND",EMBED:"EMBED",HR:"HR",IMG:"IMG",INPUT:"INPUT",KEYGEN:"KEYGEN",LINK:"LINK",META:"META",PARAM:"PARAM",SOURCE:"SOURCE",TRACK:"TRACK",WBR:"WBR"},convertFontSize:function(t){var e,n,r,i;o.isString(t)&&t.indexOf("px")>-1?(r=Object.keys(s.FONT_SIZES),i=o.values(s.FONT_SIZES)):(i=Object.keys(s.FONT_SIZES),r=o.values(s.FONT_SIZES));for(e in r)if(n=r[e],parseInt(t)<=parseInt(n))return i[e];return o.last(i)},isIE:function(t){var e;return e=document.documentMode,e&&t>=e},isIOS:function(){return/iPhone|iPad/i.test(navigator.userAgent)},isMac:function(){return/Mac/i.test(navigator.platform)}}),e.exports=s},{lodash:1}],18:[function(t,e,n){var r,i;i=function(){function t(t){this.data=t,this.prev=this.next=null}return t}(),r=function(){function t(){this.length=0,this.first=this.last=null}return t.Node=i,t.prototype.append=function(t){return null!=this.first?(t.next=null,this.last.next=t):this.first=t,t.prev=this.last,this.last=t,this.length+=1},t.prototype.insertAfter=function(t,e){return e.prev=t,null!=t?(e.next=t.next,null!=t.next&&(t.next.prev=e),t.next=e,t===this.last&&(this.last=e)):(e.next=this.first,this.first.prev=e,this.first=e),this.length+=1},t.prototype.remove=function(t){return this.length>1?(null!=t.prev&&(t.prev.next=t.next),null!=t.next&&(t.next.prev=t.prev),t===this.first&&(this.first=t.next),t===this.last&&(this.last=t.prev)):this.first=this.last=null,t.prev=t.next=null,this.length-=1},t.prototype.toArray=function(){var t,e;for(t=[],e=this.first;null!=e;)t.push(e),e=e.next;return t},t}(),e.exports=r},{}],19:[function(t,e,n){var r,i,o;i=t("lodash"),o=t("./dom"),r=function(){function t(t){this.select=t,this.container=document.createElement("span"),this.buildPicker(),o(this.container).addClass("ql-picker"),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),o(document).on("click",function(t){return function(){return t.close(),!0}}(this)),o(this.label).on("click",function(t){return function(){return i.defer(function(){return o(t.container).toggleClass("ql-expanded")}),!1}}(this)),o(this.select).on("change",function(t){return function(){var e,n;return t.select.selectedIndex>-1&&(e=t.container.querySelectorAll(".ql-picker-item")[t.select.selectedIndex],n=t.select.options[t.select.selectedIndex]),t.selectItem(e,!1),o(t.label).toggleClass("ql-active",n!==o(t.select)["default"]())}}(this))}return t.TEMPLATE='<span class="ql-picker-label"></span><span class="ql-picker-options"></span>',t.prototype.buildItem=function(t,e,n){var r;return r=document.createElement("span"),r.setAttribute("data-value",e.getAttribute("value")),o(r).addClass("ql-picker-item").text(o(e).text()).on("click",function(t){return function(){return t.selectItem(r,!0),t.close()}}(this)),this.select.selectedIndex===n&&this.selectItem(r,!1),r},t.prototype.buildPicker=function(){var e;return i.each(o(this.select).attributes(),function(t){return function(e,n){return t.container.setAttribute(n,e)}}(this)),this.container.innerHTML=t.TEMPLATE,this.label=this.container.querySelector(".ql-picker-label"),e=this.container.querySelector(".ql-picker-options"),i.each(this.select.options,function(t){return function(n,r){var i;return i=t.buildItem(e,n,r),e.appendChild(i)}}(this))},t.prototype.close=function(){return o(this.container).removeClass("ql-expanded")},t.prototype.selectItem=function(t,e){var n,r;return n=this.container.querySelector(".ql-selected"),null!=n&&o(n).removeClass("ql-selected"),null!=t?(r=t.getAttribute("data-value"),o(t).addClass("ql-selected"),o(this.label).text(o(t).text()),o(this.select).option(r,e),this.label.setAttribute("data-value",r)):(this.label.innerHTML="&nbsp;",this.label.removeAttribute("data-value"))},t}(),e.exports=r},{"./dom":17,lodash:1}],20:[function(t,e,n){var r,i;i=t("lodash"),r=function(){function t(t,e){this.start=t,this.end=e}return t.compare=function(t,e){return t===e?!0:null==t||null==e?!1:t.equals(e)},t.prototype.equals=function(t){return null==t?!1:this.start===t.start&&this.end===t.end},t.prototype.shift=function(t,e){var n;return n=i.map([this.start,this.end],function(n){return t>n?n:e>=0?n+e:Math.max(t,n+e)}),this.start=n[0],this.end=n[1],n},t.prototype.isCollapsed=function(){return this.start===this.end},t}(),e.exports=r},{lodash:1}],21:[function(t,e,n){var r,i,o,s,u;o=t("../quill"),s=o.require("lodash"),u=o.require("dom"),i=o.require("delta"),r=function(){function t(t,e){this.quill=t,this.options=e,null!=this.options.button&&this.attachButton(this.options.button),this.options.enabled&&this.enable(),this.quill.addFormat("author",{"class":"author-"}),null!=this.options.authorId&&(this.quill.on(this.quill.constructor.events.PRE_EVENT,function(t){return function(e,n,r){var u,a;return e===t.quill.constructor.events.TEXT_CHANGE&&"user"===r?(u=new i,a={author:t.options.authorId},s.each(n.ops,function(e){return null==e["delete"]?null!=e.insert||null!=e.retain&&null!=e.attributes?(e.attributes||(e.attributes={}),e.attributes.author=t.options.authorId,u.retain(e.retain||e.insert.length||1,a)):u.retain(e.retain):void 0}),t.quill.updateContents(u,o.sources.SILENT)):void 0}}(this)),this.addAuthor(this.options.authorId,this.options.color))}return t.DEFAULTS={authorId:null,color:"transparent",enabled:!1},t.prototype.addAuthor=function(t,e){var n;return n={},n[".authorship .author-"+t]={"background-color":""+e},this.quill.theme.addStyles(n)},t.prototype.attachButton=function(t){var e;return e=u(t),e.on("click",function(t){return function(){return e.toggleClass("ql-on"),t.enable($dom.hasClass("ql-on"))}}(this))},t.prototype.enable=function(t){return null==t&&(t=!0),u(this.quill.root).toggleClass("authorship",t)},t.prototype.disable=function(){return this.enable(!1)},t}(),o.registerModule("authorship",r),e.exports=r},{"../quill":30}],22:[function(t,e,n){var r,i,o,s,u,a,l,c=function(t,e){function n(){this.constructor=t}for(var r in e)p.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},p={}.hasOwnProperty;o=t("../quill"),u=t("./tooltip"),a=o.require("lodash"),l=o.require("dom"),r=o.require("delta"),s=o.require("range"),i=function(t){function e(t,n){this.quill=t,this.options=n,this.options=a.defaults(this.options,u.DEFAULTS),e.__super__.constructor.call(this,this.quill,this.options),this.preview=this.container.querySelector(".preview"),this.textbox=this.container.querySelector(".input"),l(this.container).addClass("ql-image-tooltip"),this.initListeners()}return c(e,t),e.DEFAULTS={template:'<input class="input" type="textbox"> <div class="preview"> <span>Preview</span> </div> <a href="javascript:;" class="cancel">Cancel</a> <a href="javascript:;" class="insert">Insert</a>'},e.prototype.initListeners=function(){return l(this.quill.root).on("focus",a.bind(this.hide,this)),l(this.container.querySelector(".insert")).on("click",a.bind(this.insertImage,this)),l(this.container.querySelector(".cancel")).on("click",a.bind(this.hide,this)),l(this.textbox).on("input",a.bind(this._preview,this)),this.initTextbox(this.textbox,this.insertImage,this.hide),this.quill.onModuleLoad("toolbar",function(t){return function(e){return t.toolbar=e,e.initFormat("image",a.bind(t._onToolbar,t))}}(this))},e.prototype.insertImage=function(){var t,e;return e=this._normalizeURL(this.textbox.value),null==this.range&&(this.range=new s(0,0)),this.range&&(this.preview.innerHTML="<span>Preview</span>",this.textbox.value="",t=this.range.end,this.quill.insertEmbed(t,"image",e,"user"),this.quill.setSelection(t+1,t+1)),this.hide()},e.prototype._onToolbar=function(t,e){return e?(this.textbox.value||(this.textbox.value="http://"),this.show(),this.textbox.focus(),a.defer(function(t){return function(){return t.textbox.setSelectionRange(t.textbox.value.length,t.textbox.value.length)}}(this))):(this.quill.deleteText(t,"user"),this.toolbar.setActive("image",!1))},e.prototype._preview=function(){var t;if(this._matchImageURL(this.textbox.value))return"IMG"===this.preview.firstChild.tagName?this.preview.firstChild.setAttribute("src",this.textbox.value):(t=document.createElement("img"),t.setAttribute("src",this.textbox.value),this.preview.replaceChild(t,this.preview.firstChild))},e.prototype._matchImageURL=function(t){return/^https?:\/\/.+\.(jpe?g|gif|png)$/.test(t)},e.prototype._normalizeURL=function(t){return/^https?:\/\//.test(t)||(t="http://"+t),t},e}(u),o.registerModule("image-tooltip",i),e.exports=i},{"../quill":30,"./tooltip":28}],23:[function(t,e,n){var r,i,o,s,u;o=t("../quill"),s=o.require("lodash"),u=o.require("dom"),r=o.require("delta"),i=function(){function t(t,e){this.quill=t,this.hotkeys={},this._initListeners(),this._initHotkeys(),this.quill.onModuleLoad("toolbar",function(t){return function(e){return t.toolbar=e}}(this))}return t.hotkeys={BOLD:{key:"B",metaKey:!0},INDENT:{key:u.KEYS.TAB},ITALIC:{key:"I",metaKey:!0},OUTDENT:{key:u.KEYS.TAB,shiftKey:!0},UNDERLINE:{key:"U",metaKey:!0}},t.prototype.addHotkey=function(t,e){return Array.isArray(t)||(t=[t]),s.each(t,function(t){return function(n){var r,i;return n=s.isObject(n)?s.clone(n):{key:n},n.callback=e,i=s.isNumber(n.key)?n.key:n.key.toUpperCase().charCodeAt(0),null==(r=t.hotkeys)[i]&&(r[i]=[]),t.hotkeys[i].push(n)}}(this))},t.prototype.toggleFormat=function(t,e){var n,r;return n=t.isCollapsed()?this.quill.getContents(Math.max(0,t.start-1),t.end):this.quill.getContents(t),r=0===n.ops.length||!s.all(n.ops,function(t){var n;return null!=(n=t.attributes)?n[e]:void 0}),t.isCollapsed()?this.quill.prepareFormat(e,r,o.sources.USER):this.quill.formatText(t,e,r,o.sources.USER),null!=this.toolbar?this.toolbar.setActive(e,r):void 0},t.prototype._initEnter=function(){var t;return t=[{key:u.KEYS.ENTER},{key:u.KEYS.ENTER,shiftKey:!0}],this.addHotkey(t,function(t){return function(e,n){var i,u,a,l,c,p;return null==e?!0:(c=t.quill.editor.doc.findLineAt(e.start),a=c[0],l=c[1],p=a.findLeafAt(l),u=p[0],l=p[1],i=(new r).retain(e.start).insert("\n",a.formats)["delete"](e.end-e.start),t.quill.updateContents(i,o.sources.USER),s.each(u.formats,function(e,n){t.quill.prepareFormat(n,e),null!=t.toolbar&&t.toolbar.setActive(n,e)}),!1)}}(this))},t.prototype._initDeletes=function(){return this.addHotkey([u.KEYS.DELETE,u.KEYS.BACKSPACE],function(t){return function(e,n){var r,i,s,a;return null!=e&&t.quill.getLength()>0&&(e.start!==e.end?t.quill.deleteText(e.start,e.end,o.sources.USER):n.key===u.KEYS.BACKSPACE?(a=t.quill.editor.doc.findLineAt(e.start),i=a[0],s=a[1],0===s&&(i.formats.bullet||i.formats.list)?(r=i.formats.bullet?"bullet":"list",t.quill.formatLine(e.start,e.start,r,!1)):e.start>0&&t.quill.deleteText(e.start-1,e.start,o.sources.USER)):e.start<t.quill.getLength()-1&&t.quill.deleteText(e.start,e.start+1,o.sources.USER)),!1}}(this))},t.prototype._initHotkeys=function(){return this.addHotkey(t.hotkeys.INDENT,function(t){return function(e){return t._onTab(e,!1),!1}}(this)),this.addHotkey(t.hotkeys.OUTDENT,function(t){return function(t){return!1}}(this)),s.each(["bold","italic","underline"],function(e){return function(n){return e.addHotkey(t.hotkeys[n.toUpperCase()],function(t){return e.toggleFormat(t,n),!1})}}(this)),this._initDeletes(),this._initEnter()},t.prototype._initListeners=function(){return u(this.quill.root).on("keydown",function(t){return function(e){var n;return n=!1,s.each(t.hotkeys[e.which],function(r){var i;return i=u.isMac()?e.metaKey:e.metaKey||e.ctrlKey,!!r.metaKey==!!i&&!!r.shiftKey==!!e.shiftKey&&!!r.altKey==!!e.altKey?(n=r.callback(t.quill.getSelection(),r,e)===!1||n,!0):void 0}),!n}}(this))},t.prototype._onTab=function(t,e){var n;return null==e&&(e=!1),n=(new r).retain(t.start).insert("	")["delete"](t.end-t.start).retain(this.quill.getLength()-t.end),this.quill.updateContents(n,o.sources.USER),this.quill.setSelection(t.start+1,t.start+1)},t}(),o.registerModule("keyboard",i),e.exports=i},{"../quill":30}],24:[function(t,e,n){var r,i,o,s,u,a=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;i=t("../quill"),o=t("./tooltip"),s=i.require("lodash"),u=i.require("dom"),r=function(t){function e(t,n){this.quill=t,this.options=n,this.options=s.defaults(this.options,o.DEFAULTS),e.__super__.constructor.call(this,this.quill,this.options),u(this.container).addClass("ql-link-tooltip"),this.textbox=this.container.querySelector(".input"),this.link=this.container.querySelector(".url"),this.initListeners()}return a(e,t),e.DEFAULTS={maxLength:50,template:'<span class="title">Visit URL:&nbsp;</span> <a href="#" class="url" target="_blank" href="about:blank"></a> <input class="input" type="text"> <span>&nbsp;&#45;&nbsp;</span> <a href="javascript:;" class="change">Change</a> <a href="javascript:;" class="remove">Remove</a> <a href="javascript:;" class="done">Done</a>'},e.hotkeys={LINK:{key:"K",metaKey:!0}},e.prototype.initListeners=function(){return this.quill.on(this.quill.constructor.events.SELECTION_CHANGE,function(t){return function(e){var n;if(null!=e&&e.isCollapsed())return n=t._findAnchor(e),n?(t.setMode(n.href,!1),t.show(n)):t.container.style.left!==o.HIDE_MARGIN?(t.range=null,t.hide()):void 0}}(this)),u(this.container.querySelector(".done")).on("click",s.bind(this.saveLink,this)),u(this.container.querySelector(".remove")).on("click",function(t){return function(){return t.removeLink(t.range)}}(this)),u(this.container.querySelector(".change")).on("click",function(t){return function(){return t.setMode(t.link.href,!0)}}(this)),this.initTextbox(this.textbox,this.saveLink,this.hide),this.quill.onModuleLoad("toolbar",function(t){return function(e){return t.toolbar=e,e.initFormat("link",s.bind(t._onToolbar,t))}}(this)),this.quill.onModuleLoad("keyboard",function(t){return function(n){return n.addHotkey(e.hotkeys.LINK,s.bind(t._onKeyboard,t))}}(this))},e.prototype.saveLink=function(){var t,e,n;return n=this._normalizeURL(this.textbox.value),null!=this.range&&(e=this.range.end,this.range.isCollapsed()?(t=this._findAnchor(this.range),null!=t&&(t.href=n)):this.quill.formatText(this.range,"link",n,"user"),this.quill.setSelection(e,e)),this.setMode(n,!1)},e.prototype.removeLink=function(t){return t.isCollapsed()&&(t=this._expandRange(t)),this.hide(),this.quill.formatText(t,"link",!1,"user"),null!=this.toolbar?this.toolbar.setActive("link",!1):void 0},e.prototype.setMode=function(t,e){var n;return null==e&&(e=!1),e?(this.textbox.value=t,s.defer(function(e){return function(){return e.textbox.focus(),e.textbox.setSelectionRange(0,t.length)}}(this))):(this.link.href=t,t=this.link.href,n=t.length>this.options.maxLength?t.slice(0,this.options.maxLength)+"...":t,u(this.link).text(n)),u(this.container).toggleClass("editing",e)},e.prototype._findAnchor=function(t){var e,n,r,i;for(i=this.quill.editor.doc.findLeafAt(t.start,!0),
e=i[0],r=i[1],null!=e&&(n=e.node);null!=n&&n!==this.quill.root;){if("A"===n.tagName)return n;n=n.parentNode}return null},e.prototype._expandRange=function(t){var e,n,r,i,o;return i=this.quill.editor.doc.findLeafAt(t.start,!0),n=i[0],r=i[1],o=t.start-r,e=o+n.length,{start:o,end:e}},e.prototype._onToolbar=function(t,e){return this._toggle(t,e)},e.prototype._onKeyboard=function(){var t;return t=this.quill.getSelection(),this._toggle(t,!this._findAnchor(t))},e.prototype._toggle=function(t,e){var n;if(t)return e?t.isCollapsed()?void 0:(this.setMode(this._suggestURL(t),!0),n=this.quill.editor.selection._getNativeRange(),this.show(n)):this.removeLink(t)},e.prototype._normalizeURL=function(t){return/^(https?:\/\/|mailto:)/.test(t)||(t="http://"+t),t},e.prototype._suggestURL=function(t){var e;return e=this.quill.getText(t),this._normalizeURL(e)},e}(o),i.registerModule("link-tooltip",r),e.exports=r},{"../quill":30,"./tooltip":28}],25:[function(t,e,n){var r,i,o,s,u,a=function(t,e){function n(){this.constructor=t}for(var r in e)l.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},l={}.hasOwnProperty;o=t("../quill"),r=t("eventemitter2").EventEmitter2,s=o.require("lodash"),u=o.require("dom"),i=function(t){function e(t,e){this.quill=t,this.options=e,this.cursors={},this.container=this.quill.addContainer("ql-multi-cursor",!0),this.quill.on(this.quill.constructor.events.TEXT_CHANGE,s.bind(this._applyDelta,this))}return a(e,t),e.DEFAULTS={template:'<span class="cursor-flag"> <span class="cursor-name"></span> </span> <span class="cursor-caret"></span>',timeout:2500},e.events={CURSOR_ADDED:"cursor-addded",CURSOR_MOVED:"cursor-moved",CURSOR_REMOVED:"cursor-removed"},e.prototype.clearCursors=function(){return s.each(Object.keys(this.cursors),s.bind(this.removeCursor,this)),this.cursors={}},e.prototype.moveCursor=function(t,e){var n;return n=this.cursors[t],n.index=e,u(n.elem).removeClass("hidden"),clearTimeout(n.timer),n.timer=setTimeout(function(t){return function(){return u(n.elem).addClass("hidden"),n.timer=null}}(this),this.options.timeout),this._updateCursor(n),n},e.prototype.removeCursor=function(t){var n;return n=this.cursors[t],this.emit(e.events.CURSOR_REMOVED,n),null!=n&&n.elem.parentNode.removeChild(n.elem),delete this.cursors[t]},e.prototype.setCursor=function(t,n,r,i){var o;return null==this.cursors[t]&&(this.cursors[t]=o={userId:t,index:n,color:i,elem:this._buildCursor(r,i)},this.emit(e.events.CURSOR_ADDED,o)),s.defer(function(e){return function(){return e.moveCursor(t,n)}}(this)),this.cursors[t]},e.prototype.shiftCursors=function(t,e,n){return null==n&&(n=null),s.each(this.cursors,function(r){return function(r,i){return r&&(r.index>t||r.userId===n)?r.index+=Math.max(e,t-r.index):void 0}}(this))},e.prototype.update=function(){return s.each(this.cursors,function(t){return function(e,n){return null!=e?(t._updateCursor(e),!0):void 0}}(this))},e.prototype._applyDelta=function(t){var e;return e=0,s.each(t.ops,function(t){return function(n){var r,i;return r=0,null!=n.insert?(r=n.insert.length||1,t.shiftCursors(e,r,null!=(i=n.attributes)?i.author:void 0)):null!=n["delete"]?t.shiftCursors(e,-1*n["delete"],null):null!=n.retain&&(t.shiftCursors(e,0,null),r=n.retain),e+=r}}(this)),this.update()},e.prototype._buildCursor=function(t,e){var n,r,i,o;return n=document.createElement("span"),u(n).addClass("cursor"),n.innerHTML=this.options.template,i=n.querySelector(".cursor-flag"),o=n.querySelector(".cursor-name"),u(o).text(t),r=n.querySelector(".cursor-caret"),r.style.backgroundColor=o.style.backgroundColor=e,this.container.appendChild(n),n},e.prototype._updateCursor=function(t){var n,r;return n=this.quill.getBounds(t.index),null==n?this.removeCursor(t.userId):(t.elem.style.top=n.top+this.quill.container.scrollTop+"px",t.elem.style.left=n.left+"px",t.elem.style.height=n.height+"px",r=t.elem.querySelector(".cursor-flag"),u(t.elem).toggleClass("top",parseInt(t.elem.style.top)<=r.offsetHeight).toggleClass("left",parseInt(t.elem.style.left)<=r.offsetWidth).toggleClass("right",this.quill.root.offsetWidth-parseInt(t.elem.style.left)<=r.offsetWidth),this.emit(e.events.CURSOR_MOVED,t))},e}(r),o.registerModule("multi-cursor",i),e.exports=i},{"../quill":30,eventemitter2:2}],26:[function(t,e,n){var r,i,o,s,u,a,l=function(t,e){return function(){return t.apply(e,arguments)}};s=t("../quill"),i=t("../core/document"),u=s.require("lodash"),a=s.require("dom"),r=s.require("delta"),o=function(){function t(e,n){var r;this.quill=e,this._onConvert=l(this._onConvert,this),this.container=this.quill.addContainer("ql-paste-manager"),this.container.setAttribute("contenteditable",!0),a(this.quill.root).on("paste",u.bind(this._paste,this)),this.options=u.defaults(n,t.DEFAULTS),null==(r=this.options).onConvert&&(r.onConvert=this._onConvert)}return t.DEFAULTS={onConvert:null},t.prototype._onConvert=function(t){var e,n,o;return n=new i(t,this.quill.options),e=n.toDelta(),o=e.length(),0===o?e:e.compose((new r).retain(o-1)["delete"](1))},t.prototype._paste=function(){var t,e;return t=this.quill.getLength(),e=this.quill.getSelection(),null!=e?(this.container.focus(),u.defer(function(t){return function(){var n,r,i,o,s,u,a;return n=t.options.onConvert(t.container),r=n.length(),r>0&&(e.start>0&&n.ops.unshift({retain:e.start}),n["delete"](e.end-e.start),t.quill.updateContents(n,"user")),t.quill.setSelection(e.start+r,e.start+r),u=t.quill.editor.doc.findLineAt(e.start+r),i=u[0],s=u[1],o=i.node.getBoundingClientRect().bottom,a=document.documentElement.clientHeight,o>a&&i.node.scrollIntoView(!1),t.container.innerHTML=""}}(this))):void 0},t}(),s.registerModule("paste-manager",o),e.exports=o},{"../core/document":8,"../quill":30}],27:[function(t,e,n){var r,i,o,s;r=t("../quill"),o=r.require("lodash"),s=r.require("dom"),i=function(){function t(e,n){if(this.quill=e,this.options=n,(o.isString(this.options)||o.isElement(this.options))&&(this.options={container:this.options}),null==this.options.container)throw new Error("container required for toolbar",this.options);this.container=o.isString(this.options.container)?document.querySelector(this.options.container):this.options.container,this.inputs={},this.preventUpdate=!1,this.triggering=!1,o.each(this.quill.options.formats,function(e){return function(n){return null==t.formats.TOOLTIP[n]?e.initFormat(n,o.bind(e._applyFormat,e,n)):void 0}}(this)),this.quill.on(r.events.FORMAT_INIT,function(e){return function(n){return null==t.formats.TOOLTIP[n]?e.initFormat(n,o.bind(e._applyFormat,e,n)):void 0}}(this)),this.quill.on(r.events.SELECTION_CHANGE,function(t){return function(e){return null!=e?t.updateActive(e):void 0}}(this)),this.quill.on(r.events.TEXT_CHANGE,function(t){return function(){return t.updateActive()}}(this)),this.quill.onModuleLoad("keyboard",function(t){return function(e){return e.addHotkey([s.KEYS.BACKSPACE,s.KEYS.DELETE],function(){return o.defer(o.bind(t.updateActive,t))})}}(this)),s(this.container).addClass("ql-toolbar"),s.isIOS()&&s(this.container).addClass("ios")}return t.DEFAULTS={container:null},t.formats={LINE:{align:"align",bullet:"bullet",list:"list"},SELECT:{align:"align",background:"background",color:"color",font:"font",size:"size"},TOGGLE:{bold:"bold",bullet:"bullet",image:"image",italic:"italic",link:"link",list:"list",strike:"strike",underline:"underline"},TOOLTIP:{image:"image",link:"link"}},t.prototype.initFormat=function(e,n){var r,i,o;return o=".ql-"+e,null!=t.formats.SELECT[e]?(o="select"+o,r="change"):r="click",i=this.container.querySelector(o),null!=i?(this.inputs[e]=i,s(i).on(r,function(t){return function(){var e,o;return o="change"===r?s(i).value():!s(i).hasClass("ql-active"),t.preventUpdate=!0,t.quill.focus(),e=t.quill.getSelection(),null!=e&&n(e,o),t.preventUpdate=!1,!0}}(this))):void 0},t.prototype.setActive=function(t,e){var n,r,i,o;return"image"===t&&(e=!1),r=this.inputs[t],null!=r?(n=s(r),"SELECT"===r.tagName?(this.triggering=!0,o=n.value(r),null==e&&(e=null!=(i=n["default"]())?i.value:void 0),Array.isArray(e)&&(e=""),e!==o&&(null!=e?n.option(e):n.reset()),this.triggering=!1):n.toggleClass("ql-active",e||!1)):void 0},t.prototype.updateActive=function(t,e){var n;return null==e&&(e=null),t||(t=this.quill.getSelection()),null==t||this.preventUpdate?void 0:(n=this._getActive(t),o.each(this.inputs,function(t){return function(r,i){return(!Array.isArray(e)||e.indexOf(i)>-1)&&t.setActive(i,n[i]),!0}}(this)))},t.prototype._applyFormat=function(e,n,r){return this.triggering?void 0:(n.isCollapsed()?this.quill.prepareFormat(e,r,"user"):null!=t.formats.LINE[e]?this.quill.formatLine(n,e,r,"user"):this.quill.formatText(n,e,r,"user"),o.defer(function(t){return function(){return t.updateActive(n,["bullet","list"]),t.setActive(e,r)}}(this)))},t.prototype._getActive=function(t){var e,n;return e=this._getLeafActive(t),n=this._getLineActive(t),o.defaults({},e,n)},t.prototype._getLeafActive=function(t){var e,n,r,i,s;return t.isCollapsed()?(s=this.quill.editor.doc.findLineAt(t.start),r=s[0],i=s[1],e=0===i?this.quill.getContents(t.start,t.end+1):this.quill.getContents(t.start-1,t.end)):e=this.quill.getContents(t),n=o.map(e.ops,"attributes"),this._intersectFormats(n)},t.prototype._getLineActive=function(t){var e,n,r,i,s,u;for(n=[],s=this.quill.editor.doc.findLineAt(t.start),e=s[0],i=s[1],u=this.quill.editor.doc.findLineAt(t.end),r=u[0],i=u[1],null!=r&&r===e&&(r=r.next);null!=e&&e!==r;)n.push(o.clone(e.formats)),e=e.next;return this._intersectFormats(n)},t.prototype._intersectFormats=function(e){return o.reduce(e.slice(1),function(e,n){var r,i,s,u,a;return null==n&&(n={}),r=Object.keys(e),s=null!=n?Object.keys(n):{},u=o.intersection(r,s),a=o.difference(r,s),i=o.difference(s,r),o.each(u,function(r){if(null!=t.formats.SELECT[r])if(Array.isArray(e[r])){if(e[r].indexOf(n[r])<0)return e[r].push(n[r])}else if(e[r]!==n[r])return e[r]=[e[r],n[r]]}),o.each(a,function(n){return null!=t.formats.TOGGLE[n]?delete e[n]:null==t.formats.SELECT[n]||Array.isArray(e[n])?void 0:e[n]=[e[n]]}),o.each(i,function(r){return null!=t.formats.SELECT[r]?e[r]=[n[r]]:void 0}),e},e[0]||{})},t}(),r.registerModule("toolbar",i),e.exports=i},{"../quill":30}],28:[function(t,e,n){var r,i,o,s;r=t("../quill"),o=r.require("lodash"),s=r.require("dom"),i=function(){function t(e,n){this.quill=e,this.options=n,this.container=this.quill.addContainer("ql-tooltip"),this.container.innerHTML=this.options.template,this.hide(),this.quill.on(this.quill.constructor.events.TEXT_CHANGE,function(e){return function(n,r){return e.container.style.left!==t.HIDE_MARGIN?(e.range=null,e.hide()):void 0}}(this))}return t.DEFAULTS={offset:10,template:""},t.HIDE_MARGIN="-10000px",t.prototype.initTextbox=function(t,e,n){return s(t).on("keydown",function(t){return function(r){switch(r.which){case s.KEYS.ENTER:return r.preventDefault(),e.call(t);case s.KEYS.ESCAPE:return r.preventDefault(),n.call(t);default:return!0}}}(this))},t.prototype.hide=function(){return this.container.style.left=t.HIDE_MARGIN,this.range&&this.quill.setSelection(this.range),this.range=null},t.prototype.position=function(t){var e,n,r,i,o,s,u;return null!=t?(s=t.getBoundingClientRect(),o=this.quill.container.getBoundingClientRect(),r=s.left-o.left,i=s.top-o.top,n=s.bottom-o.bottom,e=r+s.width/2-this.container.offsetWidth/2,u=i+s.height+this.options.offset,u+this.container.offsetHeight>this.quill.container.offsetHeight&&(u=i-this.container.offsetHeight-this.options.offset),e=Math.max(0,Math.min(e,this.quill.container.offsetWidth-this.container.offsetWidth)),u=Math.max(0,Math.min(u,this.quill.container.offsetHeight-this.container.offsetHeight))):(e=this.quill.container.offsetWidth/2-this.container.offsetWidth/2,u=this.quill.container.offsetHeight/2-this.container.offsetHeight/2),u+=this.quill.container.scrollTop,[e,u]},t.prototype.show=function(t){var e,n,r;return this.range=this.quill.getSelection(),n=this.position(t),e=n[0],r=n[1],this.container.style.left=e+"px",this.container.style.top=r+"px",this.container.focus()},t}(),r.registerModule("tooltip",i),e.exports=i},{"../quill":30}],29:[function(t,e,n){var r,i,o,s;i=t("../quill"),s=i.require("lodash"),r=i.require("delta"),o=function(){function t(t,e){this.quill=t,this.options=null!=e?e:{},this.lastRecorded=0,this.ignoreChange=!1,this.clear(),this.initListeners()}return t.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1},t.hotkeys={UNDO:{key:"Z",metaKey:!0},REDO:{key:"Z",metaKey:!0,shiftKey:!0}},t.prototype.initListeners=function(){return this.quill.onModuleLoad("keyboard",function(e){return function(n){return n.addHotkey(t.hotkeys.UNDO,function(){return e.quill.editor.checkUpdate(),e.undo(),!1}),n.addHotkey(t.hotkeys.REDO,function(){return e.quill.editor.checkUpdate(),e.redo(),!1})}}(this)),this.quill.on(this.quill.constructor.events.TEXT_CHANGE,function(t){return function(e,n){return t.ignoreChange?void 0:(t.options.userOnly&&n!==i.sources.USER?t._transform(e):t.record(e,t.oldDelta),t.oldDelta=t.quill.getContents())}}(this))},t.prototype.clear=function(){return this.stack={undo:[],redo:[]},this.oldDelta=this.quill.getContents()},t.prototype.record=function(t,e){var n,r,i,o;if(t.ops.length>0){this.stack.redo=[];try{if(o=this.quill.getContents().diff(this.oldDelta),i=(new Date).getTime(),this.lastRecorded+this.options.delay>i&&this.stack.undo.length>0?(n=this.stack.undo.pop(),o=o.compose(n.undo),t=n.redo.compose(t)):this.lastRecorded=i,this.stack.undo.push({redo:t,undo:o}),this.stack.undo.length>this.options.maxStack)return this.stack.undo.unshift()}catch(s){return r=s,console.warn("Could not record change... clearing undo stack."),this.clear()}}},t.prototype.redo=function(){return this._change("redo","undo")},t.prototype.undo=function(){return this._change("undo","redo")},t.prototype._getLastChangeIndex=function(t){var e,n;return n=0,e=0,s.each(t.ops,function(t){return null!=t.insert?n=Math.max(e+(t.insert.length||1),n):null!=t["delete"]?n=Math.max(e,n):null!=t.retain?(null!=t.attributes&&(n=Math.max(e+t.retain,n)),e+=t.retain):void 0}),n},t.prototype._change=function(t,e){var n,r;return this.stack[t].length>0?(n=this.stack[t].pop(),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(n[t],i.sources.USER),this.ignoreChange=!1,r=this._getLastChangeIndex(n[t]),this.quill.setSelection(r,r),this.oldDelta=this.quill.getContents(),this.stack[e].push(n)):void 0},t.prototype._transform=function(t){var e,n,r,i,o,s,u,a;for(this.oldDelta=t.transform(this.oldDelta,!0),s=this.stack.undo,n=0,i=s.length;i>n;n++)e=s[n],e.undo=t.transform(e.undo,!0),e.redo=t.transform(e.redo,!0);for(u=this.stack.redo,a=[],r=0,o=u.length;o>r;r++)e=u[r],e.undo=t.transform(e.undo,!0),a.push(e.redo=t.transform(e.redo,!0));return a},t}(),i.registerModule("undo-manager",o),e.exports=o},{"../quill":30}],30:[function(t,e,n){var r,i,o,s,u,a,l,c,p,h,f,d=function(t,e){function n(){this.constructor=t}for(var r in e)g.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},g={}.hasOwnProperty,v=[].slice;p=t("lodash"),f=t("../package.json"),r=t("rich-text/lib/delta"),s=t("eventemitter2").EventEmitter2,h=t("./lib/dom"),i=t("./core/document"),o=t("./core/editor"),u=t("./core/format"),a=t("./core/normalizer"),c=t("./lib/range"),l=function(t){function e(t,n){var r,i,s;if(this.container=t,null==n&&(n={}),p.isString(this.container)&&(this.container=document.querySelector(this.container)),null==this.container)throw new Error("Invalid Quill container");if(i=p.defaults(n.modules||{},e.DEFAULTS.modules),r=this.container.innerHTML,this.container.innerHTML="",this.options=p.defaults(n,e.DEFAULTS),this.options.modules=i,this.options.id=this.id="ql-editor-"+(e.editors.length+1),this.modules={},this.root=this.addContainer("ql-editor"),this.editor=new o(this.root,this,this.options),e.editors.push(this),this.setHTML(r,e.sources.SILENT),s=e.themes[this.options.theme],null==s)throw new Error("Cannot load "+this.options.theme+" theme. Are you sure you registered it?");this.theme=new s(this,this.options),p.each(this.options.modules,function(t){return function(e,n){return t.addModule(n,e)}}(this))}return d(e,t),e.version=f.version,e.editors=[],e.modules=[],e.themes=[],e.DEFAULTS={formats:["align","bold","italic","strike","underline","color","background","font","size","link","image","bullet","list"],modules:{keyboard:!0,"paste-manager":!0,"undo-manager":!0},pollInterval:100,readOnly:!1,styles:{},theme:"base"},e.events={FORMAT_INIT:"format-init",MODULE_INIT:"module-init",POST_EVENT:"post-event",PRE_EVENT:"pre-event",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},e.sources=o.sources,e.registerModule=function(t,n){return null!=e.modules[t]&&console.warn("Overwriting "+t+" module"),e.modules[t]=n},e.registerTheme=function(t,n){return null!=e.themes[t]&&console.warn("Overwriting "+t+" theme"),e.themes[t]=n},e.require=function(t){switch(t){case"lodash":return p;case"delta":return r;case"format":return u;case"normalizer":return a;case"dom":return h;case"document":return i;case"range":return c;default:return null}},e.prototype.destroy=function(){var t;return t=this.getHTML(),p.each(this.modules,function(t,e){return p.isFunction(t.destroy)?t.destroy():void 0}),this.editor.destroy(),this.removeAllListeners(),e.editors.splice(p.indexOf(e.editors,this),1),this.container.innerHTML=t},e.prototype.addContainer=function(t,e){var n,r;return null==e&&(e=!1),r=e?this.root:null,n=document.createElement("div"),h(n).addClass(t),this.container.insertBefore(n,r),n},e.prototype.addFormat=function(t,n){return this.editor.doc.addFormat(t,n),this.emit(e.events.FORMAT_INIT,t)},e.prototype.addModule=function(t,n){var r;if(r=e.modules[t],null==r)throw new Error("Cannot load "+t+" module. Are you sure you registered it?");return n===!0&&(n={}),n=p.defaults(n,this.theme.constructor.OPTIONS[t]||{},r.DEFAULTS||{}),this.modules[t]=new r(this,n),this.emit(e.events.MODULE_INIT,t,this.modules[t]),this.modules[t]},e.prototype.deleteText=function(t,n,i){var o,s,u;return null==i&&(i=e.sources.API),u=this._buildParams(t,n,{},i),t=u[0],n=u[1],s=u[2],i=u[3],n>t?(o=(new r).retain(t)["delete"](n-t),this.editor.applyDelta(o,i)):void 0},e.prototype.emit=function(){var t,n;return n=arguments[0],t=2<=arguments.length?v.call(arguments,1):[],e.__super__.emit.apply(this,[e.events.PRE_EVENT,n].concat(v.call(t))),e.__super__.emit.apply(this,[n].concat(v.call(t))),e.__super__.emit.apply(this,[e.events.POST_EVENT,n].concat(v.call(t)))},e.prototype.focus=function(){return this.editor.focus()},e.prototype.formatLine=function(t,e,n,r,i){var o,s,u,a,l;return a=this._buildParams(t,e,n,r,i),t=a[0],e=a[1],o=a[2],i=a[3],l=this.editor.doc.findLineAt(e),s=l[0],u=l[1],null!=s&&(e+=s.length-u),this.formatText(t,e,o,i)},e.prototype.formatText=function(t,e,n,i,o){var s,u,a;return a=this._buildParams(t,e,n,i,o),t=a[0],e=a[1],u=a[2],o=a[3],u=p.reduce(u,function(t){return function(e,n,r){var i;return i=t.editor.doc.formats[r],n&&n!==i.config["default"]||(e[r]=null),e}}(this),u),s=(new r).retain(t).retain(e-t,u),this.editor.applyDelta(s,o)},e.prototype.getBounds=function(t){return this.editor.getBounds(t)},e.prototype.getContents=function(t,e){return null==t&&(t=0),null==e&&(e=null),p.isObject(t)&&(e=t.end,t=t.start),this.editor.delta.slice(t,e)},e.prototype.getHTML=function(){return this.editor.doc.getHTML()},e.prototype.getLength=function(){return this.editor.length},e.prototype.getModule=function(t){return this.modules[t]},e.prototype.getSelection=function(){return this.editor.checkUpdate(),this.editor.selection.getRange()},e.prototype.getText=function(t,e){return null==t&&(t=0),null==e&&(e=null),p.map(this.getContents(t,e).ops,function(t){return p.isString(t.insert)?t.insert:""}).join("")},e.prototype.insertEmbed=function(t,e,n,i){var o,s,u,a;return a=this._buildParams(t,0,e,n,i),t=a[0],s=a[1],u=a[2],i=a[3],o=(new r).retain(t).insert(1,u),this.editor.applyDelta(o,i)},e.prototype.insertText=function(t,e,n,i,o){var s,u,a,l;return l=this._buildParams(t,0,n,i,o),t=l[0],u=l[1],a=l[2],o=l[3],e.length>0?(s=(new r).retain(t).insert(e,a),this.editor.applyDelta(s,o)):void 0},e.prototype.onModuleLoad=function(t,n){return this.modules[t]?n(this.modules[t]):this.on(e.events.MODULE_INIT,function(e,r){return e===t?n(r):void 0})},e.prototype.prepareFormat=function(t,n,r){var i,o;return null==r&&(r=e.sources.API),i=this.editor.doc.formats[t],null!=i&&(o=this.getSelection(),null!=o?o.isCollapsed():void 0)?i.isType(u.types.LINE)?this.formatLine(o,t,n,r):i.prepare(n):void 0},e.prototype.setContents=function(t,n){var i;return null==n&&(n=e.sources.API),t=new r(Array.isArray(t)?t.slice():t.ops.slice()),i=p.last(t.slice(t.length()-1).ops),t["delete"](this.getLength()-1),null!=i&&p.isString(i.insert)&&"\n"===p.last(i.insert)&&t["delete"](1),this.updateContents(t,n)},e.prototype.setHTML=function(t,n){return null==n&&(n=e.sources.API),t.trim()||(t="<"+h.DEFAULT_BLOCK_TAG+"><"+h.DEFAULT_BREAK_TAG+"></"+h.DEFAULT_BLOCK_TAG+">"),this.editor.doc.setHTML(t),this.editor.checkUpdate(n)},e.prototype.setSelection=function(t,n,r){var i;return null==r&&(r=e.sources.API),p.isNumber(t)&&p.isNumber(n)?i=new c(t,n):(i=t,r=n||r),this.editor.selection.setRange(i,r)},e.prototype.setText=function(t,n){var i;return null==n&&(n=e.sources.API),i=(new r).insert(t),this.setContents(i,n)},e.prototype.updateContents=function(t,n){return null==n&&(n=e.sources.API),Array.isArray(t)&&(t={ops:t}),this.editor.applyDelta(t,n)},e.prototype._buildParams=function(){var t,n;return n=1<=arguments.length?v.call(arguments,0):[],p.isObject(n[0])&&n.splice(0,1,n[0].start,n[0].end),p.isString(n[2])&&(t={},t[n[2]]=n[3],n.splice(2,2,t)),null==n[3]&&(n[3]=e.sources.API),n},e}(s),l.registerTheme("base",t("./themes/base")),l.registerTheme("snow",t("./themes/snow")),e.exports=l},{"../package.json":7,"./core/document":8,"./core/editor":9,"./core/format":10,"./core/normalizer":13,"./lib/dom":17,"./lib/range":20,"./themes/base":32,"./themes/snow":33,eventemitter2:2,lodash:1,"rich-text/lib/delta":3}],31:[function(t,e,n){e.exports='.ql-image-tooltip{padding:10px;width:300px}.ql-image-tooltip:after{clear:both;content:"";display:table}.ql-image-tooltip a{border:1px solid #000;box-sizing:border-box;display:inline-block;float:left;padding:5px;text-align:center;width:50%}.ql-image-tooltip img{bottom:0;left:0;margin:auto;max-height:100%;max-width:100%;position:absolute;right:0;top:0}.ql-image-tooltip .input{box-sizing:border-box;width:100%}.ql-image-tooltip .preview{margin:10px 0;position:relative;border:1px dashed #000;height:200px}.ql-image-tooltip .preview span{display:inline-block;position:absolute;text-align:center;top:40%;width:100%}.ql-link-tooltip{padding:5px 10px}.ql-link-tooltip input.input{width:170px}.ql-link-tooltip a.done,.ql-link-tooltip input.input{display:none}.ql-link-tooltip a.change{margin-right:4px}.ql-link-tooltip.editing a.done,.ql-link-tooltip.editing input.input{display:inline-block}.ql-link-tooltip.editing a.change,.ql-link-tooltip.editing a.remove,.ql-link-tooltip.editing a.url{display:none}.ql-multi-cursor{position:absolute;left:0;top:0;z-index:1000}.ql-multi-cursor .cursor{margin-left:-1px;position:absolute}.ql-multi-cursor .cursor-flag{bottom:100%;position:absolute;white-space:nowrap}.ql-multi-cursor .cursor-name{display:inline-block;color:#fff;padding:2px 8px}.ql-multi-cursor .cursor-caret{height:100%;position:absolute;width:2px}.ql-multi-cursor .cursor.hidden .cursor-flag{display:none}.ql-multi-cursor .cursor.top .cursor-flag{bottom:auto;top:100%}.ql-multi-cursor .cursor.right .cursor-flag{right:-2px}.ql-paste-manager{left:-100000px;position:absolute;top:50%}.ql-toolbar{box-sizing:border-box}.ql-tooltip{background-color:#fff;border:1px solid #000;box-sizing:border-box;position:absolute;top:0;white-space:nowrap;z-index:2000}.ql-tooltip a{cursor:pointer;text-decoration:none}.ql-container{box-sizing:border-box;cursor:text;font-family:Helvetica,Arial,sans-serif;font-size:13px;height:100%;line-height:1.42;margin:0;overflow-x:hidden;overflow-y:auto;padding:12px 15px;position:relative}.ql-editor{box-sizing:border-box;min-height:100%;outline:0;tab-size:4;white-space:pre-wrap}.ql-editor div{margin:0;padding:0}.ql-editor a{text-decoration:underline}.ql-editor b{font-weight:700}.ql-editor i{font-style:italic}.ql-editor s{text-decoration:line-through}.ql-editor u{text-decoration:underline}.ql-editor a,.ql-editor b,.ql-editor i,.ql-editor s,.ql-editor span,.ql-editor u{background-color:inherit}.ql-editor img{max-width:100%}.ql-editor blockquote,.ql-editor ol,.ql-editor ul{margin:0 0 0 2em;padding:0}.ql-editor ol{list-style-type:decimal}.ql-editor ul{list-style-type:disc}.ql-editor.ql-ie-10 br,.ql-editor.ql-ie-9 br{display:none}'},{}],32:[function(t,e,n){var r,i,o,s;i=t("lodash"),s=t("../../lib/dom"),o=t("./base.styl"),r=function(){function t(e,n){var r;this.quill=e,this.options=n,s(this.quill.container).addClass("ql-container"),this.options.styles&&this.addStyles(o+t.objToCss(this.options.styles)),s.isIE(10)&&(r=s.isIE(9)?"9":"10",s(this.quill.root).addClass("ql-ie-"+r))}return t.OPTIONS={},t.objToCss=function(t){return i.map(t,function(t,e){var n;return n=i.map(t,function(t,e){return e+": "+t+";"}).join(" "),e+" { "+n+" }"}).join("\n")},t.prototype.addStyles=function(e){var n;return i.isObject(e)&&(e=t.objToCss(e)),n=document.createElement("style"),n.type="text/css",n.appendChild(document.createTextNode(e)),document.head.appendChild(n)},t}(),e.exports=r},{"../../lib/dom":17,"./base.styl":31,lodash:1}],33:[function(t,e,n){var r,i,o,s,u,a,l=function(t,e){function n(){this.constructor=t}for(var r in e)c.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},c={}.hasOwnProperty;u=t("lodash"),i=t("../../lib/color-picker"),r=t("../base"),a=t("../../lib/dom"),o=t("../../lib/picker"),s=function(t){function e(t,n){this.quill=t,this.options=n,e.__super__.constructor.apply(this,arguments),a(this.quill.container).addClass("ql-snow"),this.pickers=[],this.quill.on(this.quill.constructor.events.SELECTION_CHANGE,function(t){return function(e){return null!=e?u.invoke(t.pickers,"close"):void 0}}(this)),this.quill.onModuleLoad("multi-cursor",u.bind(this.extendMultiCursor,this)),this.quill.onModuleLoad("toolbar",u.bind(this.extendToolbar,this))}return l(e,t),e.COLORS=["#000000","#e60000","#ff9900","#ffff00","#008A00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],e.OPTIONS={"multi-cursor":{template:'<span class="cursor-flag"> <span class="cursor-triangle top"></span> <span class="cursor-name"></span> <span class="cursor-triangle bottom"></span> </span> <span class="cursor-caret"></span>'}},e.prototype.extendMultiCursor=function(t){return t.on(t.constructor.events.CURSOR_ADDED,function(t){var e,n;return e=t.elem.querySelector(".cursor-triangle.bottom"),n=t.elem.querySelector(".cursor-triangle.top"),e.style.borderTopColor=n.style.borderBottomColor=t.color})},e.prototype.extendToolbar=function(t){return a(t.container).addClass("ql-snow"),u.each(["color","background","font","size","align"],function(e){return function(n){var r,s;if(s=t.container.querySelector(".ql-"+n),null!=s){switch(n){case"font":case"size":case"align":r=new o(s);break;case"color":case"background":r=new i(s),u.each(r.container.querySelectorAll(".ql-picker-item"),function(t,e){return 7>e?a(t).addClass("ql-primary-color"):void 0})}return null!=r?e.pickers.push(r):void 0}}}(this)),u.each(a(t.container).textNodes(),function(t){return 0===a(t).text().trim().length?a(t).remove():void 0})},e}(r),e.exports=s},{"../../lib/color-picker":16,"../../lib/dom":17,"../../lib/picker":19,"../base":32,lodash:1}]},{},[15])(15)}),!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Clipboard=t()}}(function(){return function t(e,n,r){function i(s,u){if(!n[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){var r=t("closest"),i=t("component-event"),o=["focus","blur"];n.bind=function(t,e,n,s,u){return-1!==o.indexOf(n)&&(u=!0),i.bind(t,n,function(n){var i=n.target||n.srcElement;n.delegateTarget=r(i,e,!0,t),n.delegateTarget&&s.call(t,n)},u)},n.unbind=function(t,e,n,r){-1!==o.indexOf(e)&&(r=!0),i.unbind(t,e,n,r)}},{closest:2,"component-event":4}],2:[function(t,e,n){var r=t("matches-selector");e.exports=function(t,e,n){for(var i=n?t:t.parentNode;i&&i!==document;){if(r(i,e))return i;i=i.parentNode}}},{"matches-selector":3}],3:[function(t,e,n){function r(t,e){if(o)return o.call(t,e);for(var n=t.parentNode.querySelectorAll(e),r=0;r<n.length;++r)if(n[r]==t)return!0;return!1}var i=Element.prototype,o=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;e.exports=r},{}],4:[function(t,e,n){var r=window.addEventListener?"addEventListener":"attachEvent",i=window.removeEventListener?"removeEventListener":"detachEvent",o="addEventListener"!==r?"on":"";n.bind=function(t,e,n,i){return t[r](o+e,n,i||!1),n},n.unbind=function(t,e,n,r){return t[i](o+e,n,r||!1),n}},{}],5:[function(t,e,n){function r(){}r.prototype={on:function(t,e,n){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var r=this,i=function(){r.off(t,i),e.apply(n,arguments)};return this.on(t,i,n)},emit:function(t){var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),r=0,i=n.length;for(r;i>r;r++)n[r].fn.apply(n[r].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),r=n[t],i=[];if(r&&e)for(var o=0,s=r.length;s>o;o++)r[o].fn!==e&&i.push(r[o]);return i.length?n[t]=i:delete n[t],this}},e.exports=r},{}],6:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.__esModule=!0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(e){r(this,t),this.resolveOptions(e),this.initSelection()}return t.prototype.resolveOptions=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=t.action,this.emitter=t.emitter,this.target=t.target,this.text=t.text,this.trigger=t.trigger,this.selectedText=""},t.prototype.initSelection=function(){if(this.text&&this.target)throw new Error('Multiple attributes declared, use either "target" or "text"');if(this.text)this.selectFake();else{if(!this.target)throw new Error('Missing required attributes, use either "target" or "text"');this.selectTarget()}},t.prototype.selectFake=function(){var t=this;this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return t.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.position="absolute",this.fakeElem.style.left="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.selectedText=this.text,document.body.appendChild(this.fakeElem),this.fakeElem.select(),this.copyText()},t.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),
this.fakeElem=null)},t.prototype.selectTarget=function(){if("INPUT"===this.target.nodeName||"TEXTAREA"===this.target.nodeName)this.target.select(),this.selectedText=this.target.value;else{var t=document.createRange(),e=window.getSelection();e.removeAllRanges(),t.selectNodeContents(this.target),e.addRange(t),this.selectedText=e.toString()}this.copyText()},t.prototype.copyText=function(){var t=void 0;try{t=document.execCommand(this.action)}catch(e){t=!1}this.handleResult(t)},t.prototype.handleResult=function(t){t?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},t.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},t.prototype.destroy=function(){this.removeFake()},i(t,[{key:"action",set:function(){var t=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=t,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(t){if(void 0!==t){if(!t||"object"!=typeof t||1!==t.nodeType)throw new Error('Invalid "target" value, use a valid Element');this._target=t}},get:function(){return this._target}}]),t}();n["default"]=o,e.exports=n["default"]},{}],7:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n="data-clipboard-"+t;return e.hasAttribute(n)?e.getAttribute(n):void 0}n.__esModule=!0;var u=t("./clipboard-action"),a=r(u),l=t("delegate-events"),c=r(l),p=t("tiny-emitter"),h=r(p),f=function(t){function e(n,r){i(this,e),t.call(this),this.resolveOptions(r),this.delegateClick(n)}return o(e,t),e.prototype.resolveOptions=function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText},e.prototype.delegateClick=function(t){var e=this;this.binding=c["default"].bind(document.body,t,"click",function(t){return e.onClick(t)})},e.prototype.undelegateClick=function(){c["default"].unbind(document.body,"click",this.binding)},e.prototype.onClick=function(t){this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new a["default"]({action:this.action(t.delegateTarget),target:this.target(t.delegateTarget),text:this.text(t.delegateTarget),trigger:t.delegateTarget,emitter:this})},e.prototype.defaultAction=function(t){return s("action",t)},e.prototype.defaultTarget=function(t){var e=s("target",t);return e?document.querySelector(e):void 0},e.prototype.defaultText=function(t){return s("text",t)},e.prototype.destroy=function(){this.undelegateClick(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},e}(h["default"]);n["default"]=f,e.exports=n["default"]},{"./clipboard-action":6,"delegate-events":1,"tiny-emitter":5}]},{},[7])(7)}),function(t){function e(){this.subs={},this.queue=[],this.in_post=!1,this.debug=!0}e.prototype.sub=function(t){if(!t.type)throw new Error("MBus: must specify 'type' field");var e=this.subs[t.type]||[];e.push(t),this.subs[t.type]=e},e.prototype.post=function(t,e){var n,r;if(t instanceof Object?(n=t.type,r=t):(n=t,r=e),this.queue.push({type:n,msg:r}),!this.in_post){for(this.in_post=!0;;){var i=this.queue.pop();if(!i)break;var o=i.type,s=i.msg,u=this.subs[o];u?(this.debug&&console.debug("*** MBUS: publishing: ",o,s),this._publish(u,o,s)):console.log("Mbus: no subscribers for: ",o)}this.in_post=!1}},e.prototype._publish=function(t,e,n){var r;try{for(var i=0;i<t.length;i++){var o=t[i];r=o.subscriber;var s=o.cb;s(n,e)}}catch(u){console.error("Mbus: attempted to deliver '",e,"' to '",r,"' got:",u),console.log("Mbus Msg: ",n)}},window.mbus=new e}(document),function(t){"use strict";var e=new Worker("scripts/worker.js");e.addEventListener("message",function(t){mbus.post(t.data)}),window.wpr=e,window.app=t.querySelector("#app");var n=t.createElement("iron-ajax");n.setAttribute("handle-as","text"),n.addEventListener("response",function(t){var e=t.detail.xhr.responseText;mbus.post("file",{file:n.url,text:e})}),app.load_example=function(t){var e=t.target.getAttribute("data-file");n.setAttribute("url",e),n.generateRequest()},app.addEventListener("dom-change",function(){console.log("Our app is ready to rock!")}),app.displayInstalledToast=function(){},window.addEventListener("WebComponentsReady",function(){}),addEventListener("paper-header-transform",function(e){var n=t.querySelector("#mainToolbar .app-name"),r=t.querySelector("#mainToolbar .middle-container"),i=e.detail,o=i.height-i.condensedHeight,s=Math.min(1,i.y/o),u=.5,a=Math.max(u,(o-i.y)/(o/(1-u))+u);Polymer.Base.transform("translate3d(0,"+100*s+"%,0)",r),Polymer.Base.transform("scale("+a+") translateZ(0)",n)}),app.onDataRouteClick=function(){var e=t.querySelector("#paperDrawerPanel");e.narrow&&e.closeDrawer()},app.scrollPageToTop=function(){t.getElementById("mainContainer").scrollTop=0}}(document),function(t){"use strict";var e=t.querySelector("#app");e.addEventListener("dom-change",function(){function t(){var t=r.getLength();r.formatText(0,t,"background","rgb(255,255,255)")}function e(){var t=r.getLength();r.deleteText(0,t)}function n(e){t();for(var n=0;n<e.length;n++){var i=e[n];r.formatText(i,i+1,"background","rgb(240, 6, 6)","parser")}}var r;Quill.registerModule("clipboard",function(t,e){var n="#"+e.toolbar_id+">.toolbar>.clip-copy";new Clipboard(n,{text:function(t){return JSON.stringify(r.getContents())}})}),window._ftest=function(t){return console.log("Test!  ",t),!1},Quill.modules["link-tooltip"].DEFAULTS.template='<span class="title">Visit URL:&nbsp;</span><a href="#" class="url" href="about:blank" onclick="return _ftest(event);"></a><input class="input" type="text"><span>&nbsp;&#45;&nbsp;</span><a href="javascript:;" class="change">Change</a><a href="javascript:;" class="remove">Remove</a><a href="javascript:;" class="done">Done</a>',Quill.modules["link-tooltip"].prototype._normalizeURL=function(t){return t},r=new Quill("#editor",{modules:{toolbar:{container:"#full-toolbar"},"link-tooltip":!0,"image-tooltip":!0,clipboard:{toolbar_id:"full-toolbar",target_id:"editor-delta"}},theme:"snow"});var i;mbus.sub({type:"file",subscriber:"editor",cb:function(t){var n=t.file.split(".")[1];if(e(),i=t.file,"plq"==n){var o=JSON.parse(t.text);r.setContents(o)}else r.setText(t.text)}});var o=new Debouncer(250,{source:"editor-text-change"},function(t,e){if("parser"!=e.source){var n=r.getText();mbus.post("file-text",{file:i,text:n,ctx:e})}});r.on("text-change",function(t,e){o.report_event({source:e})}),window.editor=r;var s=[];mbus.sub({type:"error-locations",subscriber:"editor",cb:function(e){console.log("Error Locs: ",e);var r=e.length>0;if(r)return s=e,t(),void n(e);var i=s.length>0;return i?(s=[],void t()):void 0}}),mbus.sub({type:"compilation-errors",subscriber:"editor",cb:function(t){console.log("Compilation Errors: ",t.errors)}})})}(document),function(t){"use strict";function e(e,n){var r=n===!0?"disabled":void 0;t.querySelector("#"+e).disabled=r}function n(){var t=s.getLength();s.deleteText(0,t)}function r(){wpr.postMessage({type:"run",steps:1e5})}function i(){o("\n")}function o(t,e){e=e||{};var n=s.getLength();e.nl&&(t+="\n"),e.prefix&&(t=e.prefix+t),s.insertText(n,t,e)}var s,u=t.querySelector("#app"),a=!1;u.addEventListener("dom-change",function(){s=new Quill("#answers",{modules:{},theme:"snow"}),s.editor.disable(),t.querySelector("#action-clear").addEventListener("click",function(){n()}),t.querySelector("#action-stop").addEventListener("click",function(){a=!0}),t.querySelector("#action-redo").addEventListener("click",function(){wpr.postMessage({type:"redo"})})}),mbus.sub({type:"pr_error",cb:function(t){o(t.error,{color:"rgb(255, 0, 0)",bold:!0,nl:!0})}}),mbus.sub({type:"pr_question_ok",cb:function(){e("action-stop",!1),r()}}),mbus.sub({type:"pr_paused",cb:function(t){if(a){e("action-stop",!0);var n;n=Number.toLocaleString?(+t.step_count).toLocaleString():t.step_count,o("Current Instruction Count: "+n,{italic:!0,nl:!0})}else e("action-stop",!1),r();a=!1}}),mbus.sub({type:"pr_redo",cb:function(t){e("action-redo",!0),console.log("Can redo? ",t.result),i(),t.result?r():o("Cannot redo\n",{color:"rgb(255, 0, 0)",italic:!0,nl:!0})}}),mbus.sub({type:"pr_result",cb:function(t){console.log("RESULT: ",t),e("action-redo",!1),e("action-stop",!0),o("Instruction Count: "+t.step_count,{italic:!0,nl:!0});for(var n in t.vars){var r=t.vars[n].replace(/,/g,", ");o(n+"="+r,{color:"rgb(0,0,255)",nl:!0})}var s=t.state?"yes":"no";o(s,{bold:!0,nl:!0}),i()}})}(document),function(t){function e(t){for(var e=[],n=t.sentences,r=0;r<n.length;r++){var i=n[r];i&&null!==i.maybe_error&&e.push(i.maybe_error.token.offset)}return e}function n(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].maybe_token_list);return e}function r(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];r instanceof Error&&e.push(r)}return e}function i(t,e){wpr.postMessage({type:"code",code_text:e,code_type:t})}mbus.sub({type:"file-text",subscriber:"compiler",cb:function(t){var e=t.text,n=t.file,r=Prolog.parse_per_sentence(e);mbus.post("parsed",{sentences:r,file:n,text:e})}}),mbus.sub({type:"parsed",subscriber:"compiler",cb:function(t){var r=e(t.sentences);mbus.post("error-locations",r),0===r.length&&mbus.post("parsed-ok",{file:t.file,text:t.text,sentences:n(t.sentences.sentences)})}}),mbus.sub({type:"parsed-ok",subscriber:"compiler",cb:function(t){var e=Prolog.compile_per_sentence(t.sentences);console.log("Compilation: ",e);var n=r(e);0===n.length?i("user",t.text):mbus.post("compilation-errors",{file:t.file,errors:n})}})}(document),function(t){mbus.sub({type:"code",subscriber:"interpreter",cb:function(t){console.log("Interpreter: ",t)}})}(document);var Debouncer=function(t,e,n){this.timeout=t,this.cb=n,this.ctx=e,this.in_process=!1,this.current_timer=null};Debouncer.prototype.report_event=function(t){this.in_process&&this.current_timer&&clearTimeout(this.current_timer),this.in_process=!0;var e=this;this.current_timer=setTimeout(function(){try{e.cb(e.ctx,t)}catch(n){console.error("Debouncer: ctx(",e.ctx,") error= ",n)}e.in_process=!1},this.timeout)};/*! prolog.js - v0.0.1 - 2015-10-24 */
var Prolog={};Prolog.parse_per_sentence=function(t,e){e=e||!1;for(var n,r,i,o,s,u,a={sentences:[],is_error:!1},l=new Lexer(t),c=l.process_per_sentence(),p=0;p<c.length;p++){var h=c[p];try{if(n=new ParserL1(h),o=n.process(),r=new ParserL2(o),s=r.process().terms,i=new ParserL3(s,Op.ordered_list_by_precedence),u=i.process(),!u||!u[0])continue;var f=u[0][0];if(!f)continue;if(e&&"rule"==f.name)throw new ErrorRuleInQuestion("Rule in Query",f);if("rule"!=f.name&&("conj"==f.name||"disj"==f.name))throw new ErrorInvalidFact("Can not include conj or disj",f);f&&a.sentences.push(new ParseSummary(null,f))}catch(d){a.sentences.push(new ParseSummary(d)),a.is_error=!0}}return a},Prolog.compile_per_sentence=function(t){if(t.is_error)throw new Error("Attempt to compile erroneous sentences");for(var e,n,r=[],i=new Compiler,o=t.sentences||t,s=0;s<o.length;s++){n=o[s],n instanceof ParseSummary&&(n=n.maybe_token_list);try{e=n instanceof Functor&&"query"==n.name?i.process_query(n.args[0]):i.process_rule_or_fact(n),r.push(new Code(e))}catch(u){r.push(u)}r.push()}return r},Prolog.compile_query=function(t){var e,n,r=new Compiler;try{n=r.process_query(t),e=new Code(n)}catch(i){e=i}return e},"undefined"!=typeof module&&(module.exports.Prolog=Prolog),Token.inspect_quoted=!1,Token.inspect_compact=!1,Token.prototype.toJSON=function(){return"Token:"+this.name+":"+this.value},Token.fromJSON=function(t,e){return new Token(t,e)},Token.prototype.inspect=function(t){if(Token.inspect_compact)return"nil"==this.name?"nil":this.value;var e="";return e="Token("+this.name+","+this.value+")",Token.inspect_quoted&&(e="'"+e+"'"),e},Token.equal=function(t,e){return t.name==e.name&&t.value==e.value},Token.check_for_match=function(t,e,n){n=n||!1;var r;if(t instanceof Array&&t[0]instanceof Array){for(r=0;r<t.length;r++)if(!Token.check_for_match(t[r],e[r]))return!1;return!0}if(t.length!=e.length)return!1;for(r in t){var i=t[r],o=e[r]||new Token("null");if(!Token.equal(i,o))return!1;if(n&&i.col!=o.col)return!1}return!0},Op.prototype.inspect=function(){return"Op("+this.name+")"},Op.parts=function(t){var e=t.split("");return"f"==e[0]?[null,e[0],e[1]]:[e[0],e[1],e[2]||null]},Op.AMBIGUOUS_PRECEDENCE=!0,Op._list=[new Op("query","?-",1300,"fy"),new Op("rule",":-",1200,"xfx"),new Op("disj",";",1100,"xfy"),new Op("conj",",",1e3,"xfy"),new Op("equal","=:=",700,"xfx",{builtin:!0,"boolean":!0}),new Op("equalnot","=\\=",700,"xfx",{builtin:!0,"boolean":!0}),new Op("unif","=",700,"xfx",{builtin:!0,"boolean":!0}),new Op("notunif","\\=",700,"xfx",{builtin:!0,"boolean":!0}),new Op("em","=<",700,"xfx",{primitive:!0,"boolean":!0,to_evaluate:!0}),new Op("ge",">=",700,"xfx",{primitive:!0,"boolean":!0,to_evaluate:!0}),new Op("lt","<",700,"xfx",{primitive:!0,"boolean":!0,to_evaluate:!0}),new Op("gt",">",700,"xfx",{primitive:!0,"boolean":!0,to_evaluate:!0}),new Op("is","is",700,"xfx",{primitive:!0,retvalue:!1,to_evaluate:!0}),new Op("minus","-",500,"yfx",{primitive:!0,retvalue:!0}),new Op("plus","+",500,"yfx",{primitive:!0,retvalue:!0}),new Op("mult","*",400,"yfx",{primitive:!0,retvalue:!0}),new Op("div","/",400,"yfx",{primitive:!0,retvalue:!0}),new Op("not","not",200,"fy",{primitive:!0}),new Op("uminus","-",200,"fy"),new Op("uplus","+",200,"fy")],Op._amap={"-":{ambiguous_precence:!0},"+":{ambiguous_precence:!0}},Op.has_ambiguous_precedence=function(t){return Op._amap[t]||!1},function(){Op.map_by_symbol={},Op.map_by_name={},Op.ordered_list_by_precedence=[];for(var t in Op._list){var e=Op._list[t];Op.ordered_list_by_precedence.push(e),Op.map_by_name[e.name]=e,Op.map_by_symbol[e.symbol]=e}Op.ordered_list_by_precedence.sort(function(t,e){return t.prec-e.prec})}(),Op.classify_triplet=function(t,e,n){if(!(e instanceof OpNode))throw Error("Expecting an OpNode from node_center: "+JSON.stringify(e));if(null===e.prec)throw Error("Expecting a valid OpNode for node_center: "+JSON.stringify(e));return Op.__classify(t,e,n)},Op.__classify=function(t,e,n){var r=e.prec,i="";try{t&&(t.prec==r?i+="y":t.prec<r&&(i+="x"))}catch(o){}i+="f";try{n&&(n.prec==r?i+="y":n.prec<r&&(i+="x"))}catch(o){}return i},Op.is_unary=function(t){return"f"==(""+t)[0]},Op.is_compatible_subtype=function(t,e){return null===e&&null!==t?!1:null===t&&null!==e?!1:"y"==t&&"x"==e?!1:!0},Op.are_compatible_types=function(t,e){var n=Op.parts(t),r=Op.parts(e);return Op.is_compatible_subtype(n[0],r[0])&&Op.is_compatible_subtype(n[1],r[1])&&Op.is_compatible_subtype(n[2],r[2])},OpNode.prototype.inspect=function(){return"OpNode(`"+this.symbol+"`,"+this.prec+")"},OpNode.create_from_name=function(t){var e=Op.map_by_name[t];if(!e)throw new Error("OpNode.create_from_name: expecting a valid 'name', got: "+t);var n=new OpNode(e.symbol,e.prec);return n.line=e.line,n.col=e.col,n},Eos.prototype.inspect=function(){return"Eos"},Code.prototype.inspect=function(){return"Code("+this.code.f+"/"+this.code.arity+")"},Functor.prototype.get_arity=function(){return this.arity||this.args.length},Functor.prototype.get_name=function(){return this.name},Functor.inspect_compact_version=!1,Functor.inspect_short_version=!1,Functor.inspect_quoted=!1,Functor.inspect_cons=!1,Functor.prototype.inspect=function(t){var e,n="",r=this.arity||this.args.length;return Functor.inspect_compact_version?"cons"==this.name&&Functor.inspect_cons?(e=this.format_args(this.args,!0),n=t===!0?e:"["+e+"]"):(e=this.format_args(this.args),n=this.name+"("+e+")"):Functor.inspect_short_version?n="Functor("+this.name+"/"+r+")":(e=this.format_args(this.args),n=r>0?"Functor("+this.name+"/"+r+","+e+")":"Functor("+this.name+"/"+r+")"),Functor.inspect_quoted&&(n="'"+n+"'"),n},Functor.prototype.format_args=function(t,e){for(var n="",r=0;r<t.length;r++){var i=t[r];r>0&&(n+=","),Array.isArray(i)?(n+="[",n+=this.format_args(i,e),n+="]"):n=this.format_arg(n,i,e)}return n},Functor.prototype.format_arg=function(t,e,n){return"string"==typeof e?t+e:t+=e&&e.inspect?e.inspect(n):JSON.stringify(e)},Functor.prototype.get_args=function(){return this.args},Functor.prototype.push_arg=function(t){this.args.push(t)},Functor.prototype.get_arg=function(t){return this.args[t]},Functor.compare=function(t,e){return t.name==e.name&&t.arity==e.arity?!0:!1},Var.counter=0,Var.inspect_extended=!1,Var.inspect_compact=!1,Var.prototype.toJSON=function(){return"Var:"+this.name+":"+JSON.stringify(this.value)},Var.fromJSON=function(t,e){var n=JSON.parse(e,Types.ReviveFromJSON),r=new Var(t);return r.bind(n),r},Var.prototype.inspect=function(t,e){var n=this.is_anon?"_":this.name;if(e=e||0,5==e)return"?CYCLE?";if(this.value){var r=this.value.inspect?this.value.inspect(t,e+1):this.value;return Var.inspect_compact?r:Var.inspect_extended?"Var("+n+", "+r+"){"+this.id+"}":"Var("+n+", "+r+")"}return Var.inspect_compact?"_":Var.inspect_extended?"Var("+n+"){"+this.id+"}":"Var("+n+")"},Var.prototype.bind=function(t,e){if(this==t)throw new Error("Attempt to create cycle ...");if(null===t)throw new ErrorInvalidValue("Var("+this.name+"), attempted to bind 'null'");if(null!==this.value)throw new ErrorAlreadyBound("Already Bound: Var("+this.name+")");e&&e(this,t),this.value=t},Var.prototype.is_bound=function(){return null!==this.value},Var.prototype.unbind=function(){this.value=null},Var.prototype.get_value=function(){if(null===this.value)throw new ErrorNotBound("Not Bound: Var("+this.name+")");return this.value},Var.prototype.deref=function(t){return t&&t==this?null:this.value instanceof Var?this.value.is_bound()?this.value.deref(t):t&&t==this.value?null:this.value:this},Var.prototype.safe_bind=function(t,e){var n,r;if(n=this.deref(t),null===n)return void console.log("!!!!!!!!!! CYCLE AVERTED! ",this);if(t instanceof Var){if(r=t.deref(this),null===r)return void console.log("!!!!!!!!!!! CYCLE AVERTED!",t)}else r=t;return n==r?void console.log("!!!!!!!!!!! CYCLE AVERTED!",t):void n.bind(r,e)},Value.prototype.inspect=function(){return"Value("+this.name+")"},Instruction.inspect_compact=!1,Instruction.inspect_quoted=!1,Instruction.prototype.is=function(t){return this.opcode==t},Instruction.prototype.get=function(t,e){return e?e+this.ctx[t]:this.ctx[t]},Instruction.prototype.get_parameter_name=function(){return this.ctx?this.ctx.p?this.ctx.p:this.ctx.x?"$x"+this.ctx.x:null:null},Instruction.prototype.inspect=function(){var t=["p","x","y"],e="";if(this.ctx&&this.ctx.l&&(e=this.ctx.l+"  "),e+=this.opcode+Array(13-this.opcode.length).join(" "),null===this.ctx)return e;Instruction.inspect_compact||(e+=" ( "),this.ctx.f&&(e+=this.ctx.f+"/"+this.ctx.a);for(var n=0,r=!1;n<t.length;n++)if(void 0!==this.ctx[t[n]]){(r||this.ctx.f&&!r)&&(e+=", ");var i=this.ctx[t[n]],o=i.inspect?i.inspect():JSON.stringify(i);Instruction.inspect_compact&&"_"==i[0]&&(o="_"),e+=t[n]+"("+o+")",r=!0}return Instruction.inspect_compact||(e+=" )"),Instruction.inspect_quoted&&(e="'"+e+"'"),e},ParseSummary.prototype.inspect=function(){if(this.maybe_error)return"Error: "+this.maybe_error.classname;if(this.maybe_token_list instanceof Array){for(var t="[",e=0;e<this.maybe_token_list.length;e++){var n=this.maybe_token_list[e];e>0&&(t+=","),t+=n.inspect?n.inspect():JSON.stringify(n)}return t+"]"}return this.maybe_token_list.inspect?"ParseSummary: "+this.maybe_token_list.inspect():JSON.stringify(this.maybe_token_list)},ErrorSyntax.prototype=Error.prototype,ErrorInvalidFact.prototype=Error.prototype,ErrorExpectingFunctor.prototype=Error.prototype,ErrorExpectingVariable.prototype=Error.prototype,ErrorFunctorNotFound.prototype=Error.prototype,ErrorFunctorClauseNotFound.prototype=Error.prototype,ErrorFunctorCodeNotFound.prototype=Error.prototype,ErrorExpectingGoal.prototype=Error.prototype,ErrorInvalidHead.prototype=Error.prototype,ErrorRuleInQuestion.prototype=Error.prototype,ErrorNoMoreInstruction.prototype=Error.prototype,ErrorInvalidInstruction.prototype=Error.prototype,ErrorInternal.prototype=Error.prototype,ErrorInvalidValue.prototype=Error.prototype,ErrorAlreadyBound.prototype=Error.prototype,ErrorNotBound.prototype=Error.prototype,ErrorExpectingListStart.prototype=Error.prototype,ErrorExpectingListEnd.prototype=Error.prototype,ErrorInvalidToken.prototype=Error.prototype,ErrorUnexpectedParensClose.prototype=Error.prototype,ErrorUnexpectedPeriod.prototype=Error.prototype,ErrorUnexpectedEnd.prototype=Error.prototype,ErrorUnexpectedListEnd.prototype=Error.prototype,ErrorAttemptToRedefineBuiltin.prototype=Error.prototype;var Types={};Types.revivable={Token:Token,Var:Var,Functor:Functor},Types.ReviveFromJSON=function(t,e){var n=e.match(/(.*?):(.*?):(.*)/),r=n[1],i=n[2],o=n[3],s=Types.revivable[r],u=s.fromJSON(i,o);return u},"undefined"!=typeof module&&(module.exports.Types=Types,module.exports.Eos=Eos,module.exports.Code=Code,module.exports.InComment=InComment,module.exports.Functor=Functor,module.exports.Op=Op,module.exports.Var=Var,module.exports.Value=Value,module.exports.OpNode=OpNode,module.exports.Result=Result,module.exports.Instruction=Instruction,module.exports.ParseSummary=ParseSummary,module.exports.ErrorSyntax=ErrorSyntax,module.exports.ErrorInvalidFact=ErrorInvalidFact,module.exports.ErrorExpectingFunctor=ErrorExpectingFunctor,module.exports.ErrorExpectingVariable=ErrorExpectingVariable,module.exports.ErrorInvalidHead=ErrorInvalidHead,module.exports.ErrorInvalidToken=ErrorInvalidToken,module.exports.ErrorRuleInQuestion=ErrorRuleInQuestion,module.exports.ErrorExpectingGoal=ErrorExpectingGoal,module.exports.ErrorNoMoreInstruction=ErrorNoMoreInstruction,module.exports.ErrorInvalidInstruction=ErrorInvalidInstruction,module.exports.ErrorFunctorNotFound=ErrorFunctorNotFound,module.exports.ErrorFunctorClauseNotFound=ErrorFunctorClauseNotFound,module.exports.ErrorFunctorCodeNotFound=ErrorFunctorCodeNotFound,module.exports.ErrorInternal=ErrorInternal,module.exports.ErrorAlreadyBound=ErrorAlreadyBound,module.exports.ErrorNotBound=ErrorNotBound,module.exports.ErrorExpectingListStart=ErrorExpectingListStart,module.exports.ErrorExpectingListEnd=ErrorExpectingListEnd,module.exports.ErrorUnexpectedListEnd=ErrorUnexpectedListEnd,module.exports.ErrorUnexpectedParensClose=ErrorUnexpectedParensClose,module.exports.ErrorUnexpectedPeriod=ErrorUnexpectedPeriod,module.exports.ErrorUnexpectedEnd=ErrorUnexpectedEnd,module.exports.ErrorAttemptToRedefineBuiltin=ErrorAttemptToRedefineBuiltin),Compiler.prototype.process_rule_or_fact=function(t){if(!(t instanceof Functor))throw new ErrorExpectingFunctor("Expecting Functor, got: "+JSON.stringify(t),t);if("rule"==t.name)return this.process_rule(t);var e=!1,n={head:this.process_head(t,e),f:t.name,a:t.args.length};return n},Compiler.prototype.process_query_or_rule_or_fact=function(t){if(!(t instanceof Functor))throw new ErrorExpectingFunctor("Expecting Functor, got: "+JSON.stringify(t),t);if("query"==t.name)return this.process_query(t.args[0]);if("rule"==t.name)return this.process_rule(t);var e=!1,n={head:this.process_head(t,e),f:t.name,a:t.args.length};return n},Compiler.prototype.process_rule=function(t){var e=t.args[0],n=t.args[1],r={},i=!0,o=!1;r.head=this.process_head(e,i);var s=r.head.vars,u=this.process_body(n,o,s);for(var a in u)r[a]=u[a];return r.f=e.name,r.a=e.args.length,delete r.head.vars,r},Compiler.prototype.process_head=function(t,e){if(!(t instanceof Functor))throw new ErrorExpectingFunctor("Expecting Functor",t);if("conj"==t.name||"disj"==t.name)throw new ErrorInvalidHead("Unexpected conjunction or disjunction within Functor head",t);var n=new Visitor(t),r=[],i={};return n.process(function(t){if(t.is_struct)return t.as_param?void r.push(new Instruction("get_var",{x:t.v})):void r.push(new Instruction("get_struct",{f:t.n.name,a:t.n.args.length,x:t.v}));if(t.n instanceof Var){var e=void 0===i[t.n.name],n=t.root_param,o=t.in_cons===!0;return i[t.n.name]=!0,e&&(n||o)?void r.push(new Instruction("get_var",{p:t.n.name})):e&&!n?void("_"==t.n.name[0]?r.push(new Instruction("unif_void")):r.push(new Instruction("unif_var",{p:t.n.name}))):(!e&&n&&r.push(new Instruction("get_value",{p:t.n.name})),void(e||n||r.push(new Instruction("unif_value",{p:t.n.name}))))}if(t.n instanceof Token){if("nil"==t.n.name)return void r.push(new Instruction("get_nil"));if("term"==t.n.name)return void(t.root_param?r.push(new Instruction("get_term",{p:t.n.value})):r.push(new Instruction("unify_term",{p:t.n.value})));if("number"==t.n.name)return void(t.root_param?r.push(new Instruction("get_number",{p:t.n.value})):r.push(new Instruction("unify_number",{p:t.n.value})))}}),e?r.push(new Instruction("jump",{p:"g0"})):r.push(new Instruction("proceed")),r.vars=i,r},Compiler.prototype.process_query=function(t){if(!(t instanceof Functor))throw new ErrorExpectingFunctor("Expecting Functor",t);if("rule"==t.name)throw new ErrorRuleInQuestion("Unexpected rule definition in query",t);var e=!0;return this.process_body(t,e)},Compiler.prototype.process_body=function(t,e,n){var r=n,i={},o={is_query:e},s={},u=new Visitor3(t),a=this,l=function(t,e){var n=s[t];return e||n?n?l(n,n):e:t},c=function(t,e,n){var r="g"+e.vc,i="g"+n.vc,u=o[r],a=u[u.length-1];"proceed"==a.opcode&&u.pop(),"end"==a.opcode&&u.pop();var l=e.n&&e.n.attrs.primitive;l||o[r].push(new Instruction("maybe_fail")),o[r]=o[r].concat(o[i]),s[i]=r,delete o[i];var c="g"+t.vc;o[c]=o[r],s[r]=c,delete o[r]},p=function(t,e,n){var r="g"+t.vc,u="g"+e.vc,a="g"+n.vc;if(e.n)o[u].unshift(new Instruction("try_else",{p:a}));else{var c=i[u],p=c.r,h=l(p);o[h].unshift(new Instruction("try_else",{p:a}))}o[r]=o[u],s[u]=r,t.root&&o[a].unshift(new Instruction("try_finally")),delete o[u]};return u.process(function(t,n,s){var u=t.type,l=t.goal_id,h=t.root,f=u+l,d=n;if(h&&(f="g0"),"root"==u)return f="g0",void(o[f]=a.process_goal(d.n,e,r));var g=a.process_goal(n.n,e,r),v=a.process_goal(s.n,e,r),m="g"+t.vc,_="g"+n.vc,y="g"+s.vc;i[m]={l:_,r:y},g&&(o[_]=g),v&&(o[y]=v),"conj"==u&&c(t,n,s),"disj"==u&&p(t,n,s)}),o},Compiler.prototype.process_goal=function(t,e,n){if(n=n||{},void 0===t)return void 0;if("cut"==t.name)return[new Instruction("cut"),new Instruction("proceed")];if("fail"==t.name)return[new Instruction("fail")];if(t.attrs.primitive&&t.attrs.to_evaluate)return this.process_primitive(t,e,n);"not"==t.name&&(t=t.args[0],t.not=!0);var r=new Visitor2(t),i=[];return i.push(new Instruction("allocate")),r.process(function(t){var r={f:t.n.name,a:t.n.args.length,x:t.vc};t.root&&(r.x=0),i.push(new Instruction("put_struct",r));for(var o=0;o<t.args.length;o++){var s=t.args[o];s instanceof Var&&("_"==s.name[0]?i.push(new Instruction("put_void")):(i.push(new Instruction("put_var",{p:s.name})),n[s.name]=!0)),s instanceof Value&&i.push(new Instruction("put_value",{x:s.name})),s instanceof Token&&("number"==s.name&&i.push(new Instruction("put_number",{p:s.value})),"term"==s.name&&i.push(new Instruction("put_term",{p:s.value})),"nil"==s.name&&i.push(new Instruction("put_nil")))}t.root&&(t.n.attrs.builtin?(i.push(new Instruction("setup")),i.push(new Instruction("bcall")),i.push(new Instruction("maybe_retry")),i.push(new Instruction("deallocate"))):(i.push(new Instruction("setup")),i.push(new Instruction("call")),t.n.not?i.push(new Instruction("maybe_retryn")):i.push(new Instruction("maybe_retry")),i.push(new Instruction("deallocate"))),e?i.push(new Instruction("end")):i.push(new Instruction("proceed")))}),i},Compiler.prototype.process_primitive=function(t,e,n){var r=new Visitor2(t),i=[];return r.process(function(t){var e=t.n.name;i.push(new Instruction("prepare"));for(var r=0;r<t.args.length;r++){var o=t.args[r];if(o instanceof Var&&(i.push(new Instruction("push_var",{p:o.name})),n[o.name]=!0),o instanceof Value&&i.push(new Instruction("push_value",{y:o.name})),o instanceof Token){if("number"==o.name&&i.push(new Instruction("push_number",{p:o.value})),"term"==o.name)throw new ErrorInvalidToken("term: "+JSON.stringify(o.value),o);if("nil"==o.name)throw new ErrorInvalidToken("nil",o)}}var s="op_"+e;t.n.attrs["boolean"]||!t.n.attrs.retvalue?i.push(new Instruction(s)):i.push(new Instruction(s,{y:t.vc}))}),i.push(new Instruction("proceed")),i},"undefined"!=typeof module&&(module.exports.Compiler=Compiler),Database.prototype.clear=function(){this.db={}},Database.prototype.insert=function(t){t instanceof Array||(t=[t]);for(var e in t)this._insert(t[e])},Database.prototype._insert=function(t){var e=this.al.compute_signature(t),n=this.db[e]||[];return n.push(t),this.db[e]=n,e},Database.prototype.batch_insert_code=function(t){t instanceof Array||(t=[t]);for(var e in t){var n=t[e],r=n.f||n.code.f,i=n.a||n.code.a;this.insert_code(r,i,n.code||n)}},Database.prototype.exists=function(t,e){var n=this.al.compute_signature([t,e]);return void 0!==this.db[n]},Database.prototype.insert_code=function(t,e,n){if(void 0===t||void 0===e||void 0===n)throw new ErrorExpectingFunctor("Invalid functor name/arity/code: "+t+"/"+e+" code: "+JSON.stringify(n));var r=this.al.compute_signature([t,e]),i=this.db[r]||[];i.push(n),this.db[r]=i},Database.prototype.get_code=function(t,e){var n=this.al.compute_signature([t,e]),r=this.db[n]||[];return r},Database.prototype.get=function(t){var e=this.al.compute_signature(t);return this.db[e]||null},Database.prototype.define=function(t){var e=this.al.compute_signature(t);this.db[e]=t},Database.prototype.lookup_functor=function(t){return this.db[t]||null},DatabaseManager.prototype.builtin_insert_code=function(t,e,n){this.db_builtins.insert_code(t,e,n)},DatabaseManager.prototype.user_insert_code=function(t,e,n){if(this.db_builtins.exists(t,e))throw new ErrorAttemptToRedefineBuiltin("Attempt to redefine Functor",t,e);this.db_user.insert_code(t,e,n)},"undefined"!=typeof module&&(module.exports.Database=Database,module.exports.DatabaseManager=DatabaseManager),DbAccess.compute_signature=function(t){if(t instanceof Array){var e=t[0],n=t[1];return e+"/"+n}var r=null;try{var i=DbAccess.extract_head_of_rule(t);r=DbAccess.get_functor_signature(i)}catch(o){r=DbAccess.get_functor_signature(t)}return r},DbAccess.is_fact=function(t){return t instanceof Functor?"rule"!=t.name:!1},DbAccess.is_rule=function(t){return t instanceof Functor?"rule"==t.name:!1},DbAccess.extract_head_of_rule=function(t){if(!(t instanceof Functor)||"rule"!=t.name)throw new Error("Expecting a `rule`, got: "+t.name);return t.args[0]},DbAccess.get_functor_signature=function(t){if(!(t instanceof Functor))throw new Error("Expecting Functor, got: "+JSON.stringify(t));return""+t.name+"/"+t.args.length},"undefined"!=typeof module&&(module.exports.DbAccess=DbAccess),Interpreter.prototype.get_context=function(){return this.ctx},Interpreter.prototype.get_stack=function(){return this.stack},Interpreter.prototype.set_tracer=function(t){this.tracer=t},Interpreter.prototype.set_question=function(t){t instanceof Array?this.db.insert_code(".q.",0,t[0]):this.db.insert_code(".q.",0,t),this.ctx={step_counter:0,p:{f:".q.",a:0,ci:0,ct:1,l:"g0",i:0},cc:null,cv:null,cs:null,csx:null,csi:0,csm:"r",cu:!0,tse:{},cse:{},end:!1},this.stack=[];var e={qenv:!0,cp:{},vars:{},trail:[],ci:0,ct:0,te:null,cv:null};this.stack.push(e),this.ctx.cse=e,this.ctx.tse=null,this._execute()},Interpreter.prototype.backtrack=function(){if(this.tracer&&this.tracer("backtracking",this.ctx),this.ctx.cu=!1,this.ctx.end=!1,this.ctx.tse.qenv)return!1;var t=this.ctx.tse.cut;if(void 0===t)return this._restore_continuation(this.ctx.tse.cp),this._execute(),!0;for(;!this.ctx.tse.qenv;){this._unwind_trail(this.ctx.tse.trail);var e=this.ctx.tse.spos;if(t==e)break;this.stack.pop(),this.ctx.tse=this.stack[this.stack.length-1],this.ctx.cse=this.ctx.tse}return this.ctx.tse.qenv?!1:(this._restore_continuation(this.ctx.tse.cp),this._execute(),!0)},Interpreter.prototype.step=function(){if(this.ctx.end)return!0;this.ctx.step_counter++;var t=this.fetch_next_instruction(),e="inst_"+t.opcode,n=this[e];if(!n)throw new ErrorInvalidInstruction(t.opcode,t);return this.tracer?(this.tracer("before_inst",this,t),this[e].apply(this,[t]),this.tracer("after_inst",this,t)):this[e].apply(this,[t]),this.ctx.end},Interpreter.prototype.fetch_next_instruction=function(){var t=this.ctx.cc[this.ctx.p.l][this.ctx.p.i];if(this.ctx.p.i++,t)return t;throw new ErrorNoMoreInstruction("No More Instruction",t)},Interpreter.prototype._get_code=function(t,e,n){return this.db.exists(t,e)?this.__get_code(this.db,t,e,n):this.__get_code(this.db_builtins,t,e,n)},Interpreter.prototype.__get_code=function(t,e,n,r){var i,o,s={};try{o=t.get_code(e,n),s.ct=o.length}catch(u){throw i=e+"/"+n,new ErrorFunctorNotFound("Functor not found: "+i,i)}if(r>=s.ct)throw i=e+"/"+n,new ErrorFunctorClauseNotFound("Functor clause not found: "+i,i);return s.cc=o[r],s.cc?s:(i=e+"/"+n,ErrorFunctorCodeNotFound("Functor clause code not found: "+i,i))},Interpreter.prototype._goto=function(t){this.ctx.p.l=t,this.ctx.p.i=0},Interpreter.prototype._execute=function(t){var e={};return t?(e=this._get_code(t.f,t.a,t.ci),this.ctx.p.f=t.f,this.ctx.p.a=t.a,this.ctx.p.ci=t.ci,this.ctx.p.i=0,this.ctx.cc=e.cc,this.ctx.p.ct=e.ct):(e=this._get_code(this.ctx.p.f,this.ctx.p.a,this.ctx.p.ci),this.ctx.cc=e.cc),t&&(this.ctx.p.l=t.l||"head"),this.tracer&&this.tracer("execute",this.ctx),e},Interpreter.prototype._restore_continuation=function(t){this.tracer&&this.tracer("restore",t),this.ctx.cse=t.ce,this.ctx.te=t.te,this.ctx.p.f=t.p.f,this.ctx.p.a=t.p.a,this.ctx.p.ci=t.p.ci,this.ctx.p.ct=t.p.ct,this.ctx.p.l=t.p.l,this.ctx.p.i=t.p.i},Interpreter.prototype._save_continuation=function(t,e){t.p={},t.ce=this.ctx.cse,t.te=this.ctx.te,t.p.f=this.ctx.p.f,t.p.a=this.ctx.p.a,t.p.ci=this.ctx.p.ci,t.p.ct=this.ctx.p.ct,t.p.l=this.ctx.p.l,t.p.i=this.ctx.p.i+(e||0),this.tracer&&this.tracer("save",t)},Interpreter.prototype._add_to_trail=function(t,e){var n=e.name;t[n]=e},Interpreter.prototype.maybe_add_to_trail=function(t,e){var n=e.deref();if(!n.is_bound()){var r=n.name;t[r]=n}},Interpreter.prototype._unwind_trail=function(t){for(var e in t){var n=t[e];n.is_bound()&&n.unbind()}t={}},Interpreter.prototype.get_query_vars=function(){return this.ctx.cse.vars},Interpreter.prototype.inst_end=function(){this.ctx.end=!0},Interpreter.prototype.inst_setup=function(){this._save_continuation(this.ctx.tse.cp,1),this.ctx.tse.p.ci=0,this.ctx.tse.p.ct=0},Interpreter.prototype.inst_bcall=function(t){this.ctx.cse=this.ctx.tse,this.ctx.cu=!0;var e=this.ctx.tse.vars.$x0;this.ctx.tse.vars={},this.ctx.tse.vars.$x0=e;var n=e.name,r=this["builtin_"+n];if(!r)throw new ErrorFunctorNotFound(n,n);r.apply(this,[e]),this._restore_continuation(this.ctx.cse.cp)},Interpreter.prototype.builtin_unif=function(t){var e=t.args[0],n=t.args[1],r=this;this.ctx.cu=Utils.unify(e,n,function(t,e){r.maybe_add_to_trail(r.ctx.tse.trail,t)})},Interpreter.prototype.builtin_notunif=function(t){var e=t.args[0],n=t.args[1];this.ctx.cu=!Utils.unify(e,n,{no_bind:!0})},Interpreter.prototype.builtin_equal=function(t){var e=t.args[0],n=t.args[1],r=this._get_value(e),i=this._get_value(n);this.ctx.cu=r==i},Interpreter.prototype.builtin_equalnot=function(t){this.builtin_equal(t),this.ctx.cu=!this.ctx.cu},Interpreter.prototype.inst_fail=function(t){this.backtrack()},Interpreter.prototype.inst_call=function(t){var e=this.ctx.tse.vars.$x0;this.ctx.tse.vars={},this.ctx.tse.vars.$x0=e,this.ctx.cs=null,this.ctx.csx=null,this.ctx.csm="r",this.ctx.csi=0;var n=e.name,r=e.args.length,i=this._execute({f:n,a:r,ci:this.ctx.tse.p.ci});this.ctx.tse.p.ct=i.ct,this.ctx.cse=this.ctx.tse,this.ctx.cu=!0},Interpreter.prototype.inst_maybe_retry=function(){this.ctx.cu||(this._unwind_trail(this.ctx.tse.trail),this.ctx.tse.p.ci++,this.ctx.tse.p.ci<this.ctx.tse.p.ct&&(this.ctx.p.i-=2))},Interpreter.prototype.inst_maybe_retryn=function(){return this.ctx.cu?(this._unwind_trail(this.ctx.tse.trail),this.ctx.tse.p.ci++,void(this.ctx.tse.p.ci<this.ctx.tse.p.ct&&(this.ctx.p.i-=2))):void(this.ctx.cu=!this.ctx.cu)},Interpreter.prototype.inst_allocate=function(){var t={vars:{},cp:{},trail:{},p:{},spos:this.stack.length};this.ctx.tse=t,this.stack.push(t)},Interpreter.prototype.inst_deallocate=function(){this.ctx.cu||(this._unwind_trail(this.ctx.tse.trail),this._deallocate())},Interpreter.prototype._deallocate=function(){this.stack.pop(),this.ctx.tse=this.stack[this.stack.length-1]},Interpreter.prototype.inst_maybe_fail=function(){return this.ctx.cu?void 0:this.ctx.cse.te?(this._goto(this.ctx.cse.te),void(this.ctx.cse.te=null)):void this.backtrack()},Interpreter.prototype.inst_try_else=function(t){var e=t.get("p");this.ctx.cse.te=e},Interpreter.prototype.inst_try_finally=function(){this.ctx.cse.te=null},Interpreter.prototype.inst_jump=function(t){var e=t.get("p");this.ctx.p.l=e,this.ctx.p.i=0},Interpreter.prototype.inst_proceed=function(){return this.ctx.cu?(this._restore_continuation(this.ctx.cse.cp),void this._execute()):this.ctx.cse.te?(this._goto(this.ctx.cse.te),void(this.ctx.cse.te=null)):void this.backtrack()},Interpreter.prototype.inst_cut=function(){var t=this.ctx.cse.spos;this.ctx.tse.cut=t,this.ctx.cu=!0},Interpreter.prototype.inst_prepare=function(t){this.ctx.cse.vars.$y0=new Functor("$op"),this.ctx.cu=!0},Interpreter.prototype.inst_push_var=function(t){var e=t.get("p"),n=this.ctx.cse.vars.$y0,r=this.ctx.cse.vars[e];r||(r=new Var(e),this.ctx.cse.vars[r.name]=r),n.push_arg(r)},Interpreter.prototype._get_value=function(t){if(t instanceof Var){var e=t.deref();if(!e.is_bound())throw new ErrorErrorNotBound("Expecting bound variable for: "+t.name,t);t=e.get_value()}if(Utils.isNumeric(t))return t;if(t instanceof Token){if("number"==t.name)return t.value;if("boolean"==t.name)return t.value}throw new ErrorInvalidToken("Invalid Token: Got: "+JSON.stringify(t),t)},Interpreter.prototype.inst_push_value=function(t){var e=t.get("y","$y"),n=this.ctx.cse.vars.$y0,r=this.ctx.cse.vars[e],i=this._get_value(r);n.push_arg(i)},Interpreter.prototype.inst_push_number=function(t){var e=t.get("p"),n=this.ctx.cse.vars.$y0;n.push_arg(e)},Interpreter.prototype.inst_op_unif=function(t){var e=this.ctx.cse.vars.$y0,n=this._get_value(e.args[0]),r=this._get_value(e.args[1]),i=this;return this.ctx.cu=Utils.unify(n,r,function(t){i.maybe_add_to_trail(i.ctx.cse.trail,t)}),this._exit()},Interpreter.prototype._exit=function(){return this.ctx.cu?void 0:this.ctx.cse.te?(this._goto(this.ctx.cse.te),void(this.ctx.cse.te=null)):void this.backtrack()},Interpreter.prototype.inst_op_is=function(t){var e=this.ctx.cse.vars.$y0,n=e.args[0],r=e.args[1];if(!(n instanceof Var))throw new ErrorExpectingVariable("Expecting an unbound variable as lvalue of `is`, got: "+JSON.stringify(n),t);n.bind(r),this.ctx.cu=!0},Interpreter.prototype.inst_op_true=function(t){this.ctx.cse.vars.$y1=new Token("boolean",!0),this.ctx.cu=!0},Interpreter.prototype.inst_op_false=function(t){this.ctx.cse.vars.$y1=new Token("boolean",!1),this.ctx.cu=!0},Interpreter.prototype.inst_op_not=function(t){this.ctx.cu=!0;var e=this.ctx.cse.vars.$y0.args[0];if(console.log("op_not: p= ",e),e instanceof Token&&"boolean"==e.name)return void(this.ctx.cse.vars.$y1=new Token("boolean",!e.value));if(e!==!0&&e!==!1)throw Error("Expecting Boolean got: "+JSON.stringify(e));this.ctx.cse.vars.$y1=new Token("boolean",!e)},Interpreter.prototype._get_values=function(){var t,e,n=this.ctx.cse.vars.$y0,r=n.args[0],i=n.args[1];return t=r instanceof Var?r.deref().get_value():Utils.isNumeric(r)?r:r.value,e=i instanceof Var?i.deref().get_value():Utils.isNumeric(i)?i:i.value,{r:e,l:t}},Interpreter.prototype.inst_op_plus=function(t){var e=t.get("y","$y"),n=this._get_values();this.ctx.cse.vars[e]=n.l+n.r,this.ctx.cu=!0},Interpreter.prototype.inst_op_minus=function(t){var e=t.get("y","$y"),n=this._get_values();this.ctx.cse.vars[e]=n.l-n.r,this.ctx.cu=!0},Interpreter.prototype.inst_op_mult=function(t){var e=t.get("y","$y"),n=this._get_values();this.ctx.cse.vars[e]=n.l*n.r,this.ctx.cu=!0},Interpreter.prototype.inst_op_div=function(t){var e=t.get("y","$y"),n=this._get_values();this.ctx.cse.vars[e]=n.l/n.r,this.ctx.cu=!0},Interpreter.prototype.inst_op_gt=function(){var t=this._get_values();this.ctx.cu=t.l>t.r,this._exit()},Interpreter.prototype.inst_op_lt=function(){var t=this._get_values();this.ctx.cu=t.l<t.r,this._exit()},Interpreter.prototype.inst_op_ge=function(){var t=this._get_values();this.ctx.cu=t.l>=t.r,this._exit()},Interpreter.prototype.inst_op_em=function(){var t=this._get_values();this.ctx.cu=t.l<=t.r,this._exit()},Interpreter.prototype.inst_put_struct=function(t){var e=new Functor(t.get("f")),n=t.get("a");e.arity=n;var r="$x"+t.get("x");this.ctx.cv=r,this.ctx.tse.vars[r]=e},Interpreter.prototype.inst_put_term=function(t){var e=t.get("p"),n=this.ctx.cv,r=this.ctx.tse.vars[n];r.push_arg(e)},Interpreter.prototype.inst_put_number=function(t){var e=t.get("p"),n=this.ctx.cv,r=this.ctx.tse.vars[n];r.push_arg(new Token("number",e))},Interpreter.prototype.inst_put_void=function(){var t=this.ctx.cv,e=this.ctx.tse.vars[t],n=new Var("_");e.push_arg(n)},Interpreter.prototype.inst_put_nil=function(){var t=this.ctx.cv,e=this.ctx.tse.vars[t];e.push_arg(new Token("nil"))},Interpreter.prototype.inst_put_var=function(t){var e=t.get("p"),n=this.ctx.cv,r=this.ctx.tse.vars[n],i=this.ctx.cse.vars[e];void 0===i&&(i=new Var(e),this.ctx.cse.vars[i.name]=i),r.push_arg(i)},Interpreter.prototype.inst_put_value=function(t){var e=t.get("x","$x"),n=this.ctx.tse.vars[e],r=this.ctx.cv,i=this.ctx.tse.vars[r];i.push_arg(n)},Interpreter.prototype.inst_unif_value=function(t){var e=t.get("p"),n=this.ctx.cse.vars[e];if("w"==this.ctx.csm)return this.ctx.cs.push_arg(n),void(this.ctx.cu=!0);var r=this.ctx.cs.get_arg(this.ctx.csi++),i=this;this.ctx.cu=Utils.unify(r,n,function(t){i.maybe_add_to_trail(i.ctx.cse.trail,t)}),this.ctx.cu||this.backtrack()},Interpreter.prototype.inst_unif_void=function(){if(this.ctx.csi++,this.ctx.cu=!0,"w"==this.ctx.csm){var t=new Var("_");this._add_to_trail(this.ctx.cse.trail,t),this.ctx.cs.push_arg(t)}},Interpreter.prototype.inst_get_nil=function(){if("w"==this.ctx.csm)return this.ctx.cs.push_arg(new Token("nil")),void(this.ctx.cu=!0);var t=this.ctx.cs.get_arg(this.ctx.csi++),e=this;this.ctx.cu=Utils.unify(t,new Token("nil"),function(t){e.maybe_add_to_trail(e.ctx.cse.trail,t)}),this.ctx.cu||this.backtrack()},Interpreter.prototype.inst_unif_var=function(t){var e=t.get("p");
e||(e=t.get("x","$x"));var n=this.ctx.cse.vars[e];if(n||(n=new Var(e),this.ctx.cse.vars[n.name]=n),"w"==this.ctx.csm)return this.ctx.cs.push_arg(n),void(this.ctx.cu=!0);var r=this.ctx.cs.get_arg(this.ctx.csi++),i=this;this.ctx.cu=Utils.unify(n,r,function(t){i._add_to_trail(i.ctx.cse.trail,t)}),this.ctx.cu||this.backtrack()},Interpreter.prototype.inst_get_var=function(t){var e=t.get("p")||t.get("x","$x");if(this.ctx.cu=!0,"w"==this.ctx.csm){var n=new Var(e);return this.ctx.cse.vars[e]=n,void this.ctx.cs.push_arg(n)}var r=this.ctx.cs.get_arg(this.ctx.csi++);this.ctx.cse.vars[e]=r},Interpreter.prototype.inst_get_value=function(t){var e=t.get("p"),n=this.ctx.cse.vars[e];if("w"==this.ctx.csm)return this.ctx.cs.push_arg(n),void(this.ctx.cu=!0);var r=this.ctx.cs.get_arg(this.ctx.csi++),i=this;this.ctx.cu=Utils.unify(n,r,function(t){i.maybe_add_to_trail(i.ctx.cse.trail,t)})},Interpreter.prototype.inst_get_struct=function(t){var e=t.get("x","$x");if(e==this.ctx.csx)throw new ErrorInternal("Attempting to 'get_struct' again on same argument: "+e,t);this.ctx.csm="r",this.ctx.csx=e;var n=t.get("f"),r=t.get("a");this.ctx.cu=!1,this.ctx.cs=null,this.ctx.csi=0;var i,o=this.ctx.cse.vars[e];if(o instanceof Var&&(i=o.deref(),!i.is_bound())){this._add_to_trail(this.ctx.cse.trail,o),this.ctx.csm="w";var s=new Functor(n);return this.ctx.cs=s,i.bind(s),void(this.ctx.cu=!0)}this.ctx.csm="r";var u=o;return i&&(u=i.get_value()),u instanceof Functor?u.get_name()!=n?this.backtrack():u.get_arity()!=+r?this.backtrack():(this.ctx.cs=u,void(this.ctx.cu=!0)):void this.backtrack()},Interpreter.prototype.inst_get_number=function(t){this._get_x(t,"number"),this.ctx.cu||this.backtrack()},Interpreter.prototype.inst_get_term=function(t){this._get_x(t,"term"),this.ctx.cu||this.backtrack()},Interpreter.prototype._get_x=function(t,e){var n=t.get("p");if("w"==this.ctx.csm)return this.ctx.cs.push_arg(new Token(e,n)),void(this.ctx.cu=!0);var r=this.ctx.cs.get_arg(this.ctx.csi++);if(this.ctx.cu=!1,r instanceof Token){if(r.name==e)return void(this.ctx.cu=r.value==n)}else{if(r==n)return void(this.ctx.cu=!0);if(r instanceof Var){var i=r,o=i.deref();if(o.is_bound())return void(this.ctx.cu=o.get_value()==n);o.bind(n),this._add_to_trail(this.ctx.cse.trail,o),this.ctx.cu=!0}}},"undefined"!=typeof module&&(module.exports.Interpreter=Interpreter),Lexer.prototype._handleNewline=function(){this.offset=this._tokenRegexp.lastIndex,this.current_line=this.current_line+1},Lexer.prototype._computeIndex=function(t){return t-this.offset},Lexer.token_map={":-":function(){return new Token("op:rule",":-",{is_operator:!0})},"?-":function(){return new Token("op:query","?-",{is_operator:!0})},"=\\=":function(){return new Token("op:equalnot","=\\=",{is_operator:!0})},"=:=":function(){return new Token("op:equal","=:=",{is_operator:!0})},",":function(){return new Token("op:conj",",",{is_operator:!0})},";":function(){return new Token("op:disj",";",{is_operator:!0})},"=":function(){return new Token("op:unif","=",{is_operator:!0})},"\\=":function(){return new Token("op:notunif","\\=",{is_operator:!0})},"<":function(){return new Token("op:lt","<",{is_operator:!0})},">":function(){return new Token("op:gt",">",{is_operator:!0})},"=<":function(){return new Token("op:em","=<",{is_operator:!0})},">=":function(){return new Token("op:ge",">=",{is_operator:!0})},"-":function(){return new Token("op:minus","-",{is_operator:!0})},"+":function(){return new Token("op:plus","+",{is_operator:!0})},"*":function(){return new Token("op:mult","*",{is_operator:!0})},"/":function(){return new Token("op:div","/",{is_operator:!0})},not:function(){return new Token("op:not","not",{is_operator:!0})},is:function(){return new Token("op:is","is",{is_operator:!0,to_evaluate:!0})},"|":function(){return new Token("list:tail","|")},"\n":function(){return new Token("newline")},".":function(){return new Token("period")},"(":function(){return new Token("parens_open",null)},")":function(){return new Token("parens_close",null)},"[":function(){return new Token("list:open",null)},"]":function(){return new Token("list:close",null)}},Lexer.prototype.process=function(){for(var t,e=[];;)if(t=this.next(),!(t instanceof InComment)){if(t&&null===t.name||"eof"==t.name)break;void 0!==t&&e.push(t)}return e},Lexer.InComment=new InComment,Lexer.prototype.process_per_sentence=function(){for(var t,e=[],n=[];;)if(t=this.next(),!(t instanceof InComment)){if(null===t||"eof"==t.name){n.length>0&&e.push(n);break}"newline"!=t.name&&("period"!=t.name?n.push(t):(e.push(n),n=[]))}return e},Lexer.prototype.step=function(){return this.at_the_end?null:(this.current_match=this._tokenRegexp.exec(this.text),this.offset_in_text=this._tokenRegexp.lastIndex,null!==this.current_match?this.current_match[0]:(this.at_the_end=!0,null))},Lexer.prototype.is_quote=function(t){return"'"==t|'"'==t},Lexer.is_number=function(t){return String(parseFloat(t))==String(t)},Lexer.prototype.next=function(){function t(t){return new Token("term",t)}var e=null,n=this.step();if(null===n)return new Token("eof");var r=n,i=this._computeIndex(this.current_match.index);if(this.in_comment&&'"""'!=r)return this.comment_chars+=r,"\n"==r&&this.current_line++,Lexer.InComment;if('"""'==r)return this.in_comment?(this.in_comment=!1,e=new Token("comment",this.comment_chars),e.col=0,e.line=this.comment_start_line,e.offset=this.offset_in_text,e):(this.in_comment=!0,this.comment_start_line=this.current_line,this.comment_chars="",Lexer.InComment);if("%"==r){e=new Token("comment",null),e.col=i,e.line=this.current_line,e.offset=this.offset_in_text,this.current_line=this.current_line+1;for(var o="";;){var s=this.step(Lexer.newline_as_null);if(null===s||"\n"==s||"\r"==s)break;o+=s}return e.value=o,e}if(Lexer.is_number(r)){var u=parseFloat(r);return e=new Token("number",u),e.is_primitive=!0,e.col=i,e.line=this.current_line,e.offset=this.offset_in_text,e}if(this.is_quote(r))for(var a,l="";;){if(a=this.step(),this.is_quote(a)|"\n"==a|null===a)return e=new Token("string",l),e.is_primitive=!0,e.col=i,e.line=this.current_line,e.offset=this.offset_in_text,e;l+=a}var c=Lexer.token_map[n]||t;return e=c(n),e.col=i,e.line=this.current_line,e.offset=this.offset_in_text,"newline"==e.name&&this._handleNewline(),e},"undefined"!=typeof module&&(module.exports.Lexer=Lexer,module.exports.Token=Token),ParserL1.prototype.next=function(){if(this.reached_end)return new Eos;var t;do t=this.list.shift();while(null===t);if(void 0===t)return new Eos;if("term"==t.name&&("true"===t.value||"false"===t.value)&&(t.name="boolean",t.value="true"===t.value),"term"==t.name){var e=(t.value||"").replace(/\s/g,"");if(0===e.length)return null}var n=this.list.shift()||null;if(null===n&&(this.reached_end=!0),n&&"list:close"==n.name&&"list:open"==t.name)return t.name="nil",[t];if(n&&"parens_open"==n.name&&("term"==t.name||"string"==t.name))return t.name="functor",[t];if(this.list.unshift(n),"term"==t.name&&null!==t.value){var r=""+t.value[0];r.toUpperCase()==r&&ParserL1.isLetter(r)&&(t.name="var"),"_"==r&&1==t.value.length&&(t.name="var",t.value="_")}return[t]},ParserL1.isLetter=function(t){var e=t.charCodeAt(0);return e>=65&&90>=e||e>=97&&122>=e},ParserL1.prototype.process=function(){for(var t=[];;){var e=this.next();if(null!==e){if(e instanceof Eos)break;Array.prototype.push.apply(t,e)}}return t},"undefined"!=typeof module&&(module.exports.ParserL1=ParserL1),ParserL2.compute_ops_replacement=function(t,e){var n;if("-"==t.value){if("-"==e.value)return n=new OpNode("+",500),n.line=e.line,n.col=e.col,n.offset=e.offset,n;if("+"==e.value)return n=new OpNode("-",500),n.line=e.line,n.col=e.col,n.offset=e.offset,n}if("+"==t.value){if("+"==e.value)return n=new OpNode("+",500),n.line=e.line,n.col=e.col,n.offset=e.offset,n;if("-"==e.value)return n=new OpNode("-",500),n.line=e.line,n.col=e.col,n.offset=e.offset,n}return null},ParserL2.preprocess_list=function(t,e){e=e||0;for(var n=[],r=0;;e++){var i=t[e];if(!i)break;if("list:open"!=i.name){if("list:close"!=i.name)"op:conj"!=i.name&&n.push(i);else if(r--,n.push(i),0===r)break}else r++,n.push(i)}return n},ParserL2.nil=new Token("nil"),ParserL2.prototype.next=function(){var t=this.tokens[this.index]||null;return this.index=this.index+1,t},ParserL2.prototype.regive=function(){this.index--},ParserL2.prototype.get_token=function(){for(var t;(t=this.next(),t)&&("comment"==t.name||"newline"==t.name););return t},ParserL2.prototype.process_list=function(){var t=this.get_token(),e=t.name||null;if("nil"==e)return t;if("list:open"!=e)throw new ErrorExpectingListStart("Expected the start of a list, got: "+JSON.stringify(t),t);return this._process_list()},ParserL2.prototype._process_list=function(t){function e(t){var e=new Token("nil");return e.line=t?t.line:null,e.col=t?t.col:null,e.offset=t?t.offset:null,e}for(var n=t||this.get_token();n&&("op:conj"==n.name||","==n.symbol);)n=this.get_token();if(!n||"nil"==n.name)return e(n);if("list:close"==n.name)return e(n);var r,i=new Functor("cons");if(i.line=n.line,i.col=n.col,i.offset=n.offset,"list:open"==n.name){var o=this._process_list();i.push_arg(o)}else"functor"==n.name&&(this.regive(),r=this._process({process_functor:!0}),n=r.terms),i.push_arg(n);var s=this.get_token(),u=s;if(null===s)throw new ErrorUnexpectedEnd("Unexpected end in list definition",n);if(u=s,"list:tail"==s.name){if(s=this.get_token(),null===s)throw new ErrorUnexpectedEnd("Unexpected end in list definition",u);if("functor"==s.name&&(this.regive(),r=this._process({process_functor:!0}),s=r.terms),"list:open"==s.name&&(s=this._process_list()),i.push_arg(s),s=this.get_token(),null===s)throw new ErrorUnexpectedEnd("Unexpected end in list definition",u);if("list:close"!=s.name)throw new ErrorExpectingListEnd("Expecting list end, got:"+JSON.stringify(s),s);return i}var a=this._process_list(s);return i.push_arg(a),i},ParserL2.prototype.process=function(){this._preprocess(),this.index=0,this.tokens=this.ptokens;for(var t,e=[];t=this._process(),t.terms.length>0&&e.push(t.terms),!(null===t.last_token||t.last_token instanceof Eos););return new Result(e,this.index)},ParserL2.prototype._process=function(t){t=t||{};for(var e=[],n=null,r=null;;){if(n=this.get_token(),null===n||n instanceof Eos){if(t.diving_functor)throw new ErrorUnexpectedEnd("Within a Functor definition",r);return new Result(e,n)}if(r=n,"list:close"==n.name)throw new ErrorUnexpectedListEnd("Close list within corresponding Open list",n);if("list:open"!=n.name){if(!(t.diving_functor&&n instanceof OpNode&&","==n.symbol)){if("parens_close"==n.name){if(t.diving_functor)return new Result(e,n);throw new ErrorUnexpectedParensClose("Parens close without corresponding parens open",n)}if("period"==n.name){if(t.diving_functor)throw new ErrorUnexpectedPeriod("Unexpected period within Functor definition",n);return new Result(e,n)}if("functor"!=n.name)e.push(n);else{var i=this._process({diving_functor:!0}),o=new Functor(n.value);if(o.args=i.terms,o.original_token=n,o.line=n.line,o.col=n.col,o.offset=n.offset,t.process_functor)return new Result(o,n);e.push(o)}}}else{this.regive();var s=this.process_list();e.push(s)}}},ParserL2.prototype._preprocess=function(){for(var t,e,n;(t=this.get_token(),null!==t)&&!(t instanceof Eos);)if("var"!=t.name)if("parens_open"!=t.name)if("boolean"!=t.name)if("term"!=t.name||"!"!=t.value)if("term"!=t.name||"fail"!=t.value)if("+-"!=t.value&&"-+"!=t.value){if(t.is_operator&&(e=this.tokens[this.index]||null,e&&e.is_operator)){var r=ParserL2.compute_ops_replacement(t,e);if(null!==r){r.line=t.line,r.col=t.col,this.ptokens.push(r),this.index=this.index+1;continue}}t.is_operator?(n=new OpNode(t.value),n.line=t.line,n.col=t.col,n.offset=t.offset,this.ptokens.push(n)):this.ptokens.push(t)}else n=new OpNode("-",500),n.line=t.line,n.col=t.col,n.offset=t.offset,this.ptokens.push(n);else{var i=new Functor("fail");i.attrs.primitive=!0,i.original_token=t,i.line=t.line,i.col=t.col,i.offset=t.offset,this.ptokens.push(i)}else{var o=new Functor("cut");o.attrs.primitive=!0,o.original_token=t,o.line=t.line,o.col=t.col,o.offset=t.offset,this.ptokens.push(o)}else{var s=new Functor(""+t.value);s.attrs.primitive=!0,s.original_token=t,s.line=t.line,s.col=t.col,s.offset=t.offset,this.ptokens.push(s)}else t.name="functor",t.value="expr",t.prec=0,t.is_operator=!1,t.attrs=t.attrs||{},t.attrs.primitive=!0,this.ptokens.push(t);else{var u=new Var(t.value);u.col=t.col,u.line=t.line,u.offset=t.offset,this.ptokens.push(u)}},"undefined"!=typeof module&&(module.exports.ParserL2=ParserL2),ParserL3.prototype.process=function(){var t=[];for(var e in this.op_list)for(var n=this.op_list[e],r=0;r<this.expressions.length;r++){var i=t[r]||this.expressions[r],o=ParserL3.process_expression(n,i);t[r]=o}return ParserL3.check_syntax(t),t},ParserL3.process_expression=function(t,e){for(var n;;){var r=n||e,i=ParserL3._process_expression(t,r),o=i[1];if(n=i[0],0===o)break}return n},ParserL3.check_syntax=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.length>1)throw new ErrorSyntax("Expecting only 1 root Functor",n[0])}},ParserL3._process_expression=function(t,e){for(var n=[],r=0,i=0;i<e.length;i++){var o=e[i];if(o instanceof Functor&&"expr"==o.name&&1==o.args.length&&(o=o.args[0]),o instanceof Functor){var s=o.args,u=ParserL3.process_expression(t,s);o.args=u}if(o instanceof OpNode)if(t.symbol==o.symbol){var a=n[i-1],l=e[i+1],c=this._process_one(t,a,o,l);null!==c?(r++,c.is_unary||n.pop(),n.push(c.result),i++):n.push(o)}else n.push(o);else n.push(o)}return[n,r]},ParserL3._process_one=function(t,e,n,r){var i=OpNode.create_from_name(t.name),o=Op.classify_triplet(e,i,r),s=Op.are_compatible_types(o,t.type);if(!s)return null;var u=new Functor(t.name);u.col=n.col,u.line=n.line,u.offset=n.offset,u.attrs=t.attrs;var a=Op.is_unary(t.type);return a?u.args=[r]:u.args=[e,r],{is_unary:a,result:u}},"undefined"!=typeof module&&(module.exports.ParserL3=ParserL3),Utils.compare_objects=function(t,e,n){if(t instanceof Array){if(!(e instanceof Array)){if(n)throw new Error("Expecting an array");return!1}if(e.length!=t.length){if(n)throw new Error("Expecting arrays of same arity");return!1}for(var r=0;r<t.length;r++)if(!Utils.compare_objects(t[r],e[r],n))return!1;return!0}if(t===e)return!0;if(("function"==typeof e||"string"==typeof t)&&e.inspect){var i=e.inspect();if(i==t)return!0;if(i=i.replace(/^\s+|\s+$/g,""),i==t)return!0}if(t&&t.inspect){if(e&&!e.inspect){if(n)throw new Error("Expecting 'inspect' method on: "+JSON.stringify(e));return!1}if(t.inspect()!=e.inspect()){if(n)throw new Error("Expecting match using inspect: "+JSON.stringify(t));return!1}}if("object"==typeof t){if("object"!=typeof e){if(n)throw new Error("Expecting "+JSON.stringify(t)+" object, got: "+JSON.stringify(e));return!1}for(var o in t)if("_"!=o[0]){var s=t[o],u=e[o];if(s!=u){if(!s||!u){if(n)throw new Error("Expected/Input got undefined: e="+JSON.stringify(s)+", i:"+JSON.stringify(u));return!1}if(s.hasOwnProperty(o)!==u.hasOwnProperty(o)){if(n)throw new Error("Expecting property: "+o);return!1}if(!Utils.compare_objects(s,u))return!1}}return!0}if(n)throw new Error("Unsupported check, expected: "+JSON.stringify(t));return!1},Utils.unify=function(t,e,n){var r="function"==typeof n?n:void 0,i="object"==typeof n?n:{},o=i.no_bind===!0;if(t==e)return!0;var s,u,a=t instanceof Var,l=e instanceof Var;if(a&&l)return s=t.deref(e),u=e.deref(t),null===s||null===u?!0:s.is_bound()&&u.is_bound()?Utils.unify(s.get_value(),u.get_value(),r):s.is_bound()?(o||e.safe_bind(t,r),!0):u.is_bound()?(o||t.safe_bind(e,r),!0):(o||s.bind(e,r),!0);if(a)return s=s||t.deref(),s.is_bound()?Utils.unify(s.get_value(),e,r):(o||s.bind(e,r),!0);if(l)return u=u||e.deref(),u.is_bound()?Utils.unify(u.get_value(),t,r):(o||u.bind(t,r),!0);if(t instanceof Functor&&e instanceof Functor){if(t.args.length!=e.args.length)return!1;for(var c in t.args)if(!Utils.unify(t.args[c],e.args[c],r))return!1;return!0}var p,h;return p=t instanceof Token?t.value:t,h=e instanceof Token?e.value:e,p==h},Utils.pad=function(t,e,n){return t+Array(e-t.length).join(n||" ")},Utils.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},"undefined"!=typeof module&&(module.exports.Utils=Utils),Visitor.prototype.process=function(t){if(!this.exp.args)throw new Error("Expecting a rooted tree, got: "+JSON.stringify(this.exp));return this.cb=t,this._process_depth(this.exp)},Visitor.prototype._process_depth=function(t){if(!t)throw new Error("Visitor: got an undefined node.");return this.__process_depth(t)},Visitor.prototype.__process_depth=function(t){t.is_root=!0;for(var e=[t],n=0,r=[],i={};;){var o=e.pop();if(!o)break;i={n:o,v:o.v||n++,is_struct:o instanceof Functor};var s="cons"==o.name;this.cb(i);for(var u=0;u<o.args.length;u++){var a=o.args[u];a.args&&a.args.length>0?(a.v=n++,this.cb({n:a,is_struct:!0,i:u,v:a.v,as_param:!0,in_cons:s}),e.unshift(a)):this.cb({n:a,i:u,root_param:o.is_root,in_cons:s})}}return r},Visitor2.prototype.process=function(t){if(!(this.exp instanceof Functor))throw new ErrorExpectingFunctor("Expecting a rooted tree, got: "+JSON.stringify(this.exp));this.exp.root=!0,this.cb=t,this._process(this.exp)},Visitor2.prototype._process=function(t,e){if(e=e||1,!t)throw new ErrorExpectingFunctor("Visitor2: got an undefined node.");if(!(t instanceof Functor))throw new ErrorExpectingFunctor("Visitor2: expecting a Functor, got: ",t);for(var n=[],r=0;r<t.args.length;r++){var i=t.args[r];i instanceof Functor?(e=this._process(i,e),n.push(new Value(e++))):n.push(i)}return this.cb({n:t,args:n,vc:e,root:t.root}),e},Visitor3.prototype.process=function(t){this.cb=t,this._process(this.exp)},Visitor3.prototype._process=function(t,e){var n=void 0===e;if(e=e||0,!t)throw new ErrorExpectingFunctor("Visitor3: got an undefined node.");if(!(t instanceof Functor))throw new ErrorExpectingFunctor("Visitor3: expecting a Functor, got: "+JSON.stringify(t));if("conj"!=t.name&&"disj"!=t.name)return n?this.cb({type:"root",vc:e},{n:t},null):{vc:e,n:t,is_junction:!1};var r=t.args[0],i=t.args[1],o=this._process(r,e+1),s=o.vc+1,u=this._process(i,s);return u.vc=s,o.vc=e+1,u.is_junction&&delete u.n,o.is_junction&&delete o.n,delete o.is_junction,delete u.is_junction,this.cb({type:t.name,vc:e,root:n},o,u),{vc:u.vc,is_junction:!0}},"undefined"!=typeof module&&(module.exports.Visitor=Visitor,module.exports.Visitor2=Visitor2,module.exports.Visitor3=Visitor3);